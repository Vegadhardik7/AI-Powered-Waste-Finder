"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7647],{17647:(e,t,n)=>{n.r(t),n.d(t,{CellTypeSwitcher:()=>_,CommandEditStatus:()=>T,ExecutionIndicator:()=>k,ExecutionIndicatorComponent:()=>y,INotebookTools:()=>we,INotebookTracker:()=>be,INotebookWidgetFactory:()=>_e,KernelError:()=>C,Notebook:()=>ce,NotebookActions:()=>m,NotebookAdapter:()=>P,NotebookModel:()=>I,NotebookModelFactory:()=>E,NotebookPanel:()=>ue,NotebookSearchProvider:()=>me,NotebookToCFactory:()=>pe,NotebookToCModel:()=>ve,NotebookTools:()=>j,NotebookTracker:()=>ye,NotebookTrustStatus:()=>xe,NotebookViewModel:()=>G,NotebookWidgetFactory:()=>Se,NotebookWindowedLayout:()=>Y,RunningStatus:()=>ge,StaticNotebook:()=>re,ToolbarItems:()=>p,getIdForHeading:()=>fe});var o=n(2815),i=n(7065),s=n(22554),l=n(52969),a=n(39233),d=n(39787),r=n(6691),c=n(72245),h=n.n(c),u=n(59874);const g="application/vnd.jupyter.cells";class C extends Error{constructor(e){const t=e,n=t.ename,o=t.evalue;super(`KernelReplyNotOK: ${n} ${o}`),this.errorName=n,this.errorValue=o,this.traceback=t.traceback,Object.setPrototypeOf(this,C.prototype)}}class m{static get executed(){return v.executed}static get executionScheduled(){return v.executionScheduled}static get selectionExecuted(){return v.selectionExecuted}constructor(){}}var v;!function(e){function t(e,t="below",n,o=!1){if(!e.model||!e.activeCell)return;const i=v.getState(e),s=e.model;e.mode="command";const l=n.map((t=>(t.id="code"===t.cell_type&&"cut"===e.lastClipboardInteraction&&"string"==typeof t.id?t.id:void 0,u.createCell(t))));let a=0;const d=e.activeCellIndex;s.sharedModel.transact((()=>{switch(t){case"below":a=e.activeCellIndex+1;break;case"belowSelected":e.widgets.forEach(((t,n)=>{e.isSelectedOrActive(t)&&(a=n+1)}));break;case"above":a=e.activeCellIndex;break;case"replace":{const t=[];e.widgets.forEach(((n,o)=>{const i=!1!==n.model.sharedModel.getMetadata().deletable;e.isSelectedOrActive(n)&&i&&t.push(o)})),t.length>0&&t.reverse().forEach((e=>{s.sharedModel.deleteCell(e)})),a=t[0];break}}s.sharedModel.insertCells(a,l)})),e.activeCellIndex=d+l.length,e.deselectAll(),o&&(e.lastClipboardInteraction="paste"),v.handleState(e,i)}function n(t,n,o){const s=(0,a.findIndex)(o.widgets,((e,n)=>t.model.id===e.model.id));if(-1===s)return-1;if(!o.widgets.length)return s+1;let l=e.getHeadingInfo(t);if(t.isHidden||!(t instanceof i.MarkdownCell)||!l.isHeading)return s+1;let d,r=!1,c=0;for(d=s+1;d<o.widgets.length;d++){let t=o.widgets[d],i=e.getHeadingInfo(t);if(i.isHeading&&i.headingLevel<=l.headingLevel){d-=1;break}r&&i.isHeading&&i.headingLevel<=c&&(r=!1),n||r?t.setHidden(!0):(i.collapsed&&i.isHeading&&(r=!0,c=i.headingLevel),t.setHidden(!1))}return d===o.widgets.length?t.numberChildNodes=d-s-1:t.numberChildNodes=d-s,e.setCellCollapse(t,n),d+1}function r(e){if(!(e instanceof i.MarkdownCell))return{isHeading:!1,headingLevel:7};let t=e.headingInfo.level;return{isHeading:t>0,headingLevel:t,collapsed:e.headingCollapsed}}e.splitCell=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.deselectAll();const n=e.model,o=e.activeCellIndex,i=e.widgets[o],s=i.editor;if(!s)return;const l=s.getSelections(),a=i.model.sharedModel.getSource(),d=[0];let r=-1,c=-1;for(let e=0;e<l.length;e++)r=s.getOffsetAt(l[e].start),c=s.getOffsetAt(l[e].end),r<c?(d.push(r),d.push(c)):c<r?(d.push(c),d.push(r)):d.push(r);d.push(a.length);const h=[];for(let e=0;e+1<d.length;e++){const e=(0,u.createCell)({cell_type:i.model.sharedModel.cell_type});e.setMetadata(i.model.sharedModel.getMetadata()),h.push(e)}for(let e=0;e<h.length;e++)h[e].setSource(a.slice(d[e],d[e+1]).replace(/^\n+/,"").replace(/\n+$/,""));n.sharedModel.transact((()=>{n.sharedModel.deleteCell(o),n.sharedModel.insertCells(o,h)}));const g=r!==c?2:1;e.activeCellIndex=o+h.length-g,e.scrollToItem(e.activeCellIndex).then((()=>{var t;null===(t=e.activeCell)||void 0===t||t.editor.focus()})).catch((e=>{})),v.handleState(e,t)},e.mergeCells=function(e,t=!1){if(!e.model||!e.activeCell)return;const n=v.getState(e),o=[],s=[],l=e.model,a=l.cells,d=e.activeCell,r=e.activeCellIndex,c={};if(e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){o.push(t.model.sharedModel.getSource()),n!==r&&s.push(n);const e=t.model;if((0,i.isRawCellModel)(e)||(0,i.isMarkdownCellModel)(e))for(const t of e.attachments.keys)c[t]=e.attachments.get(t).toJSON()}})),1===o.length)if(!0===t){if(0===r)return;const e=a.get(r-1);o.unshift(e.sharedModel.getSource()),s.push(r-1)}else if(!1===t){if(r===a.length-1)return;const e=a.get(r+1);o.push(e.sharedModel.getSource()),s.push(r+1)}e.deselectAll();const h=d.model.sharedModel,g=(0,u.createCell)({cell_type:h.cell_type,metadata:h.getMetadata(),source:o.join("\n\n")});"markdown"!==h.cell_type&&"raw"!==h.cell_type||g.setAttachments(c),l.sharedModel.transact((()=>{l.sharedModel.deleteCell(r),l.sharedModel.insertCell(r,g),s.sort(((e,t)=>t-e)).forEach((e=>{l.sharedModel.deleteCell(e)}))})),d instanceof i.MarkdownCell&&(e.activeCell.rendered=!1),v.handleState(e,n)},e.deleteCells=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);v.deleteCells(e),v.handleState(e,t,!0)},e.insertAbove=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e),n=e.model,o=u.createCell({cell_type:e.notebookConfig.defaultCell}),i=e.activeCellIndex;n.sharedModel.insertCell(i,o),e.activeCellIndex=i,e.deselectAll(),v.handleState(e,t,!0)},e.insertBelow=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e),n=e.model,o=u.createCell({cell_type:e.notebookConfig.defaultCell});n.sharedModel.insertCell(e.activeCellIndex+1,o),e.activeCellIndex++,e.deselectAll(),v.handleState(e,t,!0)},e.moveDown=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e),n=e.model.cells,o=e.widgets;for(let t=n.length-2;t>-1;t--)if(e.isSelectedOrActive(o[t])&&!e.isSelectedOrActive(o[t+1])){const n=e.activeCellIndex;e.moveCell(t,t+1),n===t&&(e.activeCellIndex=n+1),e.select(o[t+1]),e.deselect(o[t])}v.handleState(e,t,!0)},e.moveUp=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e),n=e.model.cells,o=e.widgets;for(let t=1;t<n.length;t++)e.isSelectedOrActive(o[t])&&(e.isSelectedOrActive(o[t-1])||(e.moveCell(t,t-1),e.activeCellIndex===t&&e.activeCellIndex--,e.select(o[t-1]),e.deselect(o[t])));v.handleState(e,t,!0)},e.changeCellType=function(e,t){if(!e.model||!e.activeCell)return;const n=v.getState(e);v.changeCellType(e,t),v.handleState(e,n)},e.run=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=v.getState(e),o=v.runSelected(e,t);return v.handleRunState(e,n,!1),o},e.runAndAdvance=async function(e,t){var n;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=v.getState(e),i=v.runSelected(e,t),l=e.model;if(e.activeCellIndex===e.widgets.length-1){const t=u.createCell({cell_type:e.notebookConfig.defaultCell});l.sharedModel.insertCell(e.widgets.length,t),e.activeCellIndex++,!1===(null===(n=e.activeCell)||void 0===n?void 0:n.inViewport)&&await(0,s.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit"}else e.activeCellIndex++;return v.handleRunState(e,o,!0),i},e.runAndInsert=async function(e,t){var n;if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=v.getState(e),i=v.runSelected(e,t),l=e.model,a=u.createCell({cell_type:e.notebookConfig.defaultCell});return l.sharedModel.insertCell(e.activeCellIndex+1,a),e.activeCellIndex++,!1===(null===(n=e.activeCell)||void 0===n?void 0:n.inViewport)&&await(0,s.signalToPromise)(e.activeCell.inViewportChanged,200).catch((()=>{})),e.mode="edit",v.handleRunState(e,o,!0),i},e.runAll=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=v.getState(e);e.widgets.forEach((t=>{e.select(t)}));const o=v.runSelected(e,t);return v.handleRunState(e,n,!0),o},e.renderAllMarkdown=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=e.activeCellIndex,o=v.getState(e);if(e.widgets.forEach(((t,n)=>{"markdown"===t.model.type&&(e.select(t),e.activeCellIndex=n)})),"markdown"!==e.activeCell.model.type)return Promise.resolve(!0);const i=v.runSelected(e,t);return e.activeCellIndex=n,v.handleRunState(e,o,!0),i},e.runAllAbove=function(e,t){const{activeCell:n,activeCellIndex:o,model:i}=e;if(!i||!n||o<1)return Promise.resolve(!1);const s=v.getState(e);e.activeCellIndex--,e.deselectAll();for(let t=0;t<e.activeCellIndex;++t)e.select(e.widgets[t]);const l=v.runSelected(e,t);return e.activeCellIndex++,v.handleRunState(e,s,!0),l},e.runAllBelow=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=v.getState(e);e.deselectAll();for(let t=e.activeCellIndex;t<e.widgets.length;++t)e.select(e.widgets[t]);const o=v.runSelected(e,t);return v.handleRunState(e,n,!0),o},e.replaceSelection=function(e,t){var n,o,i;e.model&&(null===(n=e.activeCell)||void 0===n?void 0:n.editor)&&(null===(i=(o=e.activeCell.editor).replaceSelection)||void 0===i||i.call(o,t))},e.selectAbove=function(e){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;let t=e.activeCellIndex-1;for(;t>=0;){const n=e.widgets[t];if(!n.inputHidden&&!n.isHidden)break;t-=1}const n=v.getState(e);e.activeCellIndex=t,e.deselectAll(),v.handleState(e,n,!0)},e.selectBelow=function(e){if(!e.model||!e.activeCell)return;let t=e.widgets.length-1;for(;e.widgets[t].isHidden||e.widgets[t].inputHidden;)t-=1;if(e.activeCellIndex===t)return;let n=e.activeCellIndex+1;for(;n<t;){let t=e.widgets[n];if(!t.inputHidden&&!t.isHidden)break;n+=1}const o=v.getState(e);e.activeCellIndex=n,e.deselectAll(),v.handleState(e,o,!0)},e.insertSameLevelHeadingAbove=async function(e){if(!e.model||!e.activeCell)return;let t=v.Headings.determineHeadingLevel(e.activeCell,e);-1==t?await v.Headings.insertHeadingAboveCellIndex(0,1,e):await v.Headings.insertHeadingAboveCellIndex(e.activeCellIndex,t,e)},e.insertSameLevelHeadingBelow=async function(e){if(!e.model||!e.activeCell)return;let t=v.Headings.determineHeadingLevel(e.activeCell,e);t=t>-1?t:1;let n=v.Headings.findLowerEqualLevelHeadingBelow(e.activeCell,e,!0);await v.Headings.insertHeadingAboveCellIndex(-1==n?e.model.cells.length:n,t,e)},e.selectHeadingAboveOrCollapseHeading=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);let o=r(e.activeCell);if(o.isHeading&&!o.collapsed)n(e.activeCell,!0,e);else{let t=v.Headings.findLowerEqualLevelParentHeadingAbove(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),v.handleState(e,t,!0)},e.selectHeadingBelowOrExpandHeading=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);let o=r(e.activeCell);if(o.isHeading&&o.collapsed)n(e.activeCell,!1,e);else{let t=v.Headings.findHeadingBelow(e.activeCell,e,!0);t>-1&&(e.activeCellIndex=t)}e.deselectAll(),v.handleState(e,t,!0)},e.extendSelectionAbove=function(e,t=!1){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;const n=v.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(0):e.extendContiguousSelectionTo(e.activeCellIndex-1),v.handleState(e,n,!0)},e.extendSelectionBelow=function(e,t=!1){if(!e.model||!e.activeCell)return;if(e.activeCellIndex===e.widgets.length-1)return;const n=v.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(e.widgets.length-1):e.extendContiguousSelectionTo(e.activeCellIndex+1),v.handleState(e,n,!0)},e.selectAll=function(e){e.model&&e.activeCell&&e.widgets.forEach((t=>{e.select(t)}))},e.deselectAll=function(e){e.model&&e.activeCell&&e.deselectAll()},e.copy=function(e){v.copyOrCut(e,!1)},e.cut=function(e){v.copyOrCut(e,!0)},e.paste=function(e,n="below"){const i=o.Clipboard.getInstance();i.hasData(g)&&t(e,n,i.getData(g),!0)},e.duplicate=function(e,n="below"){const o=v.selectedCells(e);o&&0!==o.length&&t(e,n,o,!1)},e.undo=function(e){if(!e.model)return;const t=v.getState(e);e.mode="command",e.model.sharedModel.undo(),e.deselectAll(),v.handleState(e,t)},e.redo=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.mode="command",e.model.sharedModel.redo(),e.deselectAll(),v.handleState(e,t)},e.toggleAllLineNumbers=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e),n=e.editorConfig,o=!(n.code.lineNumbers&&n.markdown.lineNumbers&&n.raw.lineNumbers),i={code:{...n.code,lineNumbers:o},markdown:{...n.markdown,lineNumbers:o},raw:{...n.raw,lineNumbers:o}};e.editorConfig=i,v.handleState(e,t)},e.clearOutputs=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);let n=-1;for(const t of e.model.cells){const o=e.widgets[++n];e.isSelectedOrActive(o)&&"code"===t.type&&(t.clearExecution(),o.outputHidden=!1)}v.handleState(e,t,!0)},e.clearAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);let n=-1;for(const t of e.model.cells){const o=e.widgets[++n];"code"===t.type&&(t.clearExecution(),o.outputHidden=!1)}v.handleState(e,t,!0)},e.hideCode=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!0)})),v.handleState(e,t)},e.showCode=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!1)})),v.handleState(e,t)},e.hideAllCode=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!0)})),v.handleState(e,t)},e.showAllCode=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!1)})),v.handleState(e,t)},e.hideOutput=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!0)})),v.handleState(e,t,!0)},e.showOutput=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!1)})),v.handleState(e,t)},e.hideAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!0)})),v.handleState(e,t,!0)},e.renderSideBySide=function(e){e.renderingLayout="side-by-side"},e.renderDefault=function(e){e.renderingLayout="default"},e.showAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!1)})),v.handleState(e,t)},e.enableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!0)})),v.handleState(e,t,!0)},e.disableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=v.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!1)})),v.handleState(e,t)},e.selectLastRunCell=function(e){let t=null,n=null;e.widgets.forEach(((e,o)=>{if("code"===e.model.type){const i=e.model.metadata.get("execution");if(i&&d.JSONExt.isObject(i)&&void 0!==i["iopub.status.busy"]){const e=i["iopub.status.busy"].toString();if(e){const i=new Date(e);(!t||i>=t)&&(t=i,n=o)}}}})),null!==n&&(e.activeCellIndex=n)},e.setMarkdownHeader=function(e,t){if(!e.model||!e.activeCell)return;const n=v.getState(e),o=e.model.cells;t=Math.min(Math.max(t,1),6),e.widgets.forEach(((n,i)=>{e.isSelectedOrActive(n)&&v.setMarkdownHeader(o.get(i),t)})),v.changeCellType(e,"markdown"),v.handleState(e,n)},e.collapseAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!0,t),e.setCellCollapse(n,!0))},e.expandAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!1,t),e.setCellCollapse(n,!1))},e.expandParent=function e(t,o){let i=function(e,t){const n=(0,a.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return;if(n>=t.widgets.length)return;let o=r(t.widgets[n]);for(let e=n-1;e>=0;e--)if(e<t.widgets.length){let n=r(t.widgets[e]);if(n.isHeading&&n.headingLevel<o.headingLevel)return t.widgets[e]}}(t,o);i&&(r(i).collapsed||i.isHidden)&&(i.isHidden&&e(i,o),r(i).collapsed&&n(i,!1,o))},e.findNextParentHeading=function(e,t){let n=(0,a.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return-1;let o=r(e);for(n+=1;n<t.widgets.length;n++){let e=r(t.widgets[n]);if(e.isHeading&&e.headingLevel<=o.headingLevel)return n}return t.widgets.length},e.setHeadingCollapse=n,e.toggleCurrentHeadingCollapse=function(t){if(!t.activeCell||void 0===t.activeCellIndex)return;let n=e.getHeadingInfo(t.activeCell);n.isHeading&&e.setHeadingCollapse(t.activeCell,!n.collapsed,t),t.scrollToItem(t.activeCellIndex).catch((e=>{}))},e.setCellCollapse=function(e,t){e instanceof i.MarkdownCell?e.headingCollapsed=t:e.setHidden(t)},e.getHeadingInfo=r,e.trust=function(e,t){const n=(t=t||l.nullTranslator).load("jupyterlab");if(!e.model)return Promise.resolve();const i=(0,a.every)(e.model.cells,(e=>e.trusted)),s=c.createElement("p",null,n.__("A trusted Jupyter notebook may execute hidden malicious code when you open it."),c.createElement("br",null),n.__('Selecting "Trust" will re-render this notebook in a trusted state.'),c.createElement("br",null),n.__("For more information, see")," ",c.createElement("a",{href:"https://jupyter-server.readthedocs.io/en/stable/operators/security.html",target:"_blank",rel:"noopener noreferrer"},n.__("the Jupyter security documentation")),".");return i?(0,o.showDialog)({body:n.__("Notebook is already trusted"),buttons:[o.Dialog.okButton()]}).then((()=>{})):(0,o.showDialog)({body:s,title:n.__("Trust this notebook?"),buttons:[o.Dialog.cancelButton(),o.Dialog.warnButton({label:n.__("Trust")})]}).then((t=>{if(t.button.accept&&e.model)for(const t of e.model.cells)t.trusted=!0}))}}(m||(m={})),function(e){function t(e){return{wasFocused:e.node.contains(document.activeElement),activeCell:e.activeCell}}function n(e,t,n=!1){const{activeCell:o,activeCellIndex:i}=e;(t.wasFocused||"edit"===e.mode)&&e.activate(),n&&o&&e.scrollToItem(i).catch((e=>{}))}function d(e){const t=e.model.sharedModel,n=[];e.mode="command",e.widgets.forEach(((t,o)=>{var i;const s=!1!==t.model.metadata.get("deletable");e.isSelectedOrActive(t)&&s&&(n.push(o),null===(i=e.model)||void 0===i||i.deletedCells.push(t.model.id))})),n.length>0&&(t.transact((()=>{n.reverse().forEach((e=>{t.deleteCell(e)})),t.cells.length||t.insertCell(t.cells.length,u.createCell({cell_type:e.notebookConfig.defaultCell}))})),e.activeCellIndex=n[0]-n.length+1),e.deselectAll()}let c;e.executed=new r.Signal({}),e.executionScheduled=new r.Signal({}),e.selectionExecuted=new r.Signal({}),e.getState=t,e.handleState=n,e.handleRunState=function(e,t,n=!1){var o;(t.wasFocused||"edit"===e.mode)&&e.activate(),n&&(null===(o=t.activeCell)||void 0===o?void 0:o.inputArea)&&e.scrollToItem(e.widgets.findIndex((e=>e===t.activeCell))).catch((e=>{}))},e.runSelected=function(t,n){t.mode="command";let s=t.activeCellIndex;const d=t.widgets.filter(((e,n)=>{const o=t.isSelectedOrActive(e);return o&&(s=n),o}));return t.activeCellIndex=s,t.deselectAll(),Promise.all(d.map((s=>function(t,n,s,d){var r,c,h;const g=(d=d||l.nullTranslator).load("jupyterlab");switch(n.model.type){case"markdown":n.rendered=!0,n.inputHidden=!1,e.executed.emit({notebook:t,cell:n,success:!0});break;case"code":if(s){if(s.isTerminating){(0,o.showDialog)({title:g.__("Kernel Terminating"),body:g.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(r=s.session)||void 0===r?void 0:r.path),buttons:[o.Dialog.okButton()]});break}if(s.pendingInput)return(0,o.showDialog)({title:g.__("Cell not executed due to pending input"),body:g.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[o.Dialog.okButton()]}),Promise.resolve(!1);if(s.hasNoKernel)return o.sessionContextDialogs.selectKernel(s),Promise.resolve(!1);const l=null!==(h=null===(c=t.model)||void 0===c?void 0:c.deletedCells)&&void 0!==h?h:[];return e.executionScheduled.emit({notebook:t,cell:n}),i.CodeCell.execute(n,s,{deletedCells:l,recordTiming:t.notebookConfig.recordTiming}).then((e=>{if(l.splice(0,l.length),n.isDisposed)return!1;if(!e)return!0;if("ok"===e.content.status){const o=e.content;return o.payload&&o.payload.length&&function(e,t,n){var o;const i=null===(o=e.payload)||void 0===o?void 0:o.filter((e=>"set_next_input"===e.source))[0];if(!i)return;const s=i.text;if(i.replace)return void n.model.sharedModel.setSource(s);const l=u.createCell({cell_type:"code"}),d=t.model.sharedModel,r=t.model.cells,c=(0,a.findIndex)(r,(e=>e===n.model));l.setSource(s),-1===c?d.insertCell(d.cells.length,l):d.insertCell(c+1,l)}(o,t,n),!0}throw new C(e.content)})).catch((o=>{if(n.isDisposed||o.message.startsWith("Canceled"))return!1;throw e.executed.emit({notebook:t,cell:n,success:!1,error:o}),o})).then((o=>(o&&e.executed.emit({notebook:t,cell:n,success:!0}),o)))}n.model.clearExecution()}return Promise.resolve(!0)}(t,s,n)))).then((n=>!t.isDisposed&&(e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[s]}),t.update(),n.every((e=>e))))).catch((n=>{if(!n.message.startsWith("KernelReplyNotOK"))throw n;return d.map((e=>{"code"===e.model.type&&null==e.model.executionCount&&e.setPrompt("")})),e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[s]}),t.update(),!1}))},e.selectedCells=function(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>(void 0!==e.metadata.deletable&&delete e.metadata.deletable,e)))},e.copyOrCut=function(i,s){if(!i.model||!i.activeCell)return;const l=t(i),a=o.Clipboard.getInstance();i.mode="command",a.clear();const r=e.selectedCells(i);a.setData(g,r),s?d(i):i.deselectAll(),i.lastClipboardInteraction=s?"cut":"copy",n(i,l)},e.changeCellType=function(e,t){const n=e.model.sharedModel;e.widgets.forEach(((o,i)=>{n.transact((()=>{if(e.isSelectedOrActive(o)&&o.model.type!==t){const e=u.createCell({cell_type:t});e.setSource(o.model.sharedModel.getSource()),e.setMetadata(o.model.sharedModel.getMetadata()),n.deleteCell(i),n.insertCell(i,e)}})),"markdown"===t&&((o=e.widgets[i]).rendered=!1)})),e.deselectAll()},e.deleteCells=d,e.setMarkdownHeader=function(e,t){let n=e.sharedModel.getSource();const o=Array(t+1).join("#")+" ",i=/^(#+\s*)|^(\s*)/.exec(n);i&&(n=n.slice(i[0].length)),e.sharedModel.setSource(o+n)},function(t){function n(e,t,n=!1,o=!1){let i=t.widgets.indexOf(e)-(n?1:0);for(;i>=0;){if(m.getHeadingInfo(t.widgets[i]).isHeading)return o?i:t.widgets[i];i--}return o?-1:null}t.findParentHeading=n,t.findLowerEqualLevelParentHeadingAbove=function(t,n,o=!1){let i=e.Headings.determineHeadingLevel(t,n);-1==i&&(i=1);let s=n.widgets.indexOf(t)-1;for(;s>=0;){let e=n.widgets[s],t=m.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=i)return o?s:e;s--}return o?-1:null},t.findLowerEqualLevelHeadingBelow=function(t,n,o=!1){let i=e.Headings.determineHeadingLevel(t,n);-1==i&&(i=1);let s=n.widgets.indexOf(t)+1;for(;s<n.widgets.length;){let e=n.widgets[s],t=m.getHeadingInfo(e);if(t.isHeading&&t.headingLevel<=i)return o?s:e;s++}return o?-1:null},t.findHeadingBelow=function(e,t,n=!1){let o=t.widgets.indexOf(e)+1;for(;o<t.widgets.length;){let e=t.widgets[o];if(m.getHeadingInfo(e).isHeading)return n?o:e;o++}return n?-1:null},t.determineHeadingLevel=function(e,t){let o=m.getHeadingInfo(e);if(o.isHeading)return o.headingLevel;{let o=n(e,t,!0);return null==o?-1:m.getHeadingInfo(o).headingLevel}},t.insertHeadingAboveCellIndex=async function(t,n,o){var i;const l=e.getState(o),a=o.model,d=a.sharedModel,r=u.createCell({cell_type:"markdown"});d.insertCell(t,r),e.setMarkdownHeader(a.cells.get(t),n),o.activeCellIndex=t,!1===(null===(i=o.activeCell)||void 0===i?void 0:i.inViewport)&&await(0,s.signalToPromise)(o.activeCell.inViewportChanged,200).catch((()=>{})),o.deselectAll(),e.handleState(o,l,!0),o.mode="edit",o.widgets[t].setHidden(!1)}}(c=e.Headings||(e.Headings={}))}(v||(v={}));var p,f=n(26629);!function(e){function t(e,t){const n=(t||l.nullTranslator).load("jupyterlab");function i(){if(e.context.model.readOnly)return(0,o.showDialog)({title:n.__("Cannot Save"),body:n.__("Document is read-only"),buttons:[o.Dialog.okButton()]});e.context.save().then((()=>{if(!e.isDisposed)return e.context.createCheckpoint()}))}return(0,f.addToolbarButtonClass)(f.ReactWidget.create(c.createElement(f.UseSignal,{signal:e.context.fileChanged},(()=>c.createElement(f.ToolbarButtonComponent,{icon:f.saveIcon,onClick:i,tooltip:n.__("Save the notebook contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}function n(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.addIcon,onClick:()=>{m.insertBelow(e.content)},tooltip:n.__("Insert a cell below")})}function i(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.cutIcon,onClick:()=>{m.cut(e.content)},tooltip:n.__("Cut the selected cells")})}function s(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.copyIcon,onClick:()=>{m.copy(e.content)},tooltip:n.__("Copy the selected cells")})}function a(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.pasteIcon,onClick:()=>{m.paste(e.content)},tooltip:n.__("Paste cells from the clipboard")})}function d(e,t){const n=(t||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.runIcon,onClick:()=>{m.runAndAdvance(e.content,e.sessionContext)},tooltip:n.__("Run the selected cells and advance")})}function r(e,t,n){const i=(n||l.nullTranslator).load("jupyterlab");return new f.ToolbarButton({icon:f.fastForwardIcon,onClick:()=>{(null!=t?t:o.sessionContextDialogs).restart(e.sessionContext,n).then((t=>(t&&m.runAll(e.content,e.sessionContext),t)))},tooltip:i.__("Restart the kernel, then re-run the whole notebook")})}function h(e,t){return new _(e.content,t)}e.createSaveButton=t,e.createInsertButton=n,e.createCutButton=i,e.createCopyButton=s,e.createPasteButton=a,e.createRunButton=d,e.createRestartRunAllButton=r,e.createCellTypeItem=h,e.getDefaultItems=function(e,l,c){return[{name:"save",widget:t(e,c)},{name:"insert",widget:n(e,c)},{name:"cut",widget:i(e,c)},{name:"copy",widget:s(e,c)},{name:"paste",widget:a(e,c)},{name:"run",widget:d(e,c)},{name:"interrupt",widget:o.Toolbar.createInterruptButton(e.sessionContext,c)},{name:"restart",widget:o.Toolbar.createRestartButton(e.sessionContext,l,c)},{name:"restart-and-run",widget:r(e,l,c)},{name:"cellType",widget:h(e,c)},{name:"spacer",widget:f.Toolbar.createSpacerItem()},{name:"kernelName",widget:o.Toolbar.createKernelNameItem(e.sessionContext,l,c)}]}}(p||(p={}));class _ extends f.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{"-"!==e.target.value&&(m.changeCellType(this._notebook,e.target.value),this._notebook.activate())},this.handleKeyDown=e=>{13===e.keyCode&&this._notebook.activate()},this._trans=(t||l.nullTranslator).load("jupyterlab"),this.addClass("jp-Notebook-toolbarCellType"),this._notebook=e,e.model&&this.update(),e.activeCellChanged.connect(this.update,this),e.selectionChanged.connect(this.update,this)}render(){let e="-";this._notebook.activeCell&&(e=this._notebook.activeCell.model.type);for(const t of this._notebook.widgets)if(this._notebook.isSelectedOrActive(t)&&t.model.type!==e){e="-";break}return c.createElement(f.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:e,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},c.createElement("option",{value:"-"},"-"),c.createElement("option",{value:"code"},this._trans.__("Code")),c.createElement("option",{value:"markdown"},this._trans.__("Markdown")),c.createElement("option",{value:"raw"},this._trans.__("Raw")))}}var w=n(27740),b=n(42081);function y(e){const t=e.translator||l.nullTranslator,n=(0,o.translateKernelStatuses)(t),i=t.load("jupyterlab"),s=e.state,a=e.displayOption.showOnToolBar,d=e.displayOption.showProgress,r=a?"down":"up",c=h().createElement("div",null);if(!s)return c;const u=s.kernelStatus,g={alignSelf:"normal",height:"24px"},C=s.totalTime,m=s.scheduledCellNumber||0,v=m-(s.scheduledCell.size||0);let p=100*v/m,_=d?"":"hidden";!d&&p<100&&(p=0);const b=e=>h().createElement(w.ProgressCircle,{progress:e,width:16,height:24}),y=e=>i.__("Kernel status: %1",e),k=(e,t,o)=>h().createElement("div",{className:"jp-Notebook-ExecutionIndicator",title:d?"":y(n[e]),"data-status":e},t,h().createElement("div",{className:`jp-Notebook-ExecutionIndicator-tooltip ${r} ${_}`},h().createElement("span",null," ",y(n[e])," "),o));if("connecting"===s.kernelStatus||"disconnected"===s.kernelStatus||"unknown"===s.kernelStatus)return k(u,h().createElement(f.offlineBoltIcon.react,{...g}),[]);if("starting"===s.kernelStatus||"terminating"===s.kernelStatus||"restarting"===s.kernelStatus||"initializing"===s.kernelStatus)return k(u,h().createElement(f.circleIcon.react,{...g}),[]);if("busy"===s.executionStatus)return k("busy",b(p),[h().createElement("span",{key:0},i.__(`Executed ${v}/${m} cells`)),h().createElement("span",{key:1},i._n("Elapsed time: %1 second","Elapsed time: %1 seconds",C))]);{const e="busy"===s.kernelStatus?0:100,t="busy"===s.kernelStatus||0===C?[]:[h().createElement("span",{key:0},i._n("Executed %1 cell","Executed %1 cells",m)),h().createElement("span",{key:1},i._n("Elapsed time: %1 second","Elapsed time: %1 seconds",C))];return k(s.kernelStatus,b(e),t)}}class k extends f.VDomRenderer{constructor(e,t=!0){super(new k.Model),this.translator=e||l.nullTranslator,this.addClass(w.interactiveItem)}render(){if(null!==this.model&&this.model.renderFlag){const e=this.model.currentNotebook;return e?h().createElement(y,{displayOption:this.model.displayOption,state:this.model.executionState(e),translator:this.translator}):h().createElement(y,{displayOption:this.model.displayOption,state:void 0,translator:this.translator})}return h().createElement("div",null)}}!function(e){class t extends f.VDomModel{constructor(){super(),this._notebookExecutionProgress=new WeakMap,this._displayOption={showOnToolBar:!0,showProgress:!0},this._renderFlag=!0}attachNotebook(e){var t,n,o,i;if(e&&e.content&&e.context){const s=e.content,l=e.context;if(this._currentNotebook=s,!this._notebookExecutionProgress.has(s)){this._notebookExecutionProgress.set(s,{executionStatus:"idle",kernelStatus:"idle",totalTime:0,interval:0,timeout:0,scheduledCell:new Set,scheduledCellNumber:0,needReset:!0});const e=this._notebookExecutionProgress.get(s),a=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};l.statusChanged.connect(a,this);const d=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};l.connectionStatusChanged.connect(d,this),l.disposed.connect((e=>{e.connectionStatusChanged.disconnect(d,this),e.statusChanged.disconnect(a,this)}));const r=(e,t)=>{const n=t.msg,o=n.header.msg_id;if("execute_request"===n.header.msg_type)this._cellScheduledCallback(s,o);else if(b.KernelMessage.isStatusMsg(n)&&"idle"===n.content.execution_state){const e=n.parent_header.msg_id;this._cellExecutedCallback(s,e)}else"execute_input"===n.header.msg_type&&this._startTimer(s)};null===(n=null===(t=l.session)||void 0===t?void 0:t.kernel)||void 0===n||n.anyMessage.connect(r),null===(i=null===(o=l.session)||void 0===o?void 0:o.kernel)||void 0===i||i.disposed.connect((e=>e.anyMessage.disconnect(r)));const c=(t,n)=>{e&&(this._resetTime(e),this.stateChanged.emit(void 0),n.newValue&&n.newValue.anyMessage.connect(r))};l.kernelChanged.connect(c),l.disposed.connect((e=>e.kernelChanged.disconnect(c)))}}}get currentNotebook(){return this._currentNotebook}get displayOption(){return this._displayOption}set displayOption(e){this._displayOption=e}executionState(e){return this._notebookExecutionProgress.get(e)}_cellExecutedCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&n.scheduledCell.has(t)&&(n.scheduledCell.delete(t),0===n.scheduledCell.size&&(window.setTimeout((()=>{n.executionStatus="idle",clearInterval(n.interval),this.stateChanged.emit(void 0)}),150),n.timeout=window.setTimeout((()=>{n.needReset=!0}),1e3)))}_startTimer(e){const t=this._notebookExecutionProgress.get(e);t&&"busy"!==t.executionStatus&&(t.executionStatus="busy",clearTimeout(t.timeout),this.stateChanged.emit(void 0),t.interval=window.setInterval((()=>{this._tick(t)}),1e3))}_cellScheduledCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&!n.scheduledCell.has(t)&&(n.needReset&&this._resetTime(n),n.scheduledCell.add(t),n.scheduledCellNumber+=1)}_tick(e){e.totalTime+=1,this.stateChanged.emit(void 0)}_resetTime(e){e.totalTime=0,e.scheduledCellNumber=0,e.executionStatus="idle",e.scheduledCell=new Set,clearTimeout(e.timeout),clearInterval(e.interval),e.needReset=!1}get renderFlag(){return this._renderFlag}updateRenderOption(e){this.displayOption.showOnToolBar&&(e.showOnToolBar?this._renderFlag=!0:this._renderFlag=!1),this.displayOption.showProgress=e.showProgress,this.stateChanged.emit(void 0)}}function n(e){let t=!0,n=!0;const o=e.get("kernelStatus").composite;return o&&(t=!o.showOnStatusBar,n=o.showProgress),{showOnToolBar:t,showProgress:n}}e.Model=t,e.createExecutionIndicatorItem=function(t,o,i){const s=new e(o);return s.model.displayOption={showOnToolBar:!0,showProgress:!0},s.model.attachNotebook({content:t.content,context:t.sessionContext}),i&&i.then((e=>{const t=e=>{s.model.updateRenderOption(n(e))};e.changed.connect(t),t(e),s.disposed.connect((()=>{e.changed.disconnect(t)}))})).catch((e=>{console.error(e.message)})),s},e.getSettingValue=n}(k||(k={}));var x=n(44897),S=n(54708);class M{constructor(e){this._isDisposed=!1,this._changed=new r.Signal(this),this._cellOrder=new S.ObservableList,this._cellMap=new S.ObservableMap,this.nbmodel=e,this._cellOrder.changed.connect(this._onOrderChanged,this),this.nbmodel.changed.connect(this.onSharedModelChanged,this),this._insertCells(0,this.nbmodel.cells)}_insertCells(e,t){const n=t.map((e=>{switch(e.cell_type){case"code":return new i.CodeCellModel({sharedModel:e});case"markdown":return new i.MarkdownCellModel({sharedModel:e});default:return new i.RawCellModel({sharedModel:e})}}));for(const t of n)this._cellMap.set(t.id,t),this._cellOrder.insert(e++,t.id);return this.length}onSharedModelChanged(e,t){var n;let o=0;null===(n=t.cellsChange)||void 0===n||n.forEach((e=>{null!=e.insert?(this._insertCells(o,e.insert),o+=e.insert.length):null!=e.delete?this._cellOrder.removeRange(o,o+e.delete):null!=e.retain&&(o+=e.retain)}))}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get isEmpty(){return 0===this._cellOrder.length}get length(){return this._cellOrder.length}*[Symbol.iterator](){for(const e of this._cellOrder)yield this._cellMap.get(e)}dispose(){if(!this._isDisposed){this._isDisposed=!0,r.Signal.clearData(this);for(const e of this._cellMap.values())e.dispose();this._cellMap.dispose(),this._cellOrder.dispose()}}get(e){return this._cellMap.get(this._cellOrder.get(e))}_onOrderChanged(e,t){const n=[],o=[];for(const e of t.newValues)n.push(this._cellMap.get(e));for(const e of t.oldValues)o.push(this._cellMap.get(e));this._changed.emit({type:t.type,oldIndex:t.oldIndex,newIndex:t.newIndex,oldValues:o,newValues:n})}}class I{constructor(e={}){var t;if(this._modelDBMutex=u.createMutex(),this._dirty=!1,this._readOnly=!1,this._contentChanged=new r.Signal(this),this._stateChanged=new r.Signal(this),this._nbformat=x.MAJOR_VERSION,this._nbformatMinor=x.MINOR_VERSION,this._isDisposed=!1,this.sharedModel=u.YNotebook.create({disableDocumentWideUndoRedo:null!==(t=e.disableDocumentWideUndoRedo)&&void 0!==t&&t,initialCellType:e.defaultCell}),this._cells=new M(this.sharedModel),this._trans=(e.translator||l.nullTranslator).load("jupyterlab"),this._cells.changed.connect(this._onCellsChanged,this),this._metadata=new S.ObservableJSON,!this._metadata.has("language_info")){const t=e.languagePreference||"";this._metadata.set("language_info",{name:t})}this._ensureMetadata(),this._metadata.changed.connect(this._onMetadataChanged,this),this._deletedCells=[],this.sharedModel.changed.connect(this._onStateChanged,this)}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this._metadata}get cells(){return this._cells}get nbformat(){return this._nbformat}get nbformatMinor(){return this._nbformatMinor}get defaultKernelName(){const e=this.metadata.get("kernelspec");return e?e.name:""}get deletedCells(){return this._deletedCells}get defaultKernelLanguage(){const e=this.metadata.get("language_info");return e?e.name:""}dispose(){if(this.isDisposed)return;const e=this.cells;this._cells=null,e.dispose(),this.sharedModel.dispose(),this._isDisposed=!0,r.Signal.clearData(this)}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){var e,t;const n=[];for(let o=0;o<(null!==(t=null===(e=this.cells)||void 0===e?void 0:e.length)&&void 0!==t?t:0);o++){const e=this.cells.get(o).toJSON();4===this._nbformat&&this._nbformatMinor<=4&&delete e.id,n.push(e)}this._ensureMetadata();const o=this.sharedModel.getMetadata();for(const e of this.metadata.keys())o[e]=JSON.parse(JSON.stringify(this.metadata.get(e)));return{metadata:o,nbformat_minor:this._nbformatMinor,nbformat:this._nbformat,cells:n}}fromJSON(e){this.sharedModel.transact((()=>{const t=4===e.nbformat&&e.nbformat_minor>=5,n=e.cells.map((e=>(t||delete e.id,u.createCell(e))));this.sharedModel.insertCells(this.sharedModel.cells.length,n),this.sharedModel.deleteCellRange(0,this.sharedModel.cells.length)})),this.sharedModel.nbformat_minor=x.MINOR_VERSION,this.sharedModel.nbformat=x.MAJOR_VERSION;const t=e.metadata.orig_nbformat;if(e.nbformat!==this._nbformat&&(this.sharedModel.nbformat=e.nbformat),e.nbformat_minor>this._nbformatMinor&&(this.sharedModel.nbformat_minor=e.nbformat_minor),void 0!==t&&this._nbformat!==t){let e;e=this._nbformat>t?this._trans.__("This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.",t,this._nbformat):this._trans.__("This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.",t,this._nbformat),(0,o.showDialog)({title:this._trans.__("Notebook converted"),body:e,buttons:[o.Dialog.okButton({label:this._trans.__("Ok")})]})}this.metadata.clear();const n=e.metadata;for(const e in n)"orig_nbformat"!==e&&this.metadata.set(e,n[e]);this._ensureMetadata(),this.dirty=!0}_onCellsChanged(e,t){switch(t.type){case"add":case"set":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}))}this.triggerContentChange()}_onStateChanged(e,t){if(t.stateChange&&t.stateChange.forEach((e=>{"dirty"===e.name&&this._dirty===e.newValue||(this._dirty=e.newValue,this.triggerStateChange(e))})),t.nbformatChanged){const e=t.nbformatChanged;"nbformat"===e.key&&void 0!==e.newValue&&(this._nbformat=e.newValue),"nbformat_minor"===e.key&&void 0!==e.newValue&&(this._nbformatMinor=e.newValue)}if(t.metadataChange){const e=t.metadataChange.newValue;this._modelDBMutex((()=>{Object.entries(e).forEach((([e,t])=>{this.metadata.set(e,t)}))}))}}_onMetadataChanged(e,t){this._modelDBMutex((()=>{this.sharedModel.updateMetadata(e.toJSON())})),this.triggerContentChange()}_ensureMetadata(){const e=this.metadata;e.has("language_info")||e.set("language_info",{name:""}),e.has("kernelspec")||e.set("kernelspec",{name:"",display_name:""})}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}get isDisposed(){return this._isDisposed}}class E{constructor(e){this._disposed=!1,this._disableDocumentWideUndoRedo=e.disableDocumentWideUndoRedo||!1}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}createNew(e){return new I({languagePreference:e,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}function A(e){const t=(e.translator||l.nullTranslator).load("jupyterlab");return c.createElement(w.TextItem,{source:t.__("Mode: %1",e.modeNames[e.notebookMode])})}class T extends f.VDomRenderer{constructor(e){super(new T.Model),this.translator=e||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._modeNames={command:this._trans.__("Command"),edit:this._trans.__("Edit")}}render(){return this.model?(this.node.title=this._trans.__("Notebook is in %1 mode",this._modeNames[this.model.notebookMode]),c.createElement(A,{notebookMode:this.model.notebookMode,translator:this.translator,modeNames:this._modeNames})):null}}!function(e){class t extends f.VDomModel{constructor(){super(...arguments),this._onChanged=e=>{const t=this._notebookMode;this._notebook?this._notebookMode=e.mode:this._notebookMode="command",this._triggerChange(t,this._notebookMode)},this._notebookMode="command",this._notebook=null}get notebookMode(){return this._notebookMode}set notebook(e){const t=this._notebook;null!==t&&(t.stateChanged.disconnect(this._onChanged,this),t.activeCellChanged.disconnect(this._onChanged,this),t.modelContentChanged.disconnect(this._onChanged,this));const n=this._notebookMode;this._notebook=e,null===this._notebook?this._notebookMode="command":(this._notebookMode=this._notebook.mode,this._notebook.stateChanged.connect(this._onChanged,this),this._notebook.activeCellChanged.connect(this._onChanged,this),this._notebook.modelContentChanged.connect(this._onChanged,this)),this._triggerChange(n,this._notebookMode)}_triggerChange(e,t){e!==t&&this.stateChanged.emit(void 0)}}e.Model=t}(T||(T={}));var N=n(47397);class P extends N.WidgetLSPAdapter{constructor(e,t){super(e,t),this.editorWidget=e,this.options=t,this._type="code",this._readyDelegate=new d.PromiseDelegate,this._editorToCell=new Map,this.editor=e.content,this._cellToEditor=new WeakMap,Promise.all([this.widget.context.sessionContext.ready,this.connectionManager.ready]).then((async()=>{await this.initOnceReady(),this._readyDelegate.resolve()})).catch(console.error)}get documentPath(){return this.widget.context.path}get mimeType(){var e;let t,n=this.language_info();return t=n&&n.mimetype?n.mimetype:this.widget.content.codeMimetype,Array.isArray(t)?null!==(e=t[0])&&void 0!==e?e:"text/plain":t}get languageFileExtension(){let e=this.language_info();if(e&&e.file_extension)return e.file_extension.replace(".","")}get wrapperElement(){return this.widget.node}get editors(){if(this.isDisposed)return[];let e=this.widget.content;return this._editorToCell.clear(),e.isDisposed?[]:e.widgets.map((e=>({ceEditor:this._getCellEditor(e),type:e.model.type,value:e.model.sharedModel.getSource()})))}get activeEditor(){return this.editor.activeCell?this._getCellEditor(this.editor.activeCell):void 0}get ready(){return this._readyDelegate.promise}getEditorIndexAt(e){let t=this._getCellAt(e);return this.widget.content.widgets.findIndex((e=>t===e))}getEditorIndex(e){let t=this._editorToCell.get(e);return this.editor.widgets.findIndex((e=>t===e))}getEditorWrapper(e){return this._editorToCell.get(e).node}async onKernelChanged(e,t){if(t.newValue)try{const e=this._languageInfo;await(0,N.untilReady)(this.isReady,-1),await this._updateLanguageInfo();const t=this._languageInfo;(null==e?void 0:e.name)!=t.name||(null==e?void 0:e.mimetype)!=(null==t?void 0:t.mimetype)||(null==e?void 0:e.file_extension)!=(null==t?void 0:t.file_extension)?(console.log(`Changed to ${this._languageInfo.name} kernel, reconnecting`),this.reloadConnection()):console.log("Keeping old LSP connection as the new kernel uses the same langauge")}catch(e){console.warn(e),this.reloadConnection()}}dispose(){this.isDisposed||(this.widget.context.sessionContext.kernelChanged.disconnect(this.onKernelChanged,this),this.widget.content.activeCellChanged.disconnect(this._activeCellChanged,this),super.dispose(),this._editorToCell.clear(),r.Signal.clearData(this))}isReady(){var e;return!this.widget.isDisposed&&this.widget.context.isReady&&this.widget.content.isVisible&&this.widget.content.widgets.length>0&&null!=(null===(e=this.widget.context.sessionContext.session)||void 0===e?void 0:e.kernel)}async handleCellChange(e,t){let n=[],o=[];const i=this._type;if("set"===t.type){let e=[],s=[];if(t.newValues.length===t.oldValues.length){for(let n=0;n<t.newValues.length;n++)t.oldValues[n].type===i&&t.newValues[n].type!==i?e.push(t.newValues[n]):t.oldValues[n].type!==i&&t.newValues[n].type===i&&s.push(t.newValues[n]);n=s,o=e}}else"add"==t.type&&(n=t.newValues.filter((e=>e.type===i)));(o.length||n.length||"set"===t.type||"move"===t.type||"remove"===t.type)&&await this.updateDocuments();for(let e of n){let t=this.widget.content.widgets.find((t=>t.model.id===e.id));t?this._getCellEditor(t):console.warn(`Widget for added cell with ID: ${e.id} not found!`)}}createVirtualDocument(){return new N.VirtualDocument({language:this.language,foreignCodeExtractors:this.options.foreignCodeExtractorsManager,path:this.documentPath,fileExtension:this.languageFileExtension,standalone:!1,hasLspSupportedFile:!1})}language_info(){return this._languageInfo}async initOnceReady(){await(0,N.untilReady)(this.isReady.bind(this),-1),await this._updateLanguageInfo(),this.initVirtual(),this.connectDocument(this.virtualDocument,!1).catch(console.warn),this.widget.context.sessionContext.kernelChanged.connect(this.onKernelChanged,this),this.widget.content.activeCellChanged.connect(this._activeCellChanged,this),this._connectModelSignals(this.widget),this.editor.modelChanged.connect((e=>{console.warn("Model changed, connecting cell change handler; this is not something we were expecting"),this._connectModelSignals(e)}))}_connectModelSignals(e){null===e.model?console.warn(`Model is missing for notebook ${e}, cannot connect cell changed signal!`):e.model.cells.changed.connect(this.handleCellChange,this)}async _updateLanguageInfo(){var e,t,n,o;const i=null===(o=await(null===(n=null===(t=null===(e=this.widget.context.sessionContext)||void 0===e?void 0:e.session)||void 0===t?void 0:t.kernel)||void 0===n?void 0:n.info))||void 0===o?void 0:o.language_info;if(!i)throw new Error("Language info update failed (no session, kernel, or info available)");this._languageInfo=i}_activeCellChanged(e,t){t&&t.model.type===this._type&&this._activeEditorChanged.emit({editor:this._getCellEditor(t)})}_getCellAt(e){let t=this.virtualDocument.getEditorAtVirtualLine(e);return this._editorToCell.get(t)}_getCellEditor(e){if(!this._cellToEditor.has(e)){const t=Object.freeze({getEditor:()=>e.editor,ready:async()=>(await e.ready,e.editor),reveal:async()=>(await this.editor.scrollToCell(e),e.editor)});this._cellToEditor.set(e,t),this._editorToCell.set(t,e),e.disposed.connect((()=>{this._cellToEditor.delete(e),this._editorToCell.delete(t),this._editorRemoved.emit({editor:t})})),this._editorAdded.emit({editor:t})}return this._cellToEditor.get(e)}}var O,D=n(65484),L=n(61768),H=n(99689),R=n(48236),B=n(19691),F=n(34340);class V extends F.Widget{constructor(){super(),this._items=[],this.layout=new F.PanelLayout,this.addClass("jp-RankedPanel")}addWidget(e,t){const n={widget:e,rank:t},o=a.ArrayExt.upperBound(this._items,n,O.itemCmp);a.ArrayExt.insert(this._items,o,n),this.layout.insertWidget(o,e)}onChildRemoved(e){const t=a.ArrayExt.findFirstIndex(this._items,(t=>t.widget===e.child));-1!==t&&a.ArrayExt.removeAt(this._items,t)}}class j extends F.Widget{constructor(e){super(),this.addClass("jp-NotebookTools"),this.translator=e.translator||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._commonTools=new V,this._advancedTools=new V,this._advancedTools.title.label=this._trans.__("Advanced Tools");const t=this.layout=new F.PanelLayout;t.addWidget(this._commonTools),t.addWidget(new f.Collapser({widget:this._advancedTools})),this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onActiveNotebookPanelChanged,this),this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this),this._tracker.selectionChanged.connect(this._onSelectionChanged,this),this._onActiveNotebookPanelChanged(),this._onActiveCellChanged(),this._onSelectionChanged()}get activeCell(){return this._tracker.activeCell}get selectedCells(){const e=this._tracker.currentWidget;if(!e)return[];const t=e.content;return t.widgets.filter((e=>t.isSelectedOrActive(e)))}get activeNotebookPanel(){return this._tracker.currentWidget}addItem(e){var t;const n=e.tool,o=null!==(t=e.rank)&&void 0!==t?t:100;let i;i="advanced"===e.section?this._advancedTools:this._commonTools,n.addClass("jp-NotebookTools-tool"),i.addWidget(n,o),n.notebookTools=this,H.MessageLoop.sendMessage(n,j.ActiveNotebookPanelMessage),H.MessageLoop.sendMessage(n,j.ActiveCellMessage)}_onActiveNotebookPanelChanged(){this._prevActiveNotebookModel&&!this._prevActiveNotebookModel.isDisposed&&this._prevActiveNotebookModel.metadata.changed.disconnect(this._onActiveNotebookPanelMetadataChanged,this);const e=this.activeNotebookPanel&&this.activeNotebookPanel.content?this.activeNotebookPanel.content.model:null;this._prevActiveNotebookModel=e,e&&e.metadata.changed.connect(this._onActiveNotebookPanelMetadataChanged,this);for(const e of this._toolChildren())H.MessageLoop.sendMessage(e,j.ActiveNotebookPanelMessage)}_onActiveCellChanged(){this._prevActiveCell&&!this._prevActiveCell.isDisposed&&this._prevActiveCell.metadata.changed.disconnect(this._onActiveCellMetadataChanged,this);const e=this.activeCell?this.activeCell.model:null;this._prevActiveCell=e,e&&e.metadata.changed.connect(this._onActiveCellMetadataChanged,this);for(const e of this._toolChildren())H.MessageLoop.sendMessage(e,j.ActiveCellMessage)}_onSelectionChanged(){for(const e of this._toolChildren())H.MessageLoop.sendMessage(e,j.SelectionMessage)}_onActiveNotebookPanelMetadataChanged(e,t){const n=new S.ObservableJSON.ChangeMessage("activenotebookpanel-metadata-changed",t);for(const e of this._toolChildren())H.MessageLoop.sendMessage(e,n)}_onActiveCellMetadataChanged(e,t){const n=new S.ObservableJSON.ChangeMessage("activecell-metadata-changed",t);for(const e of this._toolChildren())H.MessageLoop.sendMessage(e,n)}*_toolChildren(){yield*this._commonTools.children(),yield*this._advancedTools.children()}}!function(e){e.ActiveNotebookPanelMessage=new H.ConflatableMessage("activenotebookpanel-changed"),e.ActiveCellMessage=new H.ConflatableMessage("activecell-changed"),e.SelectionMessage=new H.ConflatableMessage("selection-changed");class t extends F.Widget{dispose(){super.dispose(),this.notebookTools&&(this.notebookTools=null)}processMessage(e){switch(super.processMessage(e),e.type){case"activenotebookpanel-changed":this.onActiveNotebookPanelChanged(e);break;case"activecell-changed":this.onActiveCellChanged(e);break;case"selection-changed":this.onSelectionChanged(e);break;case"activecell-metadata-changed":this.onActiveCellMetadataChanged(e);break;case"activenotebookpanel-metadata-changed":this.onActiveNotebookPanelMetadataChanged(e)}}onActiveNotebookPanelChanged(e){}onActiveCellChanged(e){}onSelectionChanged(e){}onActiveCellMetadataChanged(e){}onActiveNotebookPanelMetadataChanged(e){}}e.Tool=t,e.ActiveCellTool=class extends t{constructor(){super(),this.addClass("jp-ActiveCellTool"),this.layout=new F.PanelLayout,this._inputPrompt=new i.InputPrompt,this.layout.addWidget(this._inputPrompt);const e=document.createElement("div");e.classList.add("jp-ActiveCell-Content");const t=e.appendChild(document.createElement("div")),n=t.appendChild(document.createElement("pre"));t.className="jp-Cell-Content",this._editorEl=n,this.layout.addWidget(new F.Widget({node:e})),this._refreshDebouncer=new B.Debouncer((async()=>{var e,t,n;if(this._editorEl.innerHTML="","code"===(null===(e=this._cellModel)||void 0===e?void 0:e.type)?(this._inputPrompt.executionCount=`${null!==(t=this._cellModel.executionCount)&&void 0!==t?t:""}`,this._inputPrompt.show()):(this._inputPrompt.executionCount=null,this._inputPrompt.hide()),this._cellModel){const e=await L.Mode.ensure(null!==(n=L.Mode.findByMIME(this._cellModel.mimeType))&&void 0!==n?n:"text/plain");L.Mode.run(this._cellModel.sharedModel.getSource().split("\n")[0],e,this._editorEl)}}),150)}async onActiveCellChanged(){const e=this.notebookTools.activeCell;if(this._cellModel&&!this._cellModel.isDisposed&&(this._cellModel.sharedModel.changed.disconnect(this.refresh,this),this._cellModel.mimeTypeChanged.disconnect(this.refresh,this)),!e)return void(this._cellModel=null);const t=this._cellModel=e.model;t.sharedModel.changed.connect(this.refresh,this),t.mimeTypeChanged.connect(this.refresh,this),await this.refresh()}async refresh(){await this._refreshDebouncer.invoke()}};class n extends t{constructor(e){super();const{editorFactory:t}=e;this.addClass("jp-MetadataEditorTool");const n=this.layout=new F.PanelLayout;this.editor=new D.JSONEditor({editorFactory:t}),this.editor.title.label=e.label||"Edit Metadata";const o=new F.Widget({node:document.createElement("label")});o.node.textContent=e.label||"Edit Metadata",n.addWidget(o),n.addWidget(this.editor)}}e.MetadataEditorTool=n,e.NotebookMetadataEditorTool=class extends n{constructor(e){const t=(e.translator||l.nullTranslator).load("jupyterlab");e.label=e.label||t.__("Notebook Metadata"),super(e)}onActiveNotebookPanelChanged(e){this._update()}onActiveNotebookPanelMetadataChanged(e){this._update()}_update(){var e,t;const n=this.notebookTools.activeNotebookPanel&&this.notebookTools.activeNotebookPanel.content;this.editor.source=null!==(t=null===(e=null==n?void 0:n.model)||void 0===e?void 0:e.metadata)&&void 0!==t?t:null}},e.CellMetadataEditorTool=class extends n{constructor(e){const t=(e.translator||l.nullTranslator).load("jupyterlab");e.label=e.label||t.__("Cell Metadata"),super(e)}onActiveCellChanged(e){this._update()}onActiveCellMetadataChanged(e){this._update()}_update(){const e=this.notebookTools.activeCell;this.editor.source=e?e.model.metadata:null}};class o extends t{constructor(e){super({node:O.createSelectorNode(e)}),this._getValue=e=>{let t=e.model.metadata.get(this.key);return void 0===t&&(t=this._default),t},this._setValue=(e,t)=>{t===this._default?e.model.metadata.delete(this.key):e.model.metadata.set(this.key,t)},this._changeGuard=!1,this.addClass("jp-KeySelector"),this.key=e.key,this._default=e.default,this._validCellTypes=e.validCellTypes||[],this._getter=e.getter||this._getValue,this._setter=e.setter||this._setValue}get selectNode(){return this.node.getElementsByTagName("select")[0]}handleEvent(e){"change"===e.type&&this.onValueChanged()}onAfterAttach(e){this.selectNode.addEventListener("change",this)}onBeforeDetach(e){this.selectNode.removeEventListener("change",this)}onActiveCellChanged(e){const t=this.selectNode,n=this.notebookTools.activeCell;if(!n)return t.disabled=!0,void(t.value="");const o=n.model.type;if(this._validCellTypes.length&&-1===this._validCellTypes.indexOf(o))return t.value="",void(t.disabled=!0);t.disabled=!1,this._changeGuard=!0;const i=this._getter;t.value=JSON.stringify(i(n)),this._changeGuard=!1}onActiveCellMetadataChanged(e){if(this._changeGuard)return;const t=this.selectNode,n=this.notebookTools.activeCell;if(e.args.key===this.key&&n){this._changeGuard=!0;const e=this._getter;t.value=JSON.stringify(e(n)),this._changeGuard=!1}}onValueChanged(){const e=this.notebookTools.activeCell;if(!e||this._changeGuard)return;this._changeGuard=!0;const t=this.selectNode;(0,this._setter)(e,JSON.parse(t.value)),this._changeGuard=!1}}e.KeySelector=o;class s extends t{constructor(e){super({node:O.createInputNode({label:e.label,value:"1"})}),this.addClass("jp-NumberSetter"),this._key=e.key}get inputNode(){return this.node.getElementsByTagName("input")[0]}handleEvent(e){switch(e.type){case"change":case"input":this.onValueChanged()}}onAfterAttach(e){const t=this.inputNode;t.addEventListener("change",this),t.addEventListener("input",this)}onBeforeDetach(e){const t=this.inputNode;t.removeEventListener("change",this),t.removeEventListener("input",this)}onActiveNotebookPanelChanged(e){this._update()}onActiveNotebookPanelMetadataChanged(e){this._update()}onValueChanged(){var e,t,n,o;const i=this.notebookTools.activeNotebookPanel&&this.notebookTools.activeNotebookPanel.content,s=null!==(t=null===(e=null==i?void 0:i.model)||void 0===e?void 0:e.metadata)&&void 0!==t?t:null;if(s){const e=this._key.split("/"),t={...null!==(n=s.get(e[0]))&&void 0!==n?n:{}};let i=t;for(let t=1;t<e.length-1;t++)void 0===i[e[t]]&&(i[e[t]]={}),i=i[e[t]];i[e[e.length-1]]=null!==(o=this.inputNode.valueAsNumber)&&void 0!==o?o:1,s.set(e[0],t)}}_update(){var e,t;const n=this.notebookTools.activeNotebookPanel&&this.notebookTools.activeNotebookPanel.content,o=null!==(t=null===(e=null==n?void 0:n.model)||void 0===e?void 0:e.metadata)&&void 0!==t?t:null;if(o){const e=this._key.split("/");let t=o.get(e[0]);for(let n=1;n<e.length;n++)t=(null!=t?t:{})[e[n]];this.inputNode.valueAsNumber=void 0!==t?t:1}}}e.NotebookMetadataNumberTool=s,e.createSlideShowSelector=function(e){const t=(e=e||l.nullTranslator).load("jupyterlab");t.__("");const n={key:"slideshow",title:t.__("Slide Type"),optionValueArray:[["-",null],[t.__("Slide"),"slide"],[t.__("Sub-Slide"),"subslide"],[t.__("Fragment"),"fragment"],[t.__("Skip"),"skip"],[t.__("Notes"),"notes"]],getter:e=>{const t=e.model.metadata.get("slideshow");return t&&t.slide_type},setter:(e,t)=>{let n=e.model.metadata.get("slideshow")||Object.create(null);null===t?(n={...n},delete n.slide_type):n={...n,slide_type:t},Object.keys(n).length>0?e.model.metadata.set("slideshow",n):e.model.metadata.delete("slideshow")}};return new o(n)},e.createNBConvertSelector=function(e,t){const n=(t=t||l.nullTranslator).load("jupyterlab");return new o({key:"raw_mimetype",title:n.__("Raw NBConvert Format"),optionValueArray:e,validCellTypes:["raw"]})},e.createEditableToggle=function(e){const t=(e=e||l.nullTranslator).load("jupyterlab");return new o({key:"editable",title:t.__("Editable"),optionValueArray:[[t.__("Editable"),!0],[t.__("Read-Only"),!1]],default:!0})},e.createToCBaseNumbering=function(e){const t=(e=e||l.nullTranslator).load("jupyterlab");return new s({key:"toc/base_numbering",label:t.__("Table of content - Base number")})}}(j||(j={})),function(e){e.itemCmp=function(e,t){return e.rank-t.rank},e.createSelectorNode=function(e){const t=e.key,n=e.title||t[0].toLocaleUpperCase()+t.slice(1),o=[];let i,s;for(const t of e.optionValueArray){s=t[0],i=JSON.stringify(t[1]);const n=e.default==t[1]?{value:i,selected:"selected"}:{value:i};o.push(R.h.option(n,s))}const l=R.VirtualDOM.realize(R.h.div({},R.h.label(n,R.h.select({},o))));return f.Styling.styleNode(l),l},e.createInputNode=function(e){const t=e.label,n=R.VirtualDOM.realize(R.h.div({},R.h.label(t,R.h.input({value:e.value,type:"number"}))));return f.Styling.styleNode(n),n}}(O||(O={}));var W=n(54483),U=n(11813),q=n(91090),K=n(66375),J=n(6287);const z="jp-mod-dropTarget",$="jp-mod-dropSource";class G extends f.WindowedListModel{constructor(e,t){super(t),this.cells=e,this.estimateWidgetSize=e=>{const t=this.cells[e].model.sharedModel.getSource().split("\n").length;return G.DEFAULT_EDITOR_LINE_HEIGHT*t+G.DEFAULT_CELL_MARGIN},this.widgetRenderer=e=>this.cells[e],this._estimatedWidgetSize=G.DEFAULT_CELL_SIZE}}G.DEFAULT_CELL_SIZE=39,G.DEFAULT_EDITOR_LINE_HEIGHT=17,G.DEFAULT_CELL_MARGIN=22;class Y extends f.WindowedLayout{constructor(){super(...arguments),this._willBeRemoved=null,this._topHiddenCodeCells=-1}removeWidget(e){const t=this.widgets.indexOf(e);t>=0?this.removeWidgetAt(t):e===this._willBeRemoved&&this.parent&&this.detachWidget(t,e)}attachWidget(e,t){const n=t.isPlaceholder();if(this.parent.isAttached&&H.MessageLoop.sendMessage(t,F.Widget.Msg.BeforeAttach),!n&&t instanceof i.CodeCell&&t.node.parentElement)t.node.style.display="",this._topHiddenCodeCells=-1;else{const e=this._findNearestChildBinarySearch(this.parent.viewportNode.childElementCount-1,0,parseInt(t.dataset.windowedListIndex,10)+1);let n=this.parent.viewportNode.children[e];this.parent.viewportNode.insertBefore(t.node,n),this.parent.isAttached&&H.MessageLoop.sendMessage(t,F.Widget.Msg.AfterAttach)}t.inViewport=!0}detachWidget(e,t){t.inViewport=!1,t instanceof i.CodeCell&&!t.node.classList.contains($)&&t!==this._willBeRemoved?(t.node.style.display="none",this._topHiddenCodeCells=-1):(this.parent.isAttached&&H.MessageLoop.sendMessage(t,F.Widget.Msg.BeforeDetach),this.parent.viewportNode.removeChild(t.node),t.node.classList.remove(z)),this.parent.isAttached&&H.MessageLoop.sendMessage(t,F.Widget.Msg.AfterDetach)}moveWidget(e,t,n){if(this._topHiddenCodeCells<0){this._topHiddenCodeCells=0;for(let e=0;e<this.parent.viewportNode.children.length&&"none"==this.parent.viewportNode.children[e].style.display;e++)this._topHiddenCodeCells++}const o=this.parent.viewportNode.children[t+this._topHiddenCodeCells];e<t?o.insertAdjacentElement("afterend",n.node):o.insertAdjacentElement("beforebegin",n.node)}onChildRemoved(e){this._willBeRemoved=e.child,super.onChildRemoved(e),this._willBeRemoved=null}_findNearestChildBinarySearch(e,t,n){for(;t<=e;){const o=t+Math.floor((e-t)/2),i=parseInt(this.parent.viewportNode.children[o].dataset.windowedListIndex,10);if(i===n)return o;i<n?t=o+1:i>n&&(e=o-1)}return t>0?t:0}}const Q="jp-Notebook-cell",X="jp-mod-editMode",Z="jp-mod-commandMode",ee="jp-mod-active",te="jp-mod-selected",ne="jp-mod-multiSelected",oe="jp-dragImage",ie="jp-dragImage-content",se="jp-dragImage-prompt",le="jp-dragImage-multipleBack",ae="application/vnd.jupyter.cells",de="jp-mod-sideBySide";void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(e){let t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},window.cancelIdleCallback=function(e){clearTimeout(e)});class re extends f.WindowedList{constructor(e){var t,n,o,i,s;const a=new Array;super({model:new G(a,{overscanCount:null!==(n=null===(t=e.notebookConfig)||void 0===t?void 0:t.overscanCount)&&void 0!==n?n:re.defaultNotebookConfig.overscanCount,windowingActive:"full"===(null!==(i=null===(o=e.notebookConfig)||void 0===o?void 0:o.windowingMode)&&void 0!==i?i:re.defaultNotebookConfig.windowingMode)}),layout:new Y}),this._cellCollapsed=new r.Signal(this),this._cellInViewportChanged=new r.Signal(this),this._renderingLayoutChanged=new r.Signal(this),this.addClass("jp-Notebook"),this.cellsArray=a,this._idleCallBack=null,this._editorConfig=re.defaultEditorConfig,this._notebookConfig=re.defaultNotebookConfig,this._mimetype="text/plain",this._notebookModel=null,this._modelChanged=new r.Signal(this),this._modelContentChanged=new r.Signal(this),this.node.dataset.jpKernelUser="true",this.node.dataset.jpUndoer="true",this.node.dataset.jpCodeRunner="true",this.rendermime=e.rendermime,this.translator=e.translator||l.nullTranslator,this.contentFactory=e.contentFactory||re.defaultContentFactory,this.editorConfig=e.editorConfig||re.defaultEditorConfig,this.notebookConfig=e.notebookConfig||re.defaultNotebookConfig,this._updateNotebookConfig(),this._mimetypeService=e.mimeTypeService,this.renderingLayout=null===(s=e.notebookConfig)||void 0===s?void 0:s.renderingLayout}get cellCollapsed(){return this._cellCollapsed}get cellInViewportChanged(){return this._cellInViewportChanged}get modelChanged(){return this._modelChanged}get modelContentChanged(){return this._modelContentChanged}get renderingLayoutChanged(){return this._renderingLayoutChanged}get model(){return this._notebookModel}set model(e){var t;if(e=e||null,this._notebookModel===e)return;const n=this._notebookModel;this._notebookModel=e,this._onModelChanged(n,e),this.onModelChanged(n,e),this._modelChanged.emit(void 0),this.viewModel.itemsList=null!==(t=null==e?void 0:e.cells)&&void 0!==t?t:null}get codeMimetype(){return this._mimetype}get widgets(){return this.cellsArray}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e,this._updateEditorConfig()}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e,this._updateNotebookConfig()}get renderingLayout(){return this._renderingLayout}set renderingLayout(e){var t;this._renderingLayout=e,"side-by-side"===this._renderingLayout?this.node.classList.add(de):this.node.classList.remove(de),this._renderingLayoutChanged.emit(null!==(t=this._renderingLayout)&&void 0!==t?t:"default")}dispose(){this.isDisposed||(this._notebookModel=null,super.dispose())}moveCell(e,t){if(!this.model)return;const n=this.widgets[e],o={};if("markdown"===n.model.type)for(const e of["rendered","headingCollapsed"])o[e]=n[e];this.model.sharedModel.moveCell(e,t);const i=this.widgets[t];for(const e in o)i[e]=o[e]}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);t instanceof i.CodeCell&&t.isPlaceholder()&&(t.dataset.windowedListIndex=`${e}`,this.layout.insertWidget(e,t),"full"===this.notebookConfig.windowingMode&&requestAnimationFrame((()=>{this.layout.removeWidget(t)})))}onModelChanged(e,t){}onModelContentChanged(e,t){this._modelContentChanged.emit(void 0)}onMetadataChanged(e,t){"language_info"===t.key&&this._updateMimetype()}onCellInserted(e,t){}onCellMoved(e,t){}onCellRemoved(e,t){}onUpdateRequest(e){"defer"===this.notebookConfig.windowingMode?this._updateForDeferMode():super.onUpdateRequest(e)}_onModelChanged(e,t){if(e)for(e.sharedModel.changed.disconnect(this._onCellsChanged,this),e.metadata.changed.disconnect(this.onMetadataChanged,this),e.contentChanged.disconnect(this.onModelContentChanged,this);this.cellsArray.length;)this._removeCell(0);if(!t)return void(this._mimetype="text/plain");this._updateMimetype();const n=t.cells;n.length||t.sharedModel.insertCell(0,u.createCell({cell_type:this.notebookConfig.defaultCell}));let o=-1;for(const e of n)this._insertCell(++o,e,"set");t.sharedModel.changed.connect(this._onCellsChanged,this),t.contentChanged.connect(this.onModelContentChanged,this),t.metadata.changed.connect(this.onMetadataChanged,this)}_onCellsChanged(e,t){if(t.cellsChange){let n=0;t.cellsChange.forEach((t=>{if(null!=t.retain)n+=t.retain;else if(t.insert){const e=n===this.widgets.length?"push":"insert";t.insert.forEach(((t,o)=>{this._insertCell(n+o,this.model.cells.get(n+o),e)})),this._updateDataWindowedListIndex(n,this.model.cells.length,t.insert.length),n+=t.insert.length}else if(null!=t.delete){for(let e=0;e<t.delete;e++)this._removeCell(n);if(this._updateDataWindowedListIndex(n,this.model.cells.length+t.delete,-1*t.delete),!e.cells.length){const e=this.model;requestAnimationFrame((()=>{!e||e.isDisposed||e.sharedModel.cells.length||e.sharedModel.insertCell(0,u.createCell({cell_type:this.notebookConfig.defaultCell}))}))}}}))}this.update()}_insertCell(e,t,n){let o;switch(t.type){case"code":o=this._createCodeCell(t),o.model.mimeType=this._mimetype;break;case"markdown":o=this._createMarkdownCell(t),""===t.sharedModel.getSource()&&(o.rendered=!1);break;default:o=this._createRawCell(t)}o.inViewportChanged.connect(this._onCellInViewportChanged,this),o.addClass(Q),a.ArrayExt.insert(this.cellsArray,e,o),this.onCellInserted(e,o),this._scheduleCellRenderOnIdle()}_createCodeCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.code,maxNumberOutputs:this.notebookConfig.maxNumberOutputs,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,translator:this.translator},o=this.contentFactory.createCodeCell(n);return o.syncCollapse=!0,o.syncEditable=!0,o.syncScrolled=!0,o.outputArea.inputRequested.connect((()=>{this._onInputRequested(o).catch((e=>{console.error("Failed to scroll to cell requesting input.",e)}))})),o}_createMarkdownCell(e){const t=this.rendermime,n={contentFactory:this.contentFactory,editorConfig:this.editorConfig.markdown,model:e,placeholder:"none"!==this._notebookConfig.windowingMode,rendermime:t,showEditorForReadOnlyMarkdown:this._notebookConfig.showEditorForReadOnlyMarkdown},o=this.contentFactory.createMarkdownCell(n);return o.syncCollapse=!0,o.syncEditable=!0,o.headingCollapsedChanged.connect(this._onCellCollapsed,this),o}_createRawCell(e){const t=this.contentFactory,n={editorConfig:this.editorConfig.raw,model:e,contentFactory:t,placeholder:"none"!==this._notebookConfig.windowingMode},o=this.contentFactory.createRawCell(n);return o.syncCollapse=!0,o.syncEditable=!0,o}_removeCell(e){const t=this.cellsArray[e];t.parent=null,a.ArrayExt.removeAt(this.cellsArray,e),this.onCellRemoved(e,t),t.dispose()}_updateMimetype(){var e;const t=null===(e=this._notebookModel)||void 0===e?void 0:e.metadata.get("language_info");if(t){this._mimetype=this._mimetypeService.getMimeTypeByLanguage(t);for(const e of this.widgets)"code"===e.model.type&&(e.model.mimeType=this._mimetype)}}_onCellCollapsed(e,t){m.setHeadingCollapse(e,t,this),this._cellCollapsed.emit(e)}_onCellInViewportChanged(e){this._cellInViewportChanged.emit(e)}async _onInputRequested(e){if(!e.inViewport){const t=this.widgets.findIndex((t=>t===e));if(t>=0){await this.scrollToItem(t);const n=e.node.querySelector(".jp-Stdin");n&&(q.ElementExt.scrollIntoViewIfNeeded(this.node,n),n.focus())}}}_scheduleCellRenderOnIdle(){"defer"!==this.notebookConfig.windowingMode||this.isDisposed||this._idleCallBack||(this._idleCallBack=requestIdleCallback((e=>{this._idleCallBack=null,this._updateForDeferMode(e.didTimeout?50:e.timeRemaining())}),{timeout:3e3}))}_updateDataWindowedListIndex(e,t,n){for(let o=0;o<this.viewportNode.childElementCount;o++){const i=this.viewportNode.children[o],s=parseInt(i.dataset.windowedListIndex,10);s>=e&&s<t&&(i.dataset.windowedListIndex=`${s+n}`)}}_updateEditorConfig(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];let n={};switch(t.model.type){case"code":n=this._editorConfig.code;break;case"markdown":n=this._editorConfig.markdown;break;default:n=this._editorConfig.raw}t.setEditorConfig({...n})}}async _updateForDeferMode(e=50){const t=Date.now();let n=0;for(;Date.now()-t<e&&n<this.cellsArray.length;){const e=this.cellsArray[n];e.isPlaceholder()&&(e.dataset.windowedListIndex=`${n}`,this.layout.insertWidget(n,e),await e.ready),n++}n<this.cellsArray.length?this._scheduleCellRenderOnIdle():this._idleCallBack&&(window.cancelIdleCallback(this._idleCallBack),this._idleCallBack=null)}_updateNotebookConfig(){this.toggleClass("jp-mod-scrollPastEnd",this._notebookConfig.scrollPastEnd),this.toggleClass("jp-mod-showHiddenCellsButton",this._notebookConfig.showHiddenCellsButton);const e=this._notebookConfig.showEditorForReadOnlyMarkdown;if(void 0!==e)for(const t of this.cellsArray)"markdown"===t.model.type&&(t.showEditorForReadOnly=e);this.viewModel.windowingActive="full"===this._notebookConfig.windowingMode}}!function(e){e.defaultEditorConfig={code:{...D.CodeEditor.defaultConfig,lineWrap:"off",matchBrackets:!0,autoClosingBrackets:!1},markdown:{...D.CodeEditor.defaultConfig,lineWrap:"on",matchBrackets:!1,autoClosingBrackets:!1},raw:{...D.CodeEditor.defaultConfig,lineWrap:"on",matchBrackets:!1,autoClosingBrackets:!1}},e.defaultNotebookConfig={showHiddenCellsButton:!0,scrollPastEnd:!0,defaultCell:"code",recordTiming:!1,maxNumberOutputs:50,showEditorForReadOnlyMarkdown:!0,disableDocumentWideUndoRedo:!1,renderingLayout:"default",sideBySideLeftMarginOverride:"10px",sideBySideRightMarginOverride:"10px",sideBySideOutputRatio:1,overscanCount:1,windowingMode:"full"};class t extends i.Cell.ContentFactory{createCodeCell(e){return e.contentFactory||(e.contentFactory=this),new i.CodeCell(e).initializeState()}createMarkdownCell(e){return e.contentFactory||(e.contentFactory=this),new i.MarkdownCell(e).initializeState()}createRawCell(e){return e.contentFactory||(e.contentFactory=this),new i.RawCell(e).initializeState()}}e.ContentFactory=t,e.defaultContentFactory=new t}(re||(re={}));class ce extends re{constructor(e){super(he.processNotebookOptions(e)),this._activeCellIndex=-1,this._activeCell=null,this._mode="command",this._drag=null,this._dragData=null,this._mouseMode=null,this._activeCellChanged=new r.Signal(this),this._stateChanged=new r.Signal(this),this._selectionChanged=new r.Signal(this),this._checkCacheOnNextResize=!1,this._lastClipboardInteraction=null,this.node.tabIndex=0,this.node.setAttribute("data-lm-dragscroll","true")}_onCellsChanged(e,t){var n,o;const i=t.cellsChange&&(null===(n=this.activeCell)||void 0===n?void 0:n.model.id);if(super._onCellsChanged(e,t),i){const e=null===(o=this.model)||void 0===o?void 0:o.sharedModel.cells.findIndex((e=>e.getId()===i));null!=e&&(this.activeCellIndex=e)}}get activeCellChanged(){return this._activeCellChanged}get stateChanged(){return this._stateChanged}get selectionChanged(){return this._selectionChanged}get mode(){return this._mode}set mode(e){const t=this.activeCell;if(t||(e="command"),e===this._mode)return void this._ensureFocus();this.update();const n=this._mode;if(this._mode=e,"edit"===e){for(const e of this.widgets)this.deselect(e);t instanceof i.MarkdownCell&&(t.rendered=!1),t.inputHidden=!1}else this.node.focus();this._stateChanged.emit({name:"mode",oldValue:n,newValue:e}),this._ensureFocus()}get activeCellIndex(){return this.model&&this.widgets.length?this._activeCellIndex:-1}set activeCellIndex(e){var t;const n=this._activeCellIndex;this.model&&this.widgets.length?(e=Math.max(e,0),e=Math.min(e,this.widgets.length-1)):e=-1,this._activeCellIndex=e;const o=null!==(t=this.widgets[e])&&void 0!==t?t:null;o!==this._activeCell&&(this.update(),this._activeCell=o,this._activeCellChanged.emit(o)),"edit"===this.mode&&o instanceof i.MarkdownCell&&(o.rendered=!1),this._ensureFocus(),e!==n&&(this._trimSelections(),this._stateChanged.emit({name:"activeCellIndex",oldValue:n,newValue:e}))}get activeCell(){return this._activeCell}get lastClipboardInteraction(){return this._lastClipboardInteraction}set lastClipboardInteraction(e){this._lastClipboardInteraction=e}dispose(){this.isDisposed||(this._activeCell=null,super.dispose())}select(e){he.selectedProperty.get(e)||(he.selectedProperty.set(e,!0),this._selectionChanged.emit(void 0),this.update())}deselect(e){he.selectedProperty.get(e)&&(he.selectedProperty.set(e,!1),this._selectionChanged.emit(void 0),this.update())}isSelected(e){return he.selectedProperty.get(e)}isSelectedOrActive(e){return e===this._activeCell||he.selectedProperty.get(e)}deselectAll(){let e=!1;for(const t of this.widgets)he.selectedProperty.get(t)&&(e=!0),he.selectedProperty.set(t,!1);e&&this._selectionChanged.emit(void 0),this.activeCellIndex=this.activeCellIndex,this.update()}extendContiguousSelectionTo(e){let t,{head:n,anchor:o}=this.getContiguousSelection();if(null===o||null===n){if(e===this.activeCellIndex)return;n=this.activeCellIndex,o=this.activeCellIndex}if(this.activeCellIndex=e,(e=this.activeCellIndex)===o)return void this.deselectAll();let i=!1;if(n<e)for(n<o&&(he.selectedProperty.set(this.widgets[n],!1),i=!0),t=n+1;t<e;t++)t!==o&&(he.selectedProperty.set(this.widgets[t],!he.selectedProperty.get(this.widgets[t])),i=!0);else if(e<n)for(o<n&&(he.selectedProperty.set(this.widgets[n],!1),i=!0),t=e+1;t<n;t++)t!==o&&(he.selectedProperty.set(this.widgets[t],!he.selectedProperty.get(this.widgets[t])),i=!0);he.selectedProperty.get(this.widgets[o])||(i=!0),he.selectedProperty.set(this.widgets[o],!0),he.selectedProperty.get(this.widgets[e])||(i=!0),he.selectedProperty.set(this.widgets[e],!0),i&&this._selectionChanged.emit(void 0)}getContiguousSelection(){const e=this.widgets,t=a.ArrayExt.findFirstIndex(e,(e=>this.isSelected(e)));if(-1===t)return{head:null,anchor:null};const n=a.ArrayExt.findLastIndex(e,(e=>this.isSelected(e)),-1,t);for(let o=t;o<=n;o++)if(!this.isSelected(e[o]))throw new Error("Selection not contiguous");const o=this.activeCellIndex;if(t!==o&&n!==o)throw new Error("Active cell not at endpoint of selection");return t===o?{head:t,anchor:n}:{head:n,anchor:t}}async scrollToCell(e){try{await this.scrollToItem(this.widgets.findIndex((t=>t===e)))}catch(e){}this.deselectAll(),this.select(e),e.activate()}async setFragment(e){const t=CSS.escape(e.slice(1));if(!t)return;let n=!1;for(let e=0;e<this.widgets.length;e++){const o=this.widgets[e];if("raw"!==o.model.type&&("markdown"!==o.model.type||o.rendered)){for(const s of o.headings){let l="";switch(s.type){case i.Cell.HeadingType.HTML:l=s.id;break;case i.Cell.HeadingType.Markdown:{const e=s;l=await U.TableOfContentsUtils.Markdown.getHeadingId(this.rendermime.markdownParser,e.raw,e.level)}}if(l===t){n=!0,o.inViewport||await this.scrollToItem(e,"center");const t=this.node.querySelector(`h${s.level}[id="${l}"]`),i=this.node.getBoundingClientRect(),a=t.getBoundingClientRect();(a.top>i.bottom||a.bottom<i.top)&&t.scrollIntoView({block:"center"});break}}if(n)break}}}handleEvent(e){if(this.model)switch(e.type){case"contextmenu":e.eventPhase===Event.CAPTURING_PHASE&&this._evtContextMenuCapture(e);break;case"mousedown":e.eventPhase===Event.CAPTURING_PHASE?this._evtMouseDownCapture(e):this._evtMouseDown(e);break;case"mouseup":e.currentTarget===document&&this._evtDocumentMouseup(e);break;case"mousemove":e.currentTarget===document&&this._evtDocumentMousemove(e);break;case"keydown":this._ensureFocus(!0);break;case"dblclick":this._evtDblClick(e);break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:super.handleEvent(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("contextmenu",this,!0),t.addEventListener("mousedown",this,!0),t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("dblclick",this),t.addEventListener("focusin",this),t.addEventListener("focusout",this),t.addEventListener("lm-dragenter",this,!0),t.addEventListener("lm-dragleave",this,!0),t.addEventListener("lm-dragover",this,!0),t.addEventListener("lm-drop",this,!0)}onBeforeDetach(e){const t=this.node;t.removeEventListener("contextmenu",this,!0),t.removeEventListener("mousedown",this,!0),t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("dblclick",this),t.removeEventListener("focusin",this),t.removeEventListener("focusout",this),t.removeEventListener("lm-dragenter",this,!0),t.removeEventListener("lm-dragleave",this,!0),t.removeEventListener("lm-dragover",this,!0),t.removeEventListener("lm-drop",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),super.onBeforeAttach(e)}onAfterShow(e){super.onAfterShow(e),this._checkCacheOnNextResize=!0}onResize(e){var t;if(!this._checkCacheOnNextResize)return super.onResize(e);super.onResize(e),this._checkCacheOnNextResize=!1;const n=this._cellLayoutStateCache,o=parseInt(this.node.style.width,10);if(!n||o!==n.width){this._cellLayoutStateCache={width:o};for(const e of this.widgets)e instanceof i.Cell&&e.inViewport&&(null===(t=e.editorWidget)||void 0===t||t.update())}}onBeforeHide(e){super.onBeforeHide(e);const t=parseInt(this.node.style.width,10);this._cellLayoutStateCache={width:t}}onActivateRequest(e){super.onActivateRequest(e),this._ensureFocus(!0)}onUpdateRequest(e){super.onUpdateRequest(e);const t=this.activeCell;"edit"===this.mode?(this.addClass(X),this.removeClass(Z)):(this.addClass(Z),this.removeClass(X)),t&&t.addClass(ee);let n=0;for(const e of this.widgets)e!==t&&e.removeClass(ee),e.removeClass(ne),this.isSelectedOrActive(e)?(e.addClass(te),n++):e.removeClass(te);n>1&&(null==t||t.addClass(ne))}onCellInserted(e,t){t.ready.then((()=>{t.isDisposed||t.editor.edgeRequested.connect(this._onEdgeRequest,this)})),this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex+1:this.activeCellIndex}onCellMoved(e,t){const n=this.activeCellIndex;e===n?this.activeCellIndex=t:e<n&&n<=t?this.activeCellIndex--:t<=n&&n<e&&this.activeCellIndex++}onCellRemoved(e,t){this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex-1:this.activeCellIndex,this.isSelected(t)&&this._selectionChanged.emit(void 0)}onModelChanged(e,t){super.onModelChanged(e,t),this.activeCellIndex=0}_onEdgeRequest(e,t){const n=this.activeCellIndex;if("top"===t){if(this.activeCellIndex--,this.activeCellIndex<n){const e=this.activeCell.editor;if(e){const t=e.lineCount-1;e.setCursorPosition({line:t,column:0})}}}else if("bottom"===t&&(this.activeCellIndex++,this.activeCellIndex>n)){const e=this.activeCell.editor;e&&e.setCursorPosition({line:0,column:0})}this.mode="edit"}_ensureFocus(e=!1){var t,n;const o=this.activeCell;"edit"===this.mode&&o&&!1===(null===(t=o.editor)||void 0===t?void 0:t.hasFocus())&&(o.inViewport?null===(n=o.editor)||void 0===n||n.focus():this.scrollToItem(this.activeCellIndex).then((()=>{o.ready.then((()=>{var e;null===(e=o.editor)||void 0===e||e.focus()}))})).catch((e=>{}))),e&&!this.node.contains(document.activeElement)&&this.node.focus()}_findCell(e){let t=e;for(;t&&t!==this.node;){if(t.classList.contains(Q)){const e=a.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(-1!==e)return e;break}t=t.parentElement}return-1}_findEventTargetAndCell(e){let t=e.target,n=this._findCell(t);return-1===n&&(t=document.elementFromPoint(e.clientX,e.clientY),n=this._findCell(t)),[t,n]}_evtContextMenuCapture(e){var t;if(e.shiftKey)return;const[n,o]=this._findEventTargetAndCell(e),i=this.widgets[o];i&&(null===(t=i.editorWidget)||void 0===t?void 0:t.node.contains(n))&&e.preventDefault()}_evtMouseDownCapture(e){var t;const{button:n,shiftKey:o}=e,[i,s]=this._findEventTargetAndCell(e),l=this.widgets[s];2===n&&!o&&l&&(null===(t=l.editorWidget)||void 0===t?void 0:t.node.contains(i))&&(this.mode="command",e.preventDefault())}_evtMouseDown(e){var t,n,o;const{button:i,shiftKey:s}=e;if(0!==i&&2!==i)return;if(s&&2===i)return;const[l,a]=this._findEventTargetAndCell(e),d=this.widgets[a];let r;if(r=d?(null===(t=d.editorWidget)||void 0===t?void 0:t.node.contains(l))?"input":(null===(n=d.promptNode)||void 0===n?void 0:n.contains(l))?"prompt":"cell":"notebook","input"!==r&&(this.mode="command"),"notebook"===r)this.deselectAll();else if("prompt"===r||"cell"===r){const t=""!==(null!==(o=window.getSelection())&&void 0!==o?o:"").toString();if(0===i&&s&&!t){e.preventDefault();try{this.extendContiguousSelectionTo(a)}catch(e){return console.error(e),void this.deselectAll()}this._mouseMode="select",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)}else 0!==i||s?2===i&&(this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=a),e.preventDefault()):("prompt"===r&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:a},this._mouseMode="couldDrag",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault()),this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=a))}else"input"===r&&(2!==i||this.isSelectedOrActive(d)||(this.deselectAll(),this.activeCellIndex=a));this._ensureFocus(!0)}_evtDocumentMouseup(e){if(e.preventDefault(),e.stopPropagation(),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),"couldDrag"===this._mouseMode){const[,t]=this._findEventTargetAndCell(e);this.deselectAll(),this.activeCellIndex=t,this.activeCell.node.contains(document.activeElement)||this.node.focus()}this._mouseMode=null}_evtDocumentMousemove(e){switch(e.preventDefault(),e.stopPropagation(),this._mouseMode){case"select":{const t=e.target,n=this._findCell(t);-1!==n&&this.extendContiguousSelectionTo(n);break}case"couldDrag":{const t=this._dragData,n=Math.abs(e.clientX-t.pressX),o=Math.abs(e.clientY-t.pressY);(n>=5||o>=5)&&(this._mouseMode=null,this._startDrag(t.index,e.clientX,e.clientY));break}}}_evtDragEnter(e){if(!e.mimeData.hasData(ae))return;e.preventDefault(),e.stopPropagation();const t=e.target,n=this._findCell(t);-1!==n&&this.cellsArray[n].node.classList.add(z)}_evtDragLeave(e){if(!e.mimeData.hasData(ae))return;e.preventDefault(),e.stopPropagation();const t=this.node.getElementsByClassName(z);t.length&&t[0].classList.remove(z)}_evtDragOver(e){if(!e.mimeData.hasData(ae))return;e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=this.node.getElementsByClassName(z);t.length&&t[0].classList.remove(z);const n=e.target,o=this._findCell(n);-1!==o&&this.cellsArray[o].node.classList.add(z)}_evtDrop(e){if(!e.mimeData.hasData(ae))return;if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(z)){t.classList.remove(z);break}t=t.parentElement}const n=this.model,o=e.source;if(o===this){e.dropAction="move";const s=e.mimeData.getData("internal:cells"),l=s[s.length-1];if(l instanceof i.MarkdownCell&&l.headingCollapsed){const e=m.findNextParentHeading(l,o);if(e>0){const t=(0,a.findIndex)(o.widgets,(e=>l.model.id===e.model.id));s.push(...o.widgets.slice(t+1,e))}}let d=a.ArrayExt.firstIndexOf(this.widgets,s[0]),r=this._findCell(t);if(-1!==r&&r>d?r-=1:-1===r&&(r=this.widgets.length-1),r>=d&&r<d+s.length)return;n.sharedModel.transact((()=>{if(d<r)for(let e=s.length;e>0;e--)n.sharedModel.moveCell(d,r);else if(d>r)for(let e=s.length;e>0;e--)n.sharedModel.moveCell(d++,r++)}))}else{e.dropAction="copy";let o=this._findCell(t);-1===o&&(o=this.widgets.length);const i=o,s=e.mimeData.getData(ae).map((e=>u.createCell(e)));n.sharedModel.insertCells(o,s),this.deselectAll(),this.activeCellIndex=i,this.extendContiguousSelectionTo(o-1)}}_startDrag(e,t,n){var o;const i=this.model.cells,s=[],l=[];let a=-1;for(const e of this.widgets){const t=i.get(++a);this.isSelectedOrActive(e)&&(e.addClass($),s.push(t.toJSON()),l.push(e))}const r=this.activeCell;let c,h=null;if("code"===(null==r?void 0:r.model.type)){const e=r.model.executionCount;c=" ",e&&(c=e.toString())}else c="";h=he.createDragImage(s.length,c,null!==(o=null==r?void 0:r.model.sharedModel.getSource().split("\n")[0].slice(0,26))&&void 0!==o?o:""),this._drag=new K.Drag({mimeData:new d.MimeData,dragImage:h,supportedActions:"copy-move",proposedAction:"copy",source:this}),this._drag.mimeData.setData(ae,s),this._drag.mimeData.setData("internal:cells",l);const u=l.map((e=>e.model.sharedModel.getSource())).join("\n");this._drag.mimeData.setData("text/plain",u),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._mouseMode=null,this._drag.start(t,n).then((e=>{if(!this.isDisposed){this._drag=null;for(const e of l)e.removeClass($)}}))}_evtFocusIn(e){var t;const n=e.target,o=this._findCell(n);if(-1!==o){const e=this.widgets[o];e.editorWidget&&!e.editorWidget.node.contains(n)&&(this.mode="command"),this.activeCellIndex=o;const i=null===(t=e.editorWidget)||void 0===t?void 0:t.node;(null==i?void 0:i.contains(n))&&(this.mode="edit"),this.activeCellIndex=o}else this.mode="command"}_evtFocusOut(e){var t;const n=e.relatedTarget;if(!n)return;const o=this._findCell(n);-1!==o&&(null===(t=this.widgets[o].editorWidget)||void 0===t?void 0:t.node.contains(n))||"command"!==this.mode&&(this.mode="command",n&&n.focus())}_evtDblClick(e){const t=this.model;if(!t)return;this.deselectAll();const[n,o]=this._findEventTargetAndCell(e);e.target.classList.contains("jp-collapseHeadingButton")||-1===o||(this.activeCellIndex=o,"markdown"===t.cells.get(o).type?this.widgets[o].rendered=!1:"img"===n.localName&&n.classList.toggle("jp-mod-unconfined"))}_trimSelections(){for(let e=0;e<this.widgets.length;e++)if(e!==this._activeCellIndex){const t=this.widgets[e];t.editor&&t.model.selections.delete(t.editor.uuid)}}}var he;!function(e){class t extends re.ContentFactory{}e.ContentFactory=t,e.defaultContentFactory=new t}(ce||(ce={})),function(e){e.selectedProperty=new J.AttachedProperty({name:"selected",create:()=>!1});class t extends F.PanelLayout{onUpdateRequest(e){}}e.NotebookPanelLayout=t,e.createDragImage=function(e,t,n){return e>1?""!==t?R.VirtualDOM.realize(R.h.div(R.h.div({className:oe},R.h.span({className:se},"["+t+"]:"),R.h.span({className:ie},n)),R.h.div({className:le},""))):R.VirtualDOM.realize(R.h.div(R.h.div({className:oe},R.h.span({className:se}),R.h.span({className:ie},n)),R.h.div({className:le},""))):""!==t?R.VirtualDOM.realize(R.h.div(R.h.div({className:"jp-dragImage jp-dragImage-singlePrompt"},R.h.span({className:se},"["+t+"]:"),R.h.span({className:ie},n)))):R.VirtualDOM.realize(R.h.div(R.h.div({className:"jp-dragImage jp-dragImage-singlePrompt"},R.h.span({className:se}),R.h.span({className:ie},n))))},e.processNotebookOptions=function(e){return e.contentFactory?e:{rendermime:e.rendermime,languagePreference:e.languagePreference,contentFactory:ce.defaultContentFactory,mimeTypeService:e.mimeTypeService}}}(he||(he={}));class ue extends W.DocumentWidget{constructor(e){super(e),this._autorestarting=!1,this.translator=e.translator||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-NotebookPanel"),this.toolbar.addClass("jp-NotebookPanel-toolbar"),this.content.addClass("jp-NotebookPanel-notebook"),this.content.model=this.context.model,this.context.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this.context.saveState.connect(this._onSave,this),this.revealed.then((()=>{if(!this.isDisposed&&1===this.content.widgets.length){const e=this.content.widgets[0].model;"code"===e.type&&""===e.sharedModel.getSource()&&(this.content.mode="edit")}}))}_onSave(e,t){if("started"===t&&this.model)for(const e of this.model.cells)if((0,i.isMarkdownCellModel)(e))for(const t of e.attachments.keys)e.sharedModel.getSource().includes(t)||e.attachments.remove(t)}get sessionContext(){return this.context.sessionContext}get model(){return this.content.model}setConfig(e){this.content.editorConfig=e.editorConfig,this.content.notebookConfig=e.notebookConfig;const t=this.context.sessionContext.kernelPreference;this.context.sessionContext.kernelPreference={...t,shutdownOnDispose:e.kernelShutdown}}setFragment(e){this.context.ready.then((()=>{this.content.setFragment(e)}))}dispose(){this.content.dispose(),super.dispose()}[o.Printing.symbol](){return async()=>{this.context.model.dirty&&!this.context.model.readOnly&&await this.context.save(),await o.Printing.printURL(s.PageConfig.getNBConvertURL({format:"html",download:!1,path:this.context.path}))}}_onKernelChanged(e,t){if(!this.model||!t.newValue)return;const{newValue:n}=t;n.info.then((e=>{var t;this.model&&(null===(t=this.context.sessionContext.session)||void 0===t?void 0:t.kernel)===n&&this._updateLanguage(e.language_info)})),this._updateSpec(n)}_onSessionStatusChanged(e,t){var n;"autorestarting"!==t||this._autorestarting?"restarting"===t||(this._autorestarting=!1):((0,o.showDialog)({title:this._trans.__("Kernel Restarting"),body:this._trans.__("The kernel for %1 appears to have died. It will restart automatically.",null===(n=this.sessionContext.session)||void 0===n?void 0:n.path),buttons:[o.Dialog.okButton({label:this._trans.__("Ok")})]}),this._autorestarting=!0)}_updateLanguage(e){this.model.metadata.set("language_info",e)}async _updateSpec(e){const t=await e.spec;this.isDisposed||this.model.metadata.set("kernelspec",{name:e.name,display_name:null==t?void 0:t.display_name,language:null==t?void 0:t.language})}}!function(e){class t extends ce.ContentFactory{createNotebook(e){return new ce(e)}}e.ContentFactory=t,e.defaultContentFactory=new t,e.IContentFactory=new d.Token("@jupyterlab/notebook:IContentFactory")}(ue||(ue={}));var ge,Ce=n(85609);class me extends Ce.SearchProvider{constructor(e,t=l.nullTranslator){super(e),this.translator=t,this._currentProviderIndex=null,this._onSelectedCells=!1,this._query=null,this._searchProviders=[],this._documentHasChanged=!1,this.widget.model.cells.changed.connect(this._onCellsChanged,this),this.widget.content.activeCellChanged.connect(this._onActiveCellChanged,this)}static isApplicable(e){return e instanceof ue}static createNew(e,t){return new me(e,t)}get currentMatchIndex(){let e=0,t=!1;for(let n=0;n<this._searchProviders.length;n++){const o=this._searchProviders[n],i=o.currentMatchIndex;if(null!==i){e+=i,t=!0;break}e+=o.matchesCount}return t?e:null}get matchesCount(){return this._searchProviders.reduce(((e,t)=>e+t.matchesCount),0)}get isReadOnly(){var e,t,n;return null!==(n=null===(t=null===(e=this.widget)||void 0===e?void 0:e.content.model)||void 0===t?void 0:t.readOnly)&&void 0!==n&&n}dispose(){var e;if(this.isDisposed)return;this.widget.content.activeCellChanged.disconnect(this._onActiveCellChanged,this),null===(e=this.widget.model)||void 0===e||e.cells.changed.disconnect(this._onCellsChanged,this),super.dispose();const t=this.widget.content.activeCellIndex;this.endQuery().then((()=>{this.widget.isDisposed||(this.widget.content.activeCellIndex=t)})).catch((e=>{console.error(`Fail to end search query in notebook:\n${e}`)}))}getFilters(){const e=this.translator.load("jupyterlab");return{output:{title:e.__("Search Cell Outputs"),description:e.__("Search in the cell outputs."),default:!1,supportReplace:!1},selectedCells:{title:e.__("Search Selected Cell(s)"),description:e.__("Search only in the selected cell(s)."),default:!1,supportReplace:!0}}}getInitialQuery(){const e=this.widget.content.activeCell,t=null==e?void 0:e.editor,n=null==t?void 0:t.state.sliceDoc(null==t?void 0:t.state.selection.main.from,null==t?void 0:t.state.selection.main.to);return-1===(null==n?void 0:n.search(/\r?\n|\r/g))?n:""}async clearHighlight(){null!==this._currentProviderIndex&&(await this._searchProviders[this._currentProviderIndex].clearHighlight(),this._currentProviderIndex=null)}async highlightNext(e=!0){const t=await this._stepNext(!1,e);return null!=t?t:void 0}async highlightPrevious(e=!0){const t=await this._stepNext(!0,e);return null!=t?t:void 0}async startQuery(e,t){if(!this.widget)return;await this.endQuery();let n=this.widget.content.widgets;return this._query=e,this._filters={output:!1,selectedCells:!1,...null!=t?t:{}},this._onSelectedCells=this._filters.selectedCells,this._filters.selectedCells&&this.widget.content.selectionChanged.connect(this._onSelectionChanged,this),this._searchProviders=await Promise.all(n.map((async t=>{const n=(0,i.createCellSearchProvider)(t);return n.stateChanged.connect(this._onSearchProviderChanged,this),await n.setIsActive(!this._filters.selectedCells||this.widget.content.isSelectedOrActive(t)),await n.startQuery(e,this._filters),n}))),this._currentProviderIndex=this.widget.content.activeCellIndex,this._documentHasChanged||await this.highlightNext(!1),this._documentHasChanged=!1,Promise.resolve()}async endQuery(){await Promise.all(this._searchProviders.map((e=>(e.stateChanged.disconnect(this._onSearchProviderChanged,this),e.endQuery().then((()=>{e.dispose()})))))),this._searchProviders.length=0,this._currentProviderIndex=null}async replaceCurrentMatch(e,t=!0){let n=!1;const o=async(e=!1)=>{var n;const o=null===(n=this.widget)||void 0===n?void 0:n.content.activeCell;"markdown"===(null==o?void 0:o.model.type)&&o.rendered&&(o.rendered=!1,e&&await this.highlightNext(t))};if(null!==this._currentProviderIndex){await o();const t=this._searchProviders[this._currentProviderIndex];n=await t.replaceCurrentMatch(e)}return await this.highlightNext(t),await o(!0),n}async replaceAllMatches(e){return(await Promise.all(this._searchProviders.map((t=>t.replaceAllMatches(e))))).includes(!0)}async validateFilter(e,t){if("output"!==e)return t;if(t&&this.widget.content.widgets.some((e=>e instanceof i.CodeCell&&e.isPlaceholder()))){const e=this.translator.load("jupyterlab");if(!(await(0,o.showDialog)({title:e.__("Confirmation"),body:e.__("Searching outputs is expensive and requires to first rendered all outputs. Are you sure you want to search in the cell outputs?"),buttons:[o.Dialog.cancelButton({label:e.__("Cancel")}),o.Dialog.okButton({label:e.__("Ok")})]})).button.accept)return!1;this.widget.content.widgets.forEach(((e,t)=>{e instanceof i.CodeCell&&e.isPlaceholder()&&this.widget.content.renderCellOutputs(t)}))}return t}_addCellProvider(e){var t,n;const o=this.widget.content.widgets[e],s=(0,i.createCellSearchProvider)(o);s.stateChanged.connect(this._onSearchProviderChanged,this),a.ArrayExt.insert(this._searchProviders,e,s),s.setIsActive(!(null!==(n=null===(t=this._filters)||void 0===t?void 0:t.selectedCells)&&void 0!==n&&n)||this.widget.content.isSelectedOrActive(o)).then((()=>{s.startQuery(this._query,this._filters)}))}_removeCellProvider(e){const t=a.ArrayExt.removeAt(this._searchProviders,e);null==t||t.stateChanged.disconnect(this._onSearchProviderChanged,this),null==t||t.dispose()}async _onCellsChanged(e,t){switch(await this.clearHighlight(),t.type){case"add":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n)}));break;case"move":a.ArrayExt.move(this._searchProviders,t.oldIndex,t.newIndex);break;case"remove":for(let e=0;e<t.oldValues.length;e++)this._removeCellProvider(t.oldIndex);break;case"set":t.newValues.forEach(((e,n)=>{this._addCellProvider(t.newIndex+n),this._removeCellProvider(t.newIndex+n+1)}))}this._onSearchProviderChanged()}async _stepNext(e=!1,t=!1){const n=async()=>{this.widget.content.activeCellIndex!==this._currentProviderIndex&&(this.widget.content.activeCellIndex=this._currentProviderIndex);const e=this.widget.content.activeCell;if(!e.inViewport)try{await this.widget.content.scrollToItem(this._currentProviderIndex)}catch(e){}if(e.inputHidden&&(e.inputHidden=!1),!e.inViewport)return;await e.ready;const t=e.editor;t.revealSelection(t.getSelection())};null===this._currentProviderIndex&&(this._currentProviderIndex=this.widget.content.activeCellIndex);const o=this._currentProviderIndex;do{const i=this._searchProviders[this._currentProviderIndex],s=e?await i.highlightPrevious():await i.highlightNext();if(s)return await n(),s;if(this._currentProviderIndex=this._currentProviderIndex+(e?-1:1),t){if(this._currentProviderIndex===o)break;this._currentProviderIndex=(this._currentProviderIndex+this._searchProviders.length)%this._searchProviders.length}}while(0<=this._currentProviderIndex&&this._currentProviderIndex<this._searchProviders.length);if(t){const t=this._searchProviders[this._currentProviderIndex],o=e?await t.highlightPrevious():await t.highlightNext();if(o)return await n(),o}return this._currentProviderIndex=null,null}async _onActiveCellChanged(){await this._onSelectionChanged(),this.widget.content.activeCellIndex!==this._currentProviderIndex&&await this.clearHighlight()}_onSearchProviderChanged(){this._documentHasChanged=!0,this._stateChanged.emit()}async _onSelectionChanged(){if(this._onSelectedCells){const e=this.widget.content.widgets;await Promise.all(this._searchProviders.map(((t,n)=>t.setIsActive(this.widget.content.isSelectedOrActive(e[n]))))),this._onSearchProviderChanged()}}}!function(e){e[e.Idle=-1]="Idle",e[e.Scheduled=0]="Scheduled",e[e.Running=1]="Running"}(ge||(ge={}));class ve extends U.TableOfContentsModel{constructor(e,t,n,o){super(e,o),this.parser=t,this.sanitizer=n,this.configMetadataMap={numberHeaders:["toc-autonumbering","toc/number_sections"],numberingH1:["!toc/skip_h1_title"],baseNumbering:["toc/base_numbering"]},this._runningCells=new Array,this._cellToHeadingIndex=new WeakMap,e.context.ready.then((()=>{this.setConfiguration({})})),this.widget.context.model.metadata.changed.connect(this.onMetadataChanged,this),this.widget.content.activeCellChanged.connect(this.onActiveCellChanged,this),m.executionScheduled.connect(this.onExecutionScheduled,this),m.executed.connect(this.onExecuted,this),this.headingsChanged.connect(this.onHeadingsChanged,this)}get documentType(){return"notebook"}get isAlwaysActive(){return!0}get supportedOptions(){return["baseNumbering","maximalDepth","numberingH1","numberHeaders","includeOutput","syncCollapseState"]}getCellHeadings(e){const t=new Array;let n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];for(t.push(e);this.headings[n-1]&&this.headings[n-1].cellRef===e.cellRef;)n--,t.unshift(this.headings[n])}return t}dispose(){var e,t,n,o;this.isDisposed||(this.headingsChanged.disconnect(this.onHeadingsChanged,this),null===(n=null===(t=null===(e=this.widget.context)||void 0===e?void 0:e.model)||void 0===t?void 0:t.metadata)||void 0===n||n.changed.disconnect(this.onMetadataChanged,this),null===(o=this.widget.content)||void 0===o||o.activeCellChanged.disconnect(this.onActiveCellChanged,this),m.executionScheduled.disconnect(this.onExecutionScheduled,this),m.executed.disconnect(this.onExecuted,this),this._runningCells.length=0,super.dispose())}setConfiguration(e){const t=this.loadConfigurationFromMetadata();super.setConfiguration({...this.configuration,...t,...e})}toggleCollapse(e){super.toggleCollapse(e),this.updateRunningStatus(this.headings)}getHeadings(){const e=this.widget.content.widgets,t=[],n=new Array;for(let o=0;o<e.length;o++){const i=e[o];switch(i.model.type){case"code":!this.configuration.syncCollapseState&&this.configuration.includeOutput&&t.push(...U.TableOfContentsUtils.filterHeadings(i.headings,this.configuration,n).map((e=>({...e,cellRef:i,collapsed:!1,isRunning:ge.Idle}))));break;case"markdown":{const e=U.TableOfContentsUtils.filterHeadings(i.headings,this.configuration,n).map(((e,t)=>({...e,cellRef:i,collapsed:!1,isRunning:ge.Idle})));if(this.configuration.syncCollapseState&&i.headingCollapsed){const t=Math.min(...e.map((e=>e.level)));e.find((e=>e.level===t)).collapsed=i.headingCollapsed}t.push(...e);break}}t.length>0&&this._cellToHeadingIndex.set(i,t.length-1)}return this.updateRunningStatus(t),Promise.resolve(t)}loadConfigurationFromMetadata(){const e=this.widget.content.model,t={};if(e)for(const n in this.configMetadataMap){const o=this.configMetadataMap[n];for(const i of o){let o=i;const s="!"===o[0];s&&(o=o.slice(1));const l=o.split("/");let a=e.metadata.get(l[0]);for(let e=1;e<l.length;e++)a=(null!=a?a:{})[l[e]];void 0!==a&&("boolean"==typeof a&&s&&(a=!a),t[n]=a)}}return t}onActiveCellChanged(e,t){const n=this.getCellHeadings(t)[0];this.setActiveHeading(null!=n?n:null,!1)}onHeadingsChanged(){this.widget.content.activeCell&&this.onActiveCellChanged(this.widget.content,this.widget.content.activeCell)}onExecuted(e,t){this._runningCells.forEach(((e,n)=>{if(e===t.cell){this._runningCells.splice(n,1);const t=this._cellToHeadingIndex.get(e);void 0!==t&&(this.headings[t].isRunning=ge.Idle)}})),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onExecutionScheduled(e,t){this._runningCells.includes(t.cell)||this._runningCells.push(t.cell),this.updateRunningStatus(this.headings),this.stateChanged.emit()}onMetadataChanged(){this.setConfiguration({})}updateRunningStatus(e){this._runningCells.forEach(((e,t)=>{const n=this._cellToHeadingIndex.get(e);if(void 0!==n){const e=this.headings[n];e.isRunning=Math.max(t>0?ge.Scheduled:ge.Running,e.isRunning)}}));let t=0;for(;t<e.length;){const o=e[t];if(t++,o.collapsed){const t=Math.max(o.isRunning,n(e,o.level));o.dataset={...o.dataset,"data-running":t.toString()}}else o.dataset={...o.dataset,"data-running":o.isRunning.toString()}}function n(e,o){let i=ge.Idle;for(;t<e.length;){const s=e[t];if(s.dataset={...s.dataset,"data-running":s.isRunning.toString()},!(s.level>o))break;t++,i=Math.max(s.isRunning,i),s.collapsed&&(i=Math.max(i,n(e,s.level)),s.dataset={...s.dataset,"data-running":i.toString()})}return i}}}class pe extends U.TableOfContentsFactory{constructor(e,t,n){super(e),this.parser=t,this.sanitizer=n}_createNew(e,t){const n=new ve(e,this.parser,this.sanitizer,t);let o=new WeakMap;const s=(t,n)=>{if(n){const t=t=>{if(!t.inViewport)return;const i=o.get(n);if(i){const t=e.content.node.getBoundingClientRect(),n=i.getBoundingClientRect();(n.top>t.bottom||n.bottom<t.top)&&i.scrollIntoView({block:"center"})}},i=n.cellRef,s=e.content.widgets.indexOf(i);e.content.activeCellIndex=s,i.inViewport?t(i):e.content.scrollToItem(s).then((()=>{t(i)})).catch((e=>{console.error("Fail to scroll to cell to display the required heading.")}))}},l=e=>{n.getCellHeadings(e).forEach((async e=>{var t,n;const i=await fe(e,this.parser),s=i?`h${e.level}[id="${i}"]`:`h${e.level}`;void 0!==e.outputIndex?o.set(e,U.TableOfContentsUtils.addPrefix(e.cellRef.outputArea.widgets[e.outputIndex].node,s,null!==(t=e.prefix)&&void 0!==t?t:"")):o.set(e,U.TableOfContentsUtils.addPrefix(e.cellRef.node,s,null!==(n=e.prefix)&&void 0!==n?n:""))}))},a=t=>{this.parser&&(U.TableOfContentsUtils.clearNumbering(e.content.node),o=new WeakMap,e.content.widgets.forEach((e=>{l(e)})))},d=(t,o)=>{var s,l,a,d;if(n.configuration.syncCollapseState)if(null!==o){const e=o.cellRef;e.headingCollapsed!==(null!==(s=o.collapsed)&&void 0!==s&&s)&&(e.headingCollapsed=null!==(l=o.collapsed)&&void 0!==l&&l)}else{const t=null!==(d=null===(a=n.headings[0])||void 0===a?void 0:a.collapsed)&&void 0!==d&&d;e.content.widgets.forEach((e=>{e instanceof i.MarkdownCell&&e.headingInfo.level>=0&&(e.headingCollapsed=t)}))}},r=(e,t)=>{if(n.configuration.syncCollapseState){const e=n.getCellHeadings(t)[0];e&&n.toggleCollapse({heading:e,collapsed:t.headingCollapsed})}},c=(e,t)=>{t.inViewport?l(t):U.TableOfContentsUtils.clearNumbering(t.node)};return e.context.ready.then((()=>{a(),n.activeHeadingChanged.connect(s),n.headingsChanged.connect(a),n.collapseChanged.connect(d),e.content.cellCollapsed.connect(r),e.content.cellInViewportChanged.connect(c),e.disposed.connect((()=>{n.activeHeadingChanged.disconnect(s),n.headingsChanged.disconnect(a),n.collapseChanged.disconnect(d),e.content.cellCollapsed.disconnect(r),e.content.cellInViewportChanged.disconnect(c)}))})),n}}async function fe(e,t){let n=null;return e.type===i.Cell.HeadingType.Markdown?n=await U.TableOfContentsUtils.Markdown.getHeadingId(t,e.raw,e.level):e.type===i.Cell.HeadingType.HTML&&(n=e.id),n}const _e=new d.Token("@jupyterlab/notebook:INotebookWidgetFactory"),we=new d.Token("@jupyterlab/notebook:INotebookTools"),be=new d.Token("@jupyterlab/notebook:INotebookTracker");class ye extends o.WidgetTracker{constructor(){super(...arguments),this._activeCell=null,this._activeCellChanged=new r.Signal(this),this._selectionChanged=new r.Signal(this)}get activeCell(){const e=this.currentWidget;return e&&e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);return e.content.activeCellChanged.connect(this._onActiveCellChanged,this),e.content.selectionChanged.connect(this._onSelectionChanged,this),t}dispose(){this._activeCell=null,super.dispose()}onCurrentChanged(e){const t=this.activeCell;t&&t===this._activeCell||(this._activeCell=t,e&&this._activeCellChanged.emit(e.content.activeCell||null))}_onActiveCellChanged(e,t){this.currentWidget&&this.currentWidget.content===e&&(this._activeCell=t||null,this._activeCellChanged.emit(this._activeCell))}_onSelectionChanged(e){this.currentWidget&&this.currentWidget.content===e&&this._selectionChanged.emit(void 0)}}function ke(e){return e.allCellsTrusted?h().createElement(f.trustedIcon.react,{top:"2px",stylesheet:"statusBar"}):h().createElement(f.notTrustedIcon.react,{top:"2px",stylesheet:"statusBar"})}class xe extends f.VDomRenderer{constructor(e){super(new xe.Model),this.translator=e||l.nullTranslator}render(){return this.model?(this.node.title=function(e,t){const n=(t=t||l.nullTranslator).load("jupyterlab");return e.trustedCells===e.totalCells?[n.__("Notebook trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-trusted"]:e.activeCellTrusted?[n.__("Active cell trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-trusted"]:[n.__("Notebook not trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-untrusted"]}(this.model,this.translator)[0],h().createElement("div",null,h().createElement(ke,{allCellsTrusted:this.model.trustedCells===this.model.totalCells,activeCellTrusted:this.model.activeCellTrusted,totalCells:this.model.totalCells,trustedCells:this.model.trustedCells}))):null}}!function(e){class t extends f.VDomModel{constructor(){super(...arguments),this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1,this._notebook=null}get trustedCells(){return this._trustedCells}get totalCells(){return this._totalCells}get activeCellTrusted(){return this._activeCellTrusted}get notebook(){return this._notebook}set notebook(e){const t=this._notebook;null!==t&&(t.activeCellChanged.disconnect(this._onActiveCellChanged,this),t.modelContentChanged.disconnect(this._onModelChanged,this));const n=this._getAllState();if(this._notebook=e,null===this._notebook)this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1;else{this._notebook.activeCellChanged.connect(this._onActiveCellChanged,this),this._notebook.modelContentChanged.connect(this._onModelChanged,this),void 0!==this._notebook.activeCell?this._activeCellTrusted=this._notebook.activeCell.model.trusted:this._activeCellTrusted=!1;const{total:e,trusted:t}=this._deriveCellTrustState(this._notebook.model);this._totalCells=e,this._trustedCells=t}this._triggerChange(n,this._getAllState())}_onModelChanged(e){const t=this._getAllState(),{total:n,trusted:o}=this._deriveCellTrustState(e.model);this._totalCells=n,this._trustedCells=o,this._triggerChange(t,this._getAllState())}_onActiveCellChanged(e,t){const n=this._getAllState();this._activeCellTrusted=!!t&&t.model.trusted,this._triggerChange(n,this._getAllState())}_deriveCellTrustState(e){if(null===e)return{total:0,trusted:0};let t=0;for(const n of e.cells)n.trusted&&t++;return{total:e.cells.length,trusted:t}}_getAllState(){return[this._trustedCells,this._totalCells,this.activeCellTrusted]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||this.stateChanged.emit(void 0)}}e.Model=t}(xe||(xe={}));class Se extends W.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory||ue.defaultContentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||re.defaultEditorConfig,this._notebookConfig=e.notebookConfig||re.defaultNotebookConfig,this._sessionDialogs=e.sessionDialogs||o.sessionContextDialogs}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const n=e.translator,o={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:n},i=this.contentFactory.createNotebook(o);return new ue({context:e,content:i})}defaultToolbarFactory(e){return p.getDefaultItems(e,this._sessionDialogs,this.translator)}}}}]);