"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9878],{79878:(e,t,i)=>{i.r(t),i.d(t,{Debugger:()=>vt,IDebugger:()=>bt,IDebuggerConfig:()=>yt,IDebuggerHandler:()=>xt,IDebuggerSidebar:()=>Ct,IDebuggerSources:()=>St});var s=i(26629);const o=1540483477,r=new TextEncoder;function n(e,t){const i=r.encode(e);let s=i.length,n=t^s,a=0;for(;s>=4;){let e=255&i[a]|(255&i[++a])<<8|(255&i[++a])<<16|(255&i[++a])<<24;e=(65535&e)*o+(((e>>>16)*o&65535)<<16),e^=e>>>24,e=(65535&e)*o+(((e>>>16)*o&65535)<<16),n=(65535&n)*o+(((n>>>16)*o&65535)<<16)^e,s-=4,++a}switch(s){case 3:n^=(255&i[a+2])<<16;case 2:n^=(255&i[a+1])<<8;case 1:n^=255&i[a],n=(65535&n)*o+(((n>>>16)*o&65535)<<16)}return n^=n>>>13,n=(65535&n)*o+(((n>>>16)*o&65535)<<16),n^=n>>>15,n>>>0}class a{constructor(){this._fileParams=new Map,this._hashMethods=new Map}getCodeId(e,t){const i=this._fileParams.get(t);if(!i)throw new Error(`Kernel (${t}) has no tmp file params.`);const s=this._hashMethods.get(t);if(!s)throw new Error(`Kernel (${t}) has no hashing params.`);const{prefix:o,suffix:r}=i;return`${o}${s(e)}${r}`}setHashParams(e){const{kernel:t,method:i,seed:s}=e;if(!t)throw new TypeError("Kernel name is not defined.");if("Murmur2"!==i)throw new Error(`Hash method (${i}) is not supported.`);this._hashMethods.set(t,(e=>n(e,s).toString()))}setTmpFileParams(e){const{kernel:t,prefix:i,suffix:s}=e;if(!t)throw new TypeError("Kernel name is not defined.");this._fileParams.set(t,{kernel:t,prefix:i,suffix:s})}getTmpFileParams(e){return this._fileParams.get(e)}}var l,h=i(2815),c=i(7065),d=i(34340);!function(e){e.getCode=function(e){return new u({...e,body:new _(e),buttons:[h.Dialog.cancelButton({label:e.cancelLabel}),h.Dialog.okButton({label:e.okLabel})]}).launch()}}(l||(l={}));class u extends h.Dialog{handleEvent(e){if("keydown"===e.type){const t=e,{code:i,shiftKey:s}=t;if(s&&"Enter"===i)return this.resolve();if("Enter"===i)return}super.handleEvent(e)}}class _ extends d.Widget{constructor(e){super();const{rendermime:t,mimeType:i}=e,s=new c.CodeCellModel;s.mimeType=null!=i?i:"",this._prompt=new c.CodeCell({rendermime:t,model:s,placeholder:!1}).initializeState(),this._prompt.inputArea.promptNode.remove(),this.node.appendChild(this._prompt.node)}getValue(){return this._prompt.model.sharedModel.getSource()}onAfterAttach(e){super.onAfterAttach(e),this._prompt.activate()}}var m=i(65484),p=i(59874);class g{constructor(e){this._services=e.editorServices}createNewEditor(e){const{content:t,mimeType:i,path:s}=e,o=this._services.factoryService.newInlineEditor,r=this._services.mimeTypeService,n=new m.CodeEditorWrapper({model:new m.CodeEditor.Model({sharedModel:(0,p.createStandaloneCell)({cell_type:"code",source:t}),mimeType:i||r.getMimeTypeByFilePath(s)}),factory:o,config:{readOnly:!0,lineNumbers:!0}});return n.node.setAttribute("data-jp-debugger","true"),n}}var f,v=i(52969),w=i(54708),b=i(6691),y=i(22554),S=i(92323),C=i(85975);class x{constructor(e){var t,i,s,o;this._src=e.src,this._id=null!==(s=null===(i=null===(t=e.debuggerService.session)||void 0===t?void 0:t.connection)||void 0===i?void 0:i.id)&&void 0!==s?s:"",this._path=null!==(o=e.path)&&void 0!==o?o:"",this._debuggerService=e.debuggerService,this._editor=e.getEditor,this._editorMonitor=new y.ActivityMonitor({signal:this._src.changed,timeout:1e3}),this._editorMonitor.activityStopped.connect((()=>{this._sendEditorBreakpoints()}),this),this._debuggerService.model.breakpoints.changed.connect((async()=>{const e=this.editor;e&&!e.isDisposed&&this._addBreakpointsToEditor()})),this._debuggerService.model.breakpoints.restored.connect((async()=>{const e=this.editor;e&&!e.isDisposed&&this._addBreakpointsToEditor()})),this._debuggerService.model.callstack.currentFrameChanged.connect((()=>{const e=this.editor;e&&x.clearHighlight(e)})),this._breakpointEffect=S.Py.define({map:(e,t)=>({pos:e.pos.map((e=>t.mapPos(e)))})}),this._breakpointState=S.QQ.define({create:()=>S.Xs.empty,update:(e,t)=>{e=e.map(t.changes);for(let i of t.effects)if(i.is(this._breakpointEffect)){let t=i;e=t.value.pos.length?e.update({add:t.value.pos.map((e=>f.breakpointMarker.range(e))),sort:!0}):S.Xs.empty}return e}}),this._gutter=new S.F6,this._highlightDeco=C.p.line({class:"jp-DebuggerEditor-highlight"}),this._highlightState=S.QQ.define({create:()=>C.p.none,update:(e,t)=>{e=e.map(t.changes);for(let i of t.effects)if(i.is(x._highlightEffect)){let t=i;e=t.value.pos.length?e.update({add:t.value.pos.map((e=>this._highlightDeco.range(e)))}):C.p.none}return e},provide:e=>C.tk.decorations.from(e)}),e.editorReady().then((()=>{this._setupEditor()}))}get editor(){return this._editor()}dispose(){this.isDisposed||(this._editorMonitor.dispose(),this._clearEditor(),this.isDisposed=!0,b.Signal.clearData(this))}refreshBreakpoints(){this._addBreakpointsToEditor()}_setupEditor(){const e=this.editor;if(!e||e.isDisposed)return;e.setOption("lineNumbers",!0);const t=[this._breakpointState,this._highlightState,S.Wl.highest((0,C.v5)({class:"cm-breakpoint-gutter",renderEmptyElements:!0,markers:e=>e.state.field(this._breakpointState),initialSpacer:()=>f.breakpointMarker,domEventHandlers:{mousedown:(e,t)=>(this._onGutterClick(e,t.from),!0)}}))];e.injectExtension(this._gutter.of(t)),this._addBreakpointsToEditor()}_clearEditor(){const e=this.editor;e&&!e.isDisposed&&(x.clearHighlight(e),this._clearGutter(e),e.setOption("lineNumbers",!1),e.editor.dispatch({effects:this._gutter.reconfigure([])}))}_sendEditorBreakpoints(){var e;if(null===(e=this.editor)||void 0===e?void 0:e.isDisposed)return;const t=this._getBreakpointsFromEditor().map((e=>{var t,i;return f.createBreakpoint((null===(i=null===(t=this._debuggerService.session)||void 0===t?void 0:t.connection)||void 0===i?void 0:i.name)||"",e)}));this._debuggerService.updateBreakpoints(this._src.getSource(),t,this._path)}_onGutterClick(e,t){var i,s,o;if(this._id!==(null===(s=null===(i=this._debuggerService.session)||void 0===i?void 0:i.connection)||void 0===s?void 0:s.id))return;const r=e.state.doc.lineAt(t).number;let n=e.state.field(this._breakpointState),a=!1;n.between(t,t,(()=>{a=!0}));let l=this._getBreakpoints();a?l=l.filter((e=>e.line!==r)):l.push(f.createBreakpoint(null!==(o=this._path)&&void 0!==o?o:this._debuggerService.session.connection.name,r)),l.sort(((e,t)=>e.line-t.line)),this._debuggerService.updateBreakpoints(this._src.getSource(),l,this._path)}_addBreakpointsToEditor(){var e,t;if(this._id!==(null===(t=null===(e=this._debuggerService.session)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.id))return;const i=this.editor,s=this._getBreakpoints();this._clearGutter(i);const o=s.map((e=>i.state.doc.line(e.line).from));i.editor.dispatch({effects:this._breakpointEffect.of({pos:o})})}_getBreakpointsFromEditor(){const e=this.editor,t=e.editor.state.field(this._breakpointState);let i=[];return t.between(0,e.doc.length,(t=>{i.push(e.doc.lineAt(t).number)})),i}_clearGutter(e){e&&e.editor.dispatch({effects:this._breakpointEffect.of({pos:[]})})}_getBreakpoints(){const e=this._src.getSource();return this._debuggerService.model.breakpoints.getBreakpoints(this._path||this._debuggerService.getCodeId(e))}}!function(e){function t(t){t&&!t.isDisposed&&t.editor.dispatch({effects:e._highlightEffect.of({pos:[]})})}e._highlightEffect=S.Py.define({map:(e,t)=>({pos:e.pos.map((e=>t.mapPos(e)))})}),e.showCurrentLine=function(i,s){t(i);const o=i,r=o.doc.line(s).from;o.editor.dispatch({effects:e._highlightEffect.of({pos:[r]})})},e.clearHighlight=t}(x||(x={})),function(e){e.breakpointMarker=new class extends C.SJ{toDOM(){return document.createTextNode("●")}},e.createBreakpoint=function(e,t){return{line:t,verified:!0,source:{name:e}}}}(f||(f={}));class M{constructor(e){this._debuggerService=e.debuggerService,this._consolePanel=e.widget,this._cellMap=new w.ObservableMap;const t=this._consolePanel.console;t.promptCell&&this._addEditorHandler(t.promptCell),t.promptCellCreated.connect(((e,t)=>{this._addEditorHandler(t)}));const i=()=>{for(const e of t.cells)this._addEditorHandler(e)};i(),this._consolePanel.console.cells.changed.connect(i)}dispose(){this.isDisposed||(this.isDisposed=!0,this._cellMap.values().forEach((e=>e.dispose())),this._cellMap.dispose(),b.Signal.clearData(this))}_addEditorHandler(e){const t=e.model.id;if("code"!==e.model.type||this._cellMap.has(t))return;const i=e,s=new x({debuggerService:this._debuggerService,editorReady:async()=>(await i.ready,i.editor),getEditor:()=>i.editor,src:e.model.sharedModel});i.disposed.connect((()=>{this._cellMap.delete(t),s.dispose()})),this._cellMap.set(t,s)}}class k{constructor(e){this._debuggerService=e.debuggerService,this._fileEditor=e.widget.content,this._hasLineNumber=this._fileEditor.editor.getOption("lineNumbers"),this._editorHandler=new x({debuggerService:this._debuggerService,editorReady:()=>Promise.resolve(this._fileEditor.editor),getEditor:()=>this._fileEditor.editor,src:this._fileEditor.model.sharedModel})}dispose(){var e,t;this.isDisposed||(this.isDisposed=!0,null===(e=this._editorHandler)||void 0===e||e.dispose(),null===(t=this._editorHandler)||void 0===t||t.editor.setOptions({lineNumbers:this._hasLineNumber}),b.Signal.clearData(this))}}class E{constructor(e){this._debuggerService=e.debuggerService,this._notebookPanel=e.widget,this._cellMap=new w.ObservableMap,this._notebookPanel.content.model.cells.changed.connect(this._onCellsChanged,this),this._onCellsChanged()}dispose(){this.isDisposed||(this.isDisposed=!0,this._cellMap.values().forEach((e=>{var t;e.dispose(),null===(t=e.editor)||void 0===t||t.setOptions({...this._notebookPanel.content.editorConfig.code})})),this._cellMap.dispose(),b.Signal.clearData(this))}_onCellsChanged(e,t){var i;if(this._notebookPanel.content.widgets.forEach((e=>this._addEditorHandler(e))),"move"===(null==t?void 0:t.type))for(const e of t.newValues)null===(i=this._cellMap.get(e.id))||void 0===i||i.refreshBreakpoints()}_addEditorHandler(e){const t=e.model.id;if("code"!==e.model.type||this._cellMap.has(t))return;const i=e,s=new x({debuggerService:this._debuggerService,editorReady:async()=>(await i.ready,i.editor),getEditor:()=>i.editor,src:e.model.sharedModel});i.disposed.connect((()=>{this._cellMap.delete(t),s.dispose()})),this._cellMap.set(e.model.id,s)}}const H="debugger-icon";function R(e,t,i=!0,s){e&&(e.enabled=i,e.pressed=t,s&&(e.onClick=s))}class O{constructor(e){this._handlers={},this._contextKernelChangedHandlers={},this._kernelChangedHandlers={},this._statusChangedHandlers={},this._iopubMessageHandlers={},this._iconButtons={},this._type=e.type,this._shell=e.shell,this._service=e.service}get activeWidget(){return this._activeWidget}async update(e,t){if(!t)return delete this._kernelChangedHandlers[e.id],delete this._statusChangedHandlers[e.id],delete this._iopubMessageHandlers[e.id],this.updateWidget(e,t);const i=()=>{this.updateWidget(e,t)},s=this._kernelChangedHandlers[e.id];s&&t.kernelChanged.disconnect(s),this._kernelChangedHandlers[e.id]=i,t.kernelChanged.connect(i);const o=(i,s)=>{s.endsWith("restarting")&&this.updateWidget(e,t)},r=this._statusChangedHandlers[e.id];r&&t.statusChanged.disconnect(r),t.statusChanged.connect(o),this._statusChangedHandlers[e.id]=o;const n=(e,t)=>{t.parent_header!={}&&"execute_request"==t.parent_header.msg_type&&this._service.isStarted&&!this._service.hasStoppedThreads()&&this._service.displayDefinedVariables()},a=this._iopubMessageHandlers[e.id];return a&&t.iopubMessage.disconnect(a),t.iopubMessage.connect(n),this._iopubMessageHandlers[e.id]=n,this._activeWidget=e,this.updateWidget(e,t)}async updateContext(e,t){const i=()=>{const{session:i}=t;this.update(e,i)},s=this._contextKernelChangedHandlers[e.id];return s&&t.kernelChanged.disconnect(s),this._contextKernelChangedHandlers[e.id]=i,t.kernelChanged.connect(i),this.update(e,t.session)}async updateWidget(e,t){var i,o,r,n;if(!this._service.model||!t)return;const a=()=>this._shell.currentWidget===e,l=()=>{this._handlers[e.id]?e.node.setAttribute("data-jp-debugger","true"):e.node.removeAttribute("data-jp-debugger")},h=()=>{if(!this._handlers[e.id]){switch(this._type){case"notebook":this._handlers[e.id]=new E({debuggerService:this._service,widget:e});break;case"console":this._handlers[e.id]=new M({debuggerService:this._service,widget:e});break;case"file":this._handlers[e.id]=new k({debuggerService:this._service,widget:e});break;default:throw Error(`No handler for the type ${this._type}`)}l()}},c=()=>{var i,s,o,r;const n=this._handlers[e.id];n&&(n.dispose(),delete this._handlers[e.id],delete this._kernelChangedHandlers[e.id],delete this._statusChangedHandlers[e.id],delete this._iopubMessageHandlers[e.id],delete this._contextKernelChangedHandlers[e.id],(null===(s=null===(i=this._service.session)||void 0===i?void 0:i.connection)||void 0===s?void 0:s.path)!==(null==t?void 0:t.path)&&(null===(r=null===(o=this._service.session)||void 0===o?void 0:o.connection)||void 0===r?void 0:r.kernel)||this._service.model.clear(),l())},d=()=>{var e;return this._service.isStarted&&(null===(e=this._previousConnection)||void 0===e?void 0:e.id)===(null==t?void 0:t.id)},u=async()=>{this._service.session.connection=t,await this._service.stop()},_=async()=>{var e,i;this._service.session.connection=t,this._previousConnection=t,await this._service.restoreState(!0),await this._service.displayDefinedVariables(),(null===(i=null===(e=this._service.session)||void 0===e?void 0:e.capabilities)||void 0===i?void 0:i.supportsModulesRequest)&&await this._service.displayModules()},m=async()=>{if(!a())return;const t=this._iconButtons[e.id];d()?(await u(),c(),R(t,!1)):(await _(),h(),R(t,!0))};return((t=!0)=>{const i=this._iconButtons[e.id];i?R(i,this._service.isStarted,t,m):this._iconButtons[e.id]=function(e,t,i,o,r=v.nullTranslator){const n=r.load("jupyterlab"),a=new s.ToolbarButton({className:"jp-DebuggerBugButton",icon:s.bugIcon,tooltip:n.__("Enable Debugger"),pressedIcon:s.bugDotIcon,pressedTooltip:n.__("Disable Debugger"),disabledTooltip:n.__("Select a kernel that supports debugging to enable debugger"),enabled:i,pressed:o,onClick:t});return e.toolbar.insertBefore("kernelName",H,a)||e.toolbar.addItem(H,a),a}(e,m,this._service.isStarted,t)})(!1),e.disposed.connect((async()=>{d()&&await u(),c(),delete this._iconButtons[e.id],delete this._contextKernelChangedHandlers[e.id]})),await this._service.isAvailable(t)?(this._service.session?(this._previousConnection=(null===(i=this._service.session.connection)||void 0===i?void 0:i.kernel)?this._service.session.connection:null,this._service.session.connection=t):this._service.session=new vt.Session({connection:t}),await this._service.restoreState(!1),this._service.isStarted&&!this._service.hasStoppedThreads()&&(await this._service.displayDefinedVariables(),(null===(r=null===(o=this._service.session)||void 0===o?void 0:o.capabilities)||void 0===r?void 0:r.supportsModulesRequest)&&await this._service.displayModules()),R(this._iconButtons[e.id],this._service.isStarted,!0),this._service.isStarted?(h(),void(this._previousConnection=t)):(c(),this._service.session.connection=null!==(n=this._previousConnection)&&void 0!==n?n:t,void await this._service.restoreState(!1))):(c(),void R(this._iconButtons[e.id],!1,!1))}}const D=new s.LabIcon({name:"debugger:close-all",svgstr:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M16.4805 17.2481C16.8158 16.3972 17 15.4701 17 14.5C17 10.3579 13.6421 7.00001 9.5 7.00001C8.36314 7.00001 7.28536 7.25295 6.31986 7.70564C7.60064 6.0592 9.60074 5 11.8482 5C15.7142 5 18.8482 8.13401 18.8482 12C18.8482 14.0897 17.9325 15.9655 16.4805 17.2481Z" />\n    <path d="M19.1607 14.2481C19.496 13.3971 19.6801 12.4701 19.6801 11.5C19.6801 7.35786 16.3223 4 12.1801 4C11.0433 4 9.9655 4.25295 9.00001 4.70563C10.2808 3.05919 12.2809 2 14.5284 2C18.3944 2 21.5284 5.134 21.5284 9C21.5284 11.0897 20.6127 12.9655 19.1607 14.2481Z" />\n    <path d="M16 15C16 18.866 12.866 22 9 22C5.13401 22 2 18.866 2 15C2 11.134 5.13401 8 9 8C12.866 8 16 11.134 16 15ZM11.7914 11L13 12.2086L10.2086 15L13 17.7914L11.7914 19L9 16.2086L6.20857 19L5 17.7914L7.79143 15L5 12.2086L6.20857 11L9 13.7914L11.7914 11Z" />\n    </g>\n</svg>\n'}),z=new s.LabIcon({name:"debugger:pause",svgstr:'<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n    <g class="jp-icon3" fill="#616161">\n        <path d="m 7,6 h 4 V 18 H 7 Z" />\n        <path d="m 13,6 h 4 v 12 h -4 z" />\n    </g>\n</svg>\n'}),T=new s.LabIcon({name:"debugger:step-into",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n\t<g class="jp-icon3" fill="#616161">\n\t\t<path d="M7.99998 9.53198H8.54198L12.447 5.62698L11.386 4.56698L8.74898 7.17698L8.74898 0.999985H7.99998H7.25098L7.25098 7.17698L4.61398 4.56698L3.55298 5.62698L7.45798 9.53198H7.99998ZM9.95598 13.013C9.95598 14.1175 9.06055 15.013 7.95598 15.013C6.85141 15.013 5.95598 14.1175 5.95598 13.013C5.95598 11.9084 6.85141 11.013 7.95598 11.013C9.06055 11.013 9.95598 11.9084 9.95598 13.013Z"/>\n\t</g>\n</svg>\n'}),L=new s.LabIcon({name:"debugger:step-over",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n\t<g class="jp-icon3" fill="#616161">\n\t\t<path d="M14.25 5.75V1.75H12.75V4.2916C11.605 2.93303 9.83899 2.08334 7.90914 2.08334C4.73316 2.08334 1.98941 4.39036 1.75072 7.48075L1.72992 7.75H3.231L3.25287 7.5241C3.46541 5.32932 5.45509 3.58334 7.90914 3.58334C9.6452 3.58334 11.1528 4.45925 11.9587 5.75H9.12986V7.25H13.292L14.2535 6.27493V5.75H14.25ZM7.99997 14C9.10454 14 9.99997 13.1046 9.99997 12C9.99997 10.8954 9.10454 10 7.99997 10C6.8954 10 5.99997 10.8954 5.99997 12C5.99997 13.1046 6.8954 14 7.99997 14Z"/>\n\t</g>\n</svg>\n'}),B=new s.LabIcon({name:"debugger:step-out",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">\n\t<g class="jp-icon3" fill="#616161">\n\t\t<path d="M7.99998 1H7.45798L3.55298 4.905L4.61398 5.965L7.25098 3.355V9.532H7.99998H8.74898V3.355L11.386 5.965L12.447 4.905L8.54198 1H7.99998ZM9.95598 13.013C9.95598 14.1176 9.06055 15.013 7.95598 15.013C6.85141 15.013 5.95598 14.1176 5.95598 13.013C5.95598 11.9084 6.85141 11.013 7.95598 11.013C9.06055 11.013 9.95598 11.9084 9.95598 13.013Z"/>\n\t</g>\n</svg>\n'}),I=new s.LabIcon({name:"debugger:variable",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 4L1 4.5V12.5L1.5 13H4V12H2V5H4V4H1.5ZM14.5 13L15 12.5L15 4.5L14.5 4H12V5L14 5L14 12H12V13H14.5ZM8.79693 5L4.29693 7L4 7.45691V9.95691L4.24275 10.3857L6.74275 11.8857L7.20307 11.9138L11.7031 9.91381L12 9.45691V6.95691L11.7572 6.52816L9.25725 5.02816L8.79693 5ZM5 8.34V9.67381L6.5 10.5738V9.24L5 8.34ZM7.5 9.28184V10.6875L11 9.13197V7.72629L7.5 9.28184ZM10.4178 6.89071L8.96559 6.01936L5.58216 7.52311L7.03441 8.39445L10.4178 6.89071Z" fill="#007ACC"/>\n</svg>\n'}),W=new s.LabIcon({name:"debugger:view-breakpoint",svgstr:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <g class="jp-icon3" fill="#616161">\n        <path d="M5 2H15L20 7V20C20 20.5304 19.7893 21.0391 19.4142 21.4142C19.0391 21.7893 18.5304 22 18 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V14H4V16L8 13L4 10V12H3V4C3 3.46957 3.21071 2.96086 3.58579 2.58579C3.96086 2.21071 4.46957 2 5 2ZM12 18H16V16H12V18ZM12 14H18V12H12V14ZM12 10H18V8H12V10ZM10 14C10.5523 14 11 13.5523 11 13C11 12.4477 10.5523 12 10 12C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14Z"/>\n        <path d="M3 12V14H1V13V12H3Z"/>\n    </g>\n</svg>\n'}),V=new s.LabIcon({name:"debugger:open-kernel-source",svgstr:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n    <g class="jp-icon3" fill="#616161">\n        <path d="M5 2H15L20 7V20C20 20.5304 19.7893 21.0391 19.4142 21.4142C19.0391 21.7893 18.5304 22 18 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V14H4V16L8 13L4 10V12H3V4C3 3.46957 3.21071 2.96086 3.58579 2.58579C3.96086 2.21071 4.46957 2 5 2ZM12 18H16V16H12V18ZM12 14H18V12H12V14ZM12 10H18V8H12V10ZM10 14C10.5523 14 11 13.5523 11 13C11 12.4477 10.5523 12 10 12C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14Z"/>\n        <path d="M3 12V14H1V13V12H3Z"/>\n    </g>\n</svg>\n'});class A{constructor(){this._breakpoints=new Map,this._changed=new b.Signal(this),this._restored=new b.Signal(this),this._clicked=new b.Signal(this)}get changed(){return this._changed}get restored(){return this._restored}get clicked(){return this._clicked}get breakpoints(){return this._breakpoints}setBreakpoints(e,t){this._breakpoints.set(e,t),this._changed.emit(t)}getBreakpoints(e){var t;return null!==(t=this._breakpoints.get(e))&&void 0!==t?t:[]}restoreBreakpoints(e){this._breakpoints=e,this._restored.emit()}}class P{constructor(){this._state=[],this._currentFrame=null,this._framesChanged=new b.Signal(this),this._currentFrameChanged=new b.Signal(this)}get frames(){return this._state}set frames(e){this._state=e;const t=null!==this.frame?G.getFrameId(this.frame):"";e.find((e=>G.getFrameId(e)===t))||(this.frame=e[0]),this._framesChanged.emit(e)}get frame(){return this._currentFrame}set frame(e){this._currentFrame=e,this._currentFrameChanged.emit(e)}get framesChanged(){return this._framesChanged}get currentFrameChanged(){return this._currentFrameChanged}}var G;!function(e){e.getFrameId=function(e){var t;return`${null===(t=null==e?void 0:e.source)||void 0===t?void 0:t.path}-${null==e?void 0:e.id}`}}(G||(G={}));class N{constructor(e){this._currentSourceOpened=new b.Signal(this),this._currentSourceChanged=new b.Signal(this),this.currentFrameChanged=e.currentFrameChanged}get currentSourceOpened(){return this._currentSourceOpened}get currentSourceChanged(){return this._currentSourceChanged}get currentSource(){return this._currentSource}set currentSource(e){this._currentSource=e,this._currentSourceChanged.emit(e)}open(){this._currentSourceOpened.emit(this._currentSource)}}var j=i(19691);const F=(e,t)=>e.name<t.name?-1:e.name>t.name?1:0;class q{constructor(){this._filteredKernelSources=null,this._filter="",this._isDisposed=!1,this._kernelSources=null,this._changed=new b.Signal(this),this._filterChanged=new b.Signal(this),this._kernelSourceOpened=new b.Signal(this),this.refresh=this.refresh.bind(this),this._refreshDebouncer=new j.Debouncer(this.refresh,500)}get filter(){return this._filter}set filter(e){this._filter=e,this._filterChanged.emit(e),this._refreshDebouncer.invoke()}get isDisposed(){return this._isDisposed}get kernelSources(){return this._kernelSources}set kernelSources(e){this._kernelSources=e,this.refresh()}get changed(){return this._changed}get filterChanged(){return this._filterChanged}get kernelSourceOpened(){return this._kernelSourceOpened}dispose(){this._isDisposed||(this._isDisposed=!0,this._refreshDebouncer.dispose(),b.Signal.clearData(this))}open(e){this._kernelSourceOpened.emit(e)}getFilteredKernelSources(){const e=new RegExp(this._filter);return this._kernelSources.filter((t=>e.test(t.name)))}refresh(){this._kernelSources?(this._filteredKernelSources=this._filter?this.getFilteredKernelSources():this._kernelSources,this._filteredKernelSources.sort(F)):(this._kernelSources=new Array,this._filteredKernelSources=new Array),this._changed.emit(this._filteredKernelSources)}}class K{constructor(){this._selectedVariable=null,this._state=[],this._variableExpanded=new b.Signal(this),this._changed=new b.Signal(this)}get scopes(){return this._state}set scopes(e){this._state=e,this._changed.emit()}get changed(){return this._changed}get variableExpanded(){return this._variableExpanded}get selectedVariable(){return this._selectedVariable}set selectedVariable(e){this._selectedVariable=e}expandVariable(e){this._variableExpanded.emit(e)}}class X{constructor(){this._disposed=new b.Signal(this),this._isDisposed=!1,this._hasRichVariableRendering=!1,this._stoppedThreads=new Set,this._title="-",this._titleChanged=new b.Signal(this),this.breakpoints=new A,this.callstack=new P,this.variables=new K,this.sources=new N({currentFrameChanged:this.callstack.currentFrameChanged}),this.kernelSources=new q}get disposed(){return this._disposed}get hasRichVariableRendering(){return this._hasRichVariableRendering}set hasRichVariableRendering(e){this._hasRichVariableRendering=e}get isDisposed(){return this._isDisposed}get stoppedThreads(){return this._stoppedThreads}set stoppedThreads(e){this._stoppedThreads=e}get title(){return this._title}set title(e){e!==this._title&&(this._title=null!=e?e:"-",this._titleChanged.emit(e))}get titleChanged(){return this._titleChanged}dispose(){this._isDisposed||(this._isDisposed=!0,this.kernelSources.dispose(),this._disposed.emit())}clear(){this._stoppedThreads.clear();const e=new Map;this.breakpoints.restoreBreakpoints(e),this.callstack.frames=[],this.variables.scopes=[],this.sources.currentSource=null,this.kernelSources.kernelSources=null,this.title="-"}}var Y,U,$,Z,J,Q=i(91090),ee=i(60796),te=i(66375),ie=i(39233),se=i(99689),oe=i(39787);class re{constructor(){this._disposed=!1}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}onKeyDown(e,t){if(e.editable&&-1!==e.selectionModel.cursorRow&&-1!==e.selectionModel.cursorColumn){const i=String.fromCharCode(t.keyCode);if(/[a-zA-Z0-9-_ ]/.test(i)){const i={grid:e,row:e.selectionModel.cursorRow,column:e.selectionModel.cursorColumn};return e.editorController.edit(i),void("Space"===(0,ee.getKeyboardLayout)().keyForKeydownEvent(t)&&(t.stopPropagation(),t.preventDefault()))}}switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(t)){case"ArrowLeft":this.onArrowLeft(e,t);break;case"ArrowRight":this.onArrowRight(e,t);break;case"ArrowUp":this.onArrowUp(e,t);break;case"ArrowDown":this.onArrowDown(e,t);break;case"PageUp":this.onPageUp(e,t);break;case"PageDown":this.onPageDown(e,t);break;case"Escape":this.onEscape(e,t);break;case"Delete":this.onDelete(e,t);break;case"C":this.onKeyC(e,t);break;case"Enter":e.selectionModel&&(e.moveCursor(t.shiftKey?"up":"down"),e.scrollToCursor());break;case"Tab":e.selectionModel&&(e.moveCursor(t.shiftKey?"left":"right"),e.scrollToCursor(),t.stopPropagation(),t.preventDefault())}}onArrowLeft(e,t){t.preventDefault(),t.stopPropagation();let i=e.selectionModel,s=t.shiftKey,o=Q.Platform.accelKey(t);if(!i&&o)return void e.scrollTo(0,e.scrollY);if(!i)return void e.scrollByStep("left");let r=i.selectionMode;if("row"===r&&o)return void e.scrollTo(0,e.scrollY);if("row"===r)return void e.scrollByStep("left");let n,a,l,h,c,d,u,_=i.cursorRow,m=i.cursorColumn,p=i.currentSelection();o&&s?(n=p?p.r1:0,a=p?p.r2:0,l=p?p.c1:0,h=0,c=_,d=m,u="current"):s?(n=p?p.r1:0,a=p?p.r2:0,l=p?p.c1:0,h=p?p.c2-1:0,c=_,d=m,u="current"):o?(n=_,a=_,l=0,h=0,c=n,d=l,u="all"):(n=_,a=_,l=m-1,h=m-1,c=n,d=l,u="all"),i.select({r1:n,c1:l,r2:a,c2:h,cursorRow:c,cursorColumn:d,clear:u}),p=i.currentSelection(),p&&(s||"column"===r?e.scrollToColumn(p.c2):e.scrollToCursor())}onArrowRight(e,t){t.preventDefault(),t.stopPropagation();let i=e.selectionModel,s=t.shiftKey,o=Q.Platform.accelKey(t);if(!i&&o)return void e.scrollTo(e.maxScrollX,e.scrollY);if(!i)return void e.scrollByStep("right");let r=i.selectionMode;if("row"===r&&o)return void e.scrollTo(e.maxScrollX,e.scrollY);if("row"===r)return void e.scrollByStep("right");let n,a,l,h,c,d,u,_=i.cursorRow,m=i.cursorColumn,p=i.currentSelection();o&&s?(n=p?p.r1:0,a=p?p.r2:0,l=p?p.c1:0,h=1/0,c=_,d=m,u="current"):s?(n=p?p.r1:0,a=p?p.r2:0,l=p?p.c1:0,h=p?p.c2+1:0,c=_,d=m,u="current"):o?(n=_,a=_,l=1/0,h=1/0,c=n,d=l,u="all"):(n=_,a=_,l=m+1,h=m+1,c=n,d=l,u="all"),i.select({r1:n,c1:l,r2:a,c2:h,cursorRow:c,cursorColumn:d,clear:u}),p=i.currentSelection(),p&&(s||"column"===r?e.scrollToColumn(p.c2):e.scrollToCursor())}onArrowUp(e,t){t.preventDefault(),t.stopPropagation();let i=e.selectionModel,s=t.shiftKey,o=Q.Platform.accelKey(t);if(!i&&o)return void e.scrollTo(e.scrollX,0);if(!i)return void e.scrollByStep("up");let r=i.selectionMode;if("column"===r&&o)return void e.scrollTo(e.scrollX,0);if("column"===r)return void e.scrollByStep("up");let n,a,l,h,c,d,u,_=i.cursorRow,m=i.cursorColumn,p=i.currentSelection();o&&s?(n=p?p.r1:0,a=0,l=p?p.c1:0,h=p?p.c2:0,c=_,d=m,u="current"):s?(n=p?p.r1:0,a=p?p.r2-1:0,l=p?p.c1:0,h=p?p.c2:0,c=_,d=m,u="current"):o?(n=0,a=0,l=m,h=m,c=n,d=l,u="all"):(n=_-1,a=_-1,l=m,h=m,c=n,d=l,u="all"),i.select({r1:n,c1:l,r2:a,c2:h,cursorRow:c,cursorColumn:d,clear:u}),p=i.currentSelection(),p&&(s||"row"===r?e.scrollToRow(p.r2):e.scrollToCursor())}onArrowDown(e,t){t.preventDefault(),t.stopPropagation();let i=e.selectionModel,s=t.shiftKey,o=Q.Platform.accelKey(t);if(!i&&o)return void e.scrollTo(e.scrollX,e.maxScrollY);if(!i)return void e.scrollByStep("down");let r=i.selectionMode;if("column"===r&&o)return void e.scrollTo(e.scrollX,e.maxScrollY);if("column"===r)return void e.scrollByStep("down");let n,a,l,h,c,d,u,_=i.cursorRow,m=i.cursorColumn,p=i.currentSelection();o&&s?(n=p?p.r1:0,a=1/0,l=p?p.c1:0,h=p?p.c2:0,c=_,d=m,u="current"):s?(n=p?p.r1:0,a=p?p.r2+1:0,l=p?p.c1:0,h=p?p.c2:0,c=_,d=m,u="current"):o?(n=1/0,a=1/0,l=m,h=m,c=n,d=l,u="all"):(n=_+1,a=_+1,l=m,h=m,c=n,d=l,u="all"),i.select({r1:n,c1:l,r2:a,c2:h,cursorRow:c,cursorColumn:d,clear:u}),p=i.currentSelection(),p&&(s||"row"===r?e.scrollToRow(p.r2):e.scrollToCursor())}onPageUp(e,t){if(Q.Platform.accelKey(t))return;t.preventDefault(),t.stopPropagation();let i=e.selectionModel;if(!i||"column"===i.selectionMode)return void e.scrollByPage("up");let s,o,r,n,a,l,h,c=Math.floor(e.pageHeight/e.defaultSizes.rowHeight),d=i.cursorRow,u=i.cursorColumn,_=i.currentSelection();t.shiftKey?(s=_?_.r1:0,o=_?_.r2-c:0,r=_?_.c1:0,n=_?_.c2:0,a=d,l=u,h="current"):(s=_?_.r1-c:0,o=s,r=u,n=u,a=s,l=u,h="all"),i.select({r1:s,c1:r,r2:o,c2:n,cursorRow:a,cursorColumn:l,clear:h}),_=i.currentSelection(),_&&e.scrollToRow(_.r2)}onPageDown(e,t){if(Q.Platform.accelKey(t))return;t.preventDefault(),t.stopPropagation();let i=e.selectionModel;if(!i||"column"===i.selectionMode)return void e.scrollByPage("down");let s,o,r,n,a,l,h,c=Math.floor(e.pageHeight/e.defaultSizes.rowHeight),d=i.cursorRow,u=i.cursorColumn,_=i.currentSelection();t.shiftKey?(s=_?_.r1:0,o=_?_.r2+c:0,r=_?_.c1:0,n=_?_.c2:0,a=d,l=u,h="current"):(s=_?_.r1+c:0,o=s,r=u,n=u,a=s,l=u,h="all"),i.select({r1:s,c1:r,r2:o,c2:n,cursorRow:a,cursorColumn:l,clear:h}),_=i.currentSelection(),_&&e.scrollToRow(_.r2)}onEscape(e,t){e.selectionModel&&e.selectionModel.clear()}onDelete(e,t){if(e.editable&&!e.selectionModel.isEmpty){const t=e.dataModel;let i=t.rowCount("body")-1,s=t.columnCount("body")-1;for(let o of e.selectionModel.selections()){let e=Math.max(0,Math.min(o.r1,i)),r=Math.max(0,Math.min(o.c1,s)),n=Math.max(0,Math.min(o.r2,i)),a=Math.max(0,Math.min(o.c2,s));for(let i=e;i<=n;++i)for(let e=r;e<=a;++e)t.setData("body",i,e,null)}}}onKeyC(e,t){!t.shiftKey&&Q.Platform.accelKey(t)&&(t.preventDefault(),t.stopPropagation(),e.copyToClipboard())}}class ne{}!function(e){e.resolveOption=function(e,t){return"function"==typeof e?e(t):e}}(ne||(ne={}));class ae extends ne{constructor(e={}){super(),this.font=e.font||"12px sans-serif",this.textColor=e.textColor||"#000000",this.backgroundColor=e.backgroundColor||"",this.verticalAlignment=e.verticalAlignment||"center",this.horizontalAlignment=e.horizontalAlignment||"left",this.format=e.format||ae.formatGeneric(),this.elideDirection=e.elideDirection||"right",this.wrapText=e.wrapText||!1}paint(e,t){this.drawBackground(e,t),this.drawText(e,t)}drawBackground(e,t){let i=ne.resolveOption(this.backgroundColor,t);i&&(e.fillStyle=i,e.fillRect(t.x,t.y,t.width,t.height))}drawText(e,t){let i=ne.resolveOption(this.font,t);if(!i)return;let s=ne.resolveOption(this.textColor,t);if(!s)return;let o=(0,this.format)(t);if(!o)return;let r=ne.resolveOption(this.verticalAlignment,t),n=ne.resolveOption(this.horizontalAlignment,t),a=ne.resolveOption(this.elideDirection,t),l=ne.resolveOption(this.wrapText,t),h=t.height-("center"===r?1:2);if(h<=0)return;let c,d,u,_=ae.measureFontHeight(i);switch(r){case"top":d=t.y+2+_;break;case"center":d=t.y+t.height/2+_/2;break;case"bottom":d=t.y+t.height-2;break;default:throw"unreachable"}switch(n){case"left":c=t.x+8,u=t.width-14;break;case"center":c=t.x+t.width/2,u=t.width;break;case"right":c=t.x+t.width-8,u=t.width-14;break;default:throw"unreachable"}_>h&&(e.beginPath(),e.rect(t.x,t.y,t.width,t.height-1),e.clip()),e.font=i,e.fillStyle=s,e.textAlign=n,e.textBaseline="bottom";let m=e.measureText(o).width;if(l&&m>u){e.beginPath(),e.rect(t.x,t.y,t.width,t.height-1),e.clip();const i=o.split(/\s(?=\b)/);let s=d,r=i.shift();if(0===i.length){let t=e.measureText(r).width;for(;t>u&&""!==r;)for(let i=r.length;i>0;i--){const o=r.substring(0,i);if(e.measureText(o).width<u||1===o.length){const n=r.substring(i,r.length);r=n,t=e.measureText(r).width,e.fillText(o,c,s),s+=_;break}}}else for(;0!==i.length;){const t=i.shift(),o=[r,t].join(" ");e.measureText(o).width>u?(e.fillText(r,c,s),s+=_,r=t):r=o}return void e.fillText(r,c,s)}let p="…";if("right"===a)for(;m>u&&o.length>1;)o=o.length>4&&m>=2*u?o.substring(0,o.length/2+1)+p:o.substring(0,o.length-2)+p,m=e.measureText(o).width;else for(;m>u&&o.length>1;)o=o.length>4&&m>=2*u?p+o.substring(o.length/2):p+o.substring(2),m=e.measureText(o).width;e.fillText(o,c,d)}}!function(e){e.formatGeneric=function(e={}){let t=e.missing||"";return({value:e})=>null==e?t:String(e)},e.formatFixed=function(e={}){let t=e.digits,i=e.missing||"";return({value:e})=>null==e?i:Number(e).toFixed(t)},e.formatPrecision=function(e={}){let t=e.digits,i=e.missing||"";return({value:e})=>null==e?i:Number(e).toPrecision(t)},e.formatExponential=function(e={}){let t=e.digits,i=e.missing||"";return({value:e})=>null==e?i:Number(e).toExponential(t)},e.formatIntlNumber=function(e={}){let t=e.missing||"",i=new Intl.NumberFormat(e.locales,e.options);return({value:e})=>null==e?t:i.format(e)},e.formatDate=function(e={}){let t=e.missing||"";return({value:e})=>null==e?t:e instanceof Date?e.toDateString():new Date(e).toDateString()},e.formatTime=function(e={}){let t=e.missing||"";return({value:e})=>null==e?t:e instanceof Date?e.toTimeString():new Date(e).toTimeString()},e.formatISODateTime=function(e={}){let t=e.missing||"";return({value:e})=>null==e?t:e instanceof Date?e.toISOString():new Date(e).toISOString()},e.formatUTCDateTime=function(e={}){let t=e.missing||"";return({value:e})=>null==e?t:e instanceof Date?e.toUTCString():new Date(e).toUTCString()},e.formatIntlDateTime=function(e={}){let t=e.missing||"",i=new Intl.DateTimeFormat(e.locales,e.options);return({value:e})=>null==e?t:i.format(e)},e.measureFontHeight=function(e){let t=Y.fontHeightCache[e];if(void 0!==t)return t;Y.fontMeasurementGC.font=e;let i=Y.fontMeasurementGC.font;return Y.fontMeasurementNode.style.font=i,document.body.appendChild(Y.fontMeasurementNode),t=Y.fontMeasurementNode.offsetHeight,document.body.removeChild(Y.fontMeasurementNode),Y.fontHeightCache[e]=t,Y.fontHeightCache[i]=t,t}}(ae||(ae={})),function(e){e.fontHeightCache=Object.create(null),e.fontMeasurementNode=(()=>{let e=document.createElement("div");return e.style.position="absolute",e.style.top="-99999px",e.style.left="-99999px",e.style.visibility="hidden",e.textContent="M",e})(),e.fontMeasurementGC=(()=>{let e=document.createElement("canvas");return e.width=0,e.height=0,e.getContext("2d")})()}(Y||(Y={}));class le extends ae{constructor(e={}){e.textColor=e.textColor||"navy",e.font=e.font||"bold 12px sans-serif",super(e),this.url=e.url,this.urlName=e.urlName}drawText(e,t){let i=ne.resolveOption(this.font,t);if(!i)return;let s=ne.resolveOption(this.urlName,t),o=ne.resolveOption(this.textColor,t);if(!o)return;let r;if(r=(0,this.format)(s?{...t,value:s}:t),!r)return;let n=ne.resolveOption(this.verticalAlignment,t),a=ne.resolveOption(this.horizontalAlignment,t),l=ne.resolveOption(this.elideDirection,t),h=ne.resolveOption(this.wrapText,t),c=t.height-("center"===n?1:2);if(c<=0)return;let d,u,_,m=le.measureFontHeight(i);switch(n){case"top":u=t.y+2+m;break;case"center":u=t.y+t.height/2+m/2;break;case"bottom":u=t.y+t.height-2;break;default:throw"unreachable"}switch(a){case"left":d=t.x+8,_=t.width-14;break;case"center":d=t.x+t.width/2,_=t.width;break;case"right":d=t.x+t.width-8,_=t.width-14;break;default:throw"unreachable"}m>c&&(e.beginPath(),e.rect(t.x,t.y,t.width,t.height-1),e.clip()),e.font=i,e.fillStyle=o,e.textAlign=a,e.textBaseline="bottom";let p=e.measureText(r).width;if(h&&p>_){e.beginPath(),e.rect(t.x,t.y,t.width,t.height-1),e.clip();const i=r.split(/\s(?=\b)/);let s=u,o=i.shift();if(0===i.length){let t=e.measureText(o).width;for(;t>_&&""!==o;)for(let i=o.length;i>0;i--){const r=o.substring(0,i);if(e.measureText(r).width<_||1===r.length){const n=o.substring(i,o.length);o=n,t=e.measureText(o).width,e.fillText(r,d,s),s+=m;break}}}else for(;0!==i.length;){const t=i.shift(),r=[o,t].join(" ");e.measureText(r).width>_?(e.fillText(o,d,s),s+=m,o=t):o=r}return void e.fillText(o,d,s)}let g="…";if("right"===l)for(;p>_&&r.length>1;)r=r.length>4&&p>=2*_?r.substring(0,r.length/2+1)+g:r.substring(0,r.length-2)+g,p=e.measureText(r).width;else for(;p>_&&r.length>1;)r=r.length>4&&p>=2*_?g+r.substring(r.length/2):g+r.substring(2),p=e.measureText(r).width;e.fillText(r,d,u)}}!function(e){function t(e,t,i){return"row"===i?e.r1>=t.r1&&e.r1<=t.r2||e.r2>=t.r1&&e.r2<=t.r2||t.r1>=e.r1&&t.r1<=e.r2||t.r2>=e.r1&&t.r2<=e.r2:e.c1>=t.c1&&e.c1<=t.c2||e.c2>=t.c1&&e.c2<=t.c2||t.c1>=e.c1&&t.c1<=e.c2||t.c2>=e.c1&&t.c2<=e.c2}function i(e,t){return(e.r1>=t.r1&&e.r1<=t.r2||e.r2>=t.r1&&e.r2<=t.r2||t.r1>=e.r1&&t.r1<=e.r2||t.r2>=e.r1&&t.r2<=e.r2)&&(e.c1>=t.c1&&e.c1<=t.c2||e.c2>=t.c1&&e.c2<=t.c2||t.c1>=e.c1&&t.c1<=e.c2||t.c2>=e.c1&&t.c2<=e.c2)}function s(e,t,i,s){const o=e.groupCount(t);for(let r=0;r<o;r++){const o=e.group(t,r);if(i>=o.r1&&i<=o.r2&&s>=o.c1&&s<=o.c2)return r}return-1}function o(e,t){let i=[];const s=e.groupCount(t);for(let o=0;o<s;o++){const s=e.group(t,o);i.push(s)}return i}function r(e){let t=Number.MAX_VALUE,i=Number.MIN_VALUE,s=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const r of e)t=Math.min(t,r.r1),i=Math.max(i,r.r2),s=Math.min(s,r.c1),o=Math.max(o,r.c2);return{r1:t,r2:i,c1:s,c2:o}}function n(e,t,i){let s=[];const o=e.groupCount(t);for(let r=0;r<o;r++){const o=e.group(t,r);i>=o.r1&&i<=o.r2&&s.push(o)}return s}function a(e,t,i){let s=[];const o=e.groupCount(t);for(let r=0;r<o;r++){const o=e.group(t,r);i>=o.c1&&i<=o.c2&&s.push(o)}return s}e.areCellsMerged=function(e,t,i,s){const o=e.groupCount(t),[r,n]=i,[a,l]=s;for(let i=0;i<o;i++){const s=e.group(t,i);if(r>=s.r1&&r<=s.r2&&n>=s.c1&&n<=s.c2&&a>=s.r1&&a<=s.r2&&l>=s.c1&&l<=s.c2)return!0}return!1},e.calculateMergeOffsets=function(e,i,s,l,h){let c=0,d=0,u=[];for(const t of i)u=u.concat(o(e,t));let _=[];if("row"===s)for(const t of i)_=_.concat(n(e,t,h));else for(const t of i)_=_.concat(a(e,t,h));if(0===_.length)return[0,0,{r1:-1,r2:-1,c1:-1,c2:-1}];let m=_[0];for(let e=0;e<u.length;e++){const i=u[e];t(m,i,s)&&(m=r([i,m]),u.splice(e,1),e=0)}let p=m.r1,g=m.r2;for(let e=h-1;e>=p;e--)c+=l.sizeOf(e);for(let e=h+1;e<=g;e++)d+=l.sizeOf(e);return[c,d,m]},e.areCellGroupsIntersectingAtAxis=t,e.areCellGroupsIntersecting=i,e.getGroupIndex=s,e.getGroup=function(e,t,i,o){const r=s(e,t,i,o);return-1===r?null:e.group(t,r)},e.getCellGroupsAtRegion=o,e.joinCellGroups=r,e.joinCellGroupWithMergedCellGroups=function(e,t,s){let n={...t};const a=o(e,s);for(let e=0;e<a.length;e++){const t=a[e];i(n,t)&&(n=r([n,t]))}return n},e.getCellGroupsAtRow=n,e.getCellGroupsAtColumn=a,e.isCellGroupAbove=function(e,t){return t.r2>=e.r1},e.isCellGroupBelow=function(e,t){return t.r1<=e.r2},e.joinCellGroupsIntersectingAtAxis=function(t,i,s,o){let r=[];if("row"===s)for(const s of i)for(let i=o.r1;i<=o.r2;i++)r=r.concat(e.getCellGroupsAtRow(t,s,i));else for(const s of i)for(let i=o.c1;i<=o.c2;i++)r=r.concat(e.getCellGroupsAtColumn(t,s,i));let n=e.joinCellGroups(r);if(r.length>0){let o=[];for(const s of i)o=o.concat(e.getCellGroupsAtRegion(t,s));for(let t=0;t<o.length;t++){const i=o[t];e.areCellGroupsIntersectingAtAxis(n,i,s)&&(n=e.joinCellGroups([i,n]),o.splice(t,1),t=0)}}return n}}(U||(U={}));class he{constructor(){this._disposed=!1,this._pressData=null}dispose(){this._disposed||(this.release(),this._disposed=!0)}get isDisposed(){return this._disposed}release(){this._pressData&&("select"===this._pressData.type&&(this._pressData.timeout=-1),this._pressData.override.dispose(),this._pressData=null)}onMouseHover(e,t){let i=e.hitTest(t.clientX,t.clientY),s=$.resizeHandleForHitTest(i),o=this.cursorForHandle(s);const r=$.createCellConfigObject(e,i);r&&e.cellRenderers.get(r)instanceof le&&(o=this.cursorForHandle("hyperlink")),e.viewport.node.style.cursor=o}onMouseLeave(e,t){e.viewport.node.style.cursor=""}onMouseDown(e,t){let{clientX:i,clientY:s}=t,o=e.hitTest(i,s);const{region:r,row:n,column:a}=o;if("void"===r)return;let l=t.shiftKey,h=Q.Platform.accelKey(t);if(e){const t=$.createCellConfigObject(e,o);let i=e.cellRenderers.get(t);if(i instanceof le){let s=ne.resolveOption(i.url,t);if(s||(s=ae.formatGeneric()(t)),h){window.open(s);const t=this.cursorForHandle("none");return void(e.viewport.node.style.cursor=t)}}}if("body"===r){let t=e.selectionModel;if(!t)return;let i,s,o,c,d,u,_,m=te.Drag.overrideCursor("default");return this._pressData={type:"select",region:r,row:n,column:a,override:m,localX:-1,localY:-1,timeout:-1},h?(i=n,o=n,s=a,c=a,d=n,u=a,_="none"):l?(i=t.cursorRow,o=n,s=t.cursorColumn,c=a,d=t.cursorRow,u=t.cursorColumn,_="current"):(i=n,o=n,s=a,c=a,d=n,u=a,_="all"),void t.select({r1:i,c1:s,r2:o,c2:c,cursorRow:d,cursorColumn:u,clear:_})}let c=$.resizeHandleForHitTest(o),d=this.cursorForHandle(c);if("left"===c||"right"===c){const t="column-resize";let s="column-header"===r?"body":"row-header",o="left"===c?a-1:a,n=e.columnSize(s,o),l=te.Drag.overrideCursor(d);return void(this._pressData={type:t,region:s,index:o,size:n,clientX:i,override:l})}if("top"===c||"bottom"===c){const t="row-resize";let i="row-header"===r?"body":"column-header",o="top"===c?n-1:n,a=e.rowSize(i,o),l=te.Drag.overrideCursor(d);return void(this._pressData={type:t,region:i,index:o,size:a,clientY:s,override:l})}let u=e.selectionModel;if(!u)return;let _,m,p,g,f,v,w,b=te.Drag.overrideCursor("default");if(this._pressData={type:"select",region:r,row:n,column:a,override:b,localX:-1,localY:-1,timeout:-1},"corner-header"===r)_=0,p=1/0,m=0,g=1/0,f=h?0:l?u.cursorRow:0,v=h?0:l?u.cursorColumn:0,w=h?"none":l?"current":"all";else if("row-header"===r){_=h?n:l?u.cursorRow:n,p=n;const t={r1:_,c1:0,r2:p,c2:0},i=U.joinCellGroupsIntersectingAtAxis(e.dataModel,["row-header","body"],"row",t);i.r1!=Number.MAX_VALUE&&(_=i.r1,p=i.r2),m=0,g=1/0,f=h?n:l?u.cursorRow:n,v=h?0:l?u.cursorColumn:0,w=h?"none":l?"current":"all"}else if("column-header"===r){_=0,p=1/0,m=h?a:l?u.cursorColumn:a,g=a;const t={r1:0,c1:m,r2:0,c2:g},i=U.joinCellGroupsIntersectingAtAxis(e.dataModel,["column-header","body"],"column",t);i.c1!=Number.MAX_VALUE&&(m=i.c1,g=i.c2),f=h?0:l?u.cursorRow:0,v=h?a:l?u.cursorColumn:a,w=h?"none":l?"current":"all"}else _=h?n:l?u.cursorRow:n,p=n,m=h?a:l?u.cursorColumn:a,g=a,f=h?n:l?u.cursorRow:n,v=h?a:l?u.cursorColumn:a,w=h?"none":l?"current":"all";u.select({r1:_,c1:m,r2:p,c2:g,cursorRow:f,cursorColumn:v,clear:w})}onMouseMove(e,t){const i=this._pressData;if(!i)return;if("row-resize"===i.type){let s=t.clientY-i.clientY;return void e.resizeRow(i.region,i.index,i.size+s)}if("column-resize"===i.type){let s=t.clientX-i.clientX;return void e.resizeColumn(i.region,i.index,i.size+s)}if("corner-header"===i.region)return;let s=e.selectionModel;if(!s)return;let{lx:o,ly:r}=e.mapToLocal(t.clientX,t.clientY);i.localX=o,i.localY=r;let n=e.headerWidth,a=e.headerHeight,l=e.viewportWidth,h=e.viewportHeight,c=e.scrollX,d=e.scrollY,u=e.maxScrollY,_=e.maxScrollY,m=s.selectionMode,p=-1;if("row-header"===i.region||"row"===m?r<a&&d>0?p=$.computeTimeout(a-r):r>=h&&d<_&&(p=$.computeTimeout(r-h)):"column-header"===i.region||"column"===m?o<n&&c>0?p=$.computeTimeout(n-o):o>=l&&c<u&&(p=$.computeTimeout(o-l)):o<n&&c>0?p=$.computeTimeout(n-o):o>=l&&c<u?p=$.computeTimeout(o-l):r<a&&d>0?p=$.computeTimeout(a-r):r>=h&&d<_&&(p=$.computeTimeout(r-h)),p>=0)return void(i.timeout<0?(i.timeout=p,setTimeout((()=>{$.autoselect(e,i)}),p)):i.timeout=p);i.timeout=-1;let g,f,v,w,{vx:b,vy:y}=e.mapToVirtual(t.clientX,t.clientY);b=Math.max(0,Math.min(b,e.bodyWidth-1)),y=Math.max(0,Math.min(y,e.bodyHeight-1));let S=s.cursorRow,C=s.cursorColumn;if("row-header"===i.region||"row"===m){g=i.row,v=e.rowAt("body",y);const t={r1:g,c1:0,r2:v,c2:0},s=U.joinCellGroupsIntersectingAtAxis(e.dataModel,["row-header","body"],"row",t);s.r1!=Number.MAX_VALUE&&(g=Math.min(g,s.r1),v=Math.max(v,s.r2)),f=0,w=1/0}else if("column-header"===i.region||"column"===m){g=0,v=1/0,f=i.column,w=e.columnAt("body",b);const t={r1:0,c1:f,r2:0,c2:w},s=U.joinCellGroupsIntersectingAtAxis(e.dataModel,["column-header","body"],"column",t);s.c1!=Number.MAX_VALUE&&(f=s.c1,w=s.c2)}else g=S,v=e.rowAt("body",y),f=C,w=e.columnAt("body",b);s.select({r1:g,c1:f,r2:v,c2:w,cursorRow:S,cursorColumn:C,clear:"current"})}onMouseUp(e,t){this.release()}onMouseDoubleClick(e,t){if(!e.dataModel)return void this.release();let{clientX:i,clientY:s}=t,o=e.hitTest(i,s),{region:r,row:n,column:a}=o;if("void"!==r){if("body"===r&&e.editable){const t={grid:e,row:n,column:a};e.editorController.edit(t)}this.release()}else this.release()}onContextMenu(e,t){}onWheel(e,t){if(this._pressData)return;let i=t.deltaX,s=t.deltaY;switch(t.deltaMode){case 0:break;case 1:{let t=e.defaultSizes;i*=t.columnWidth,s*=t.rowHeight;break}case 2:i*=e.pageWidth,s*=e.pageHeight;break;default:throw"unreachable"}e.scrollBy(i,s)}cursorForHandle(e){return $.cursorMap[e]}get pressData(){return this._pressData}}!function(e){e.createCellConfigObject=function(e,t){const{region:i,row:s,column:o}=t;if("void"===i)return;const r=e.dataModel.data(i,s,o),n=e.dataModel.metadata(i,s,o);return{...t,value:r,metadata:n}},e.resizeHandleForHitTest=function(e){let t,i=e.row,s=e.column,o=e.x,r=e.y,n=e.width-e.x,a=e.height-e.y;switch(e.region){case"corner-header":case"column-header":case"row-header":t=s>0&&o<=5?"left":n<=6?"right":i>0&&r<=5?"top":a<=6?"bottom":"none";break;case"body":case"void":t="none";break;default:throw"unreachable"}return t},e.autoselect=function e(t,i){if(i.timeout<0)return;let s=t.selectionModel;if(!s)return;let o=s.currentSelection();if(!o)return;let r=i.localX,n=i.localY,a=o.r1,l=o.c1,h=o.r2,c=o.c2,d=s.cursorRow,u=s.cursorColumn,_=t.headerWidth,m=t.headerHeight,p=t.viewportWidth,g=t.viewportHeight,f=s.selectionMode;"row-header"===i.region||"row"===f?h+=n<=m?-1:n>=g?1:0:("column-header"===i.region||"column"===f||(h+=n<=m?-1:n>=g?1:0),c+=r<=_?-1:r>=p?1:0),s.select({r1:a,c1:l,r2:h,c2:c,cursorRow:d,cursorColumn:u,clear:"current"}),o=s.currentSelection(),o&&("row-header"===i.region||"row"===f?t.scrollToRow(o.r2):"column-header"===i.region||"column"==f?t.scrollToColumn(o.c2):"cell"===f&&t.scrollToCell(o.r2,o.c2),setTimeout((()=>{e(t,i)}),i.timeout))},e.computeTimeout=function(e){return 5+120*(1-Math.min(128,Math.abs(e))/128)},e.cursorMap={top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom:"ns-resize",hyperlink:"pointer",none:"default"}}($||($={}));class ce{constructor(e){this._changed=new b.Signal(this),this._selectionMode="cell",this.dataModel=e.dataModel,this._selectionMode=e.selectionMode||"cell",this.dataModel.changed.connect(this.onDataModelChanged,this)}get changed(){return this._changed}get selectionMode(){return this._selectionMode}set selectionMode(e){this._selectionMode!==e&&(this._selectionMode=e,this.clear())}isRowSelected(e){return(0,ie.some)(this.selections(),(t=>Z.containsRow(t,e)))}isColumnSelected(e){return(0,ie.some)(this.selections(),(t=>Z.containsColumn(t,e)))}isCellSelected(e,t){return(0,ie.some)(this.selections(),(i=>Z.containsCell(i,e,t)))}onDataModelChanged(e,t){}emitChanged(){this._changed.emit(void 0)}}!function(e){function t(e,t){let{r1:i,r2:s}=e;return t>=i&&t<=s||t>=s&&t<=i}function i(e,t){let{c1:i,c2:s}=e;return t>=i&&t<=s||t>=s&&t<=i}e.containsRow=t,e.containsColumn=i,e.containsCell=function(e,s,o){return t(e,s)&&i(e,o)}}(Z||(Z={}));class de extends ce{constructor(){super(...arguments),this._cursorRow=-1,this._cursorColumn=-1,this._cursorRectIndex=-1,this._selections=[]}get isEmpty(){return 0===this._selections.length}get cursorRow(){return this._cursorRow}get cursorColumn(){return this._cursorColumn}moveCursorWithinSelections(e){if(this.isEmpty||-1===this.cursorRow||-1===this._cursorColumn)return;const t=this._selections[0];if(1===this._selections.length&&t.r1===t.r2&&t.c1===t.c2)return;-1===this._cursorRectIndex&&(this._cursorRectIndex=this._selections.length-1);let i=this._selections[this._cursorRectIndex];const s="down"===e?1:"up"===e?-1:0,o="right"===e?1:"left"===e?-1:0;let r=this._cursorRow+s,n=this._cursorColumn+o;const a=Math.min(i.r1,i.r2),l=Math.max(i.r1,i.r2),h=Math.min(i.c1,i.c2),c=Math.max(i.c1,i.c2),d=()=>{this._cursorRectIndex=(this._cursorRectIndex+1)%this._selections.length,i=this._selections[this._cursorRectIndex],r=Math.min(i.r1,i.r2),n=Math.min(i.c1,i.c2)},u=()=>{this._cursorRectIndex=0===this._cursorRectIndex?this._selections.length-1:this._cursorRectIndex-1,i=this._selections[this._cursorRectIndex],r=Math.max(i.r1,i.r2),n=Math.max(i.c1,i.c2)};r>l?(r=a,n+=1,n>c&&d()):r<a?(r=l,n-=1,n<h&&u()):n>c?(n=h,r+=1,r>l&&d()):n<h&&(n=c,r-=1,r<a&&u()),this._cursorRow=r,this._cursorColumn=n,this.emitChanged()}currentSelection(){return this._selections[this._selections.length-1]||null}*selections(){yield*this._selections}select(e){let t=this.dataModel.rowCount("body"),i=this.dataModel.columnCount("body");if(t<=0||i<=0)return;let{r1:s,c1:o,r2:r,c2:n,cursorRow:a,cursorColumn:l,clear:h}=e;"all"===h?this._selections.length=0:"current"===h&&this._selections.pop(),s=Math.max(0,Math.min(s,t-1)),r=Math.max(0,Math.min(r,t-1)),o=Math.max(0,Math.min(o,i-1)),n=Math.max(0,Math.min(n,i-1));let c=!1;"row"===this.selectionMode?(o=0,n=i-1,c=0!==this._selections.filter((e=>e.r1===s)).length,this._selections=c?this._selections.filter((e=>e.r1!==s)):this._selections):"column"===this.selectionMode&&(s=0,r=t-1,c=0!==this._selections.filter((e=>e.c1===o)).length,this._selections=c?this._selections.filter((e=>e.c1!==o)):this._selections);let d=a,u=l;(d<0||d<s&&d<r||d>s&&d>r)&&(d=s),(u<0||u<o&&u<n||u>o&&u>n)&&(u=o),this._cursorRow=d,this._cursorColumn=u,this._cursorRectIndex=this._selections.length,c||this._selections.push({r1:s,c1:o,r2:r,c2:n}),this.emitChanged()}clear(){0!==this._selections.length&&(this._cursorRow=-1,this._cursorColumn=-1,this._cursorRectIndex=-1,this._selections.length=0,this.emitChanged())}onDataModelChanged(e,t){if(0===this._selections.length)return;if("cells-changed"===t.type)return;if("rows-moved"===t.type||"columns-moved"===t.type)return;let i=e.rowCount("body")-1,s=e.columnCount("body")-1;if(i<0||s<0)return this._selections.length=0,void this.emitChanged();let o=this.selectionMode,r=0;for(let e=0,t=this._selections.length;e<t;++e){let{r1:t,c1:n,r2:a,c2:l}=this._selections[e];i<t&&i<a||s<n&&s<l||("row"===o?(t=Math.max(0,Math.min(t,i)),a=Math.max(0,Math.min(a,i)),n=0,l=s):"column"===o?(t=0,a=i,n=Math.max(0,Math.min(n,s)),l=Math.max(0,Math.min(l,s))):(t=Math.max(0,Math.min(t,i)),a=Math.max(0,Math.min(a,i)),n=Math.max(0,Math.min(n,s)),l=Math.max(0,Math.min(l,s))),this._selections[r++]={r1:t,c1:n,r2:a,c2:l})}this._selections.length=r,this.emitChanged()}}class ue extends d.Widget{constructor(e){super({node:J.createNode()}),this._message="",this.addClass("lm-DataGrid-notification"),this.setFlag(d.Widget.Flag.DisallowLayout),this._target=e.target,this._message=e.message||"",this._placement=e.placement||"bottom",d.Widget.attach(this,document.body),e.timeout&&e.timeout>0&&setTimeout((()=>{this.close()}),e.timeout)}handleEvent(e){switch(e.type){case"mousedown":this._evtMouseDown(e);break;case"contextmenu":e.preventDefault(),e.stopPropagation()}}get placement(){return this._placement}set placement(e){this._placement!==e&&(this._placement=e,this.update())}get message(){return this._message}set message(e){this._message!==e&&(this._message=e,this.update())}get messageNode(){return this.node.getElementsByClassName("lm-DataGrid-notificationMessage")[0]}onBeforeAttach(e){this.node.addEventListener("mousedown",this),this.update()}onAfterDetach(e){this.node.removeEventListener("mousedown",this)}onUpdateRequest(e){const t=this._target.getBoundingClientRect(),i=this.node.style;switch(this._placement){case"bottom":i.left=t.left+"px",i.top=t.bottom+"px";break;case"top":i.left=t.left+"px",i.height=t.top+"px",i.top="0",i.alignItems="flex-end",i.justifyContent="flex-end";break;case"left":i.left="0",i.width=t.left+"px",i.top=t.top+"px",i.alignItems="flex-end",i.justifyContent="flex-end";break;case"right":i.left=t.right+"px",i.top=t.top+"px"}this.messageNode.innerHTML=this._message}_evtMouseDown(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this.close())}}!function(e){e.createNode=function(){const e=document.createElement("div"),t=document.createElement("div");t.className="lm-DataGrid-notificationContainer";const i=document.createElement("span");return i.className="lm-DataGrid-notificationMessage",t.appendChild(i),e.appendChild(t),e}}(J||(J={}));const _e="Invalid input!";class me{constructor(){this.minLength=Number.NaN,this.maxLength=Number.NaN,this.pattern=null}validate(e,t){return null===t?{valid:!0}:"string"!=typeof t?{valid:!1,message:"Input must be valid text"}:!isNaN(this.minLength)&&t.length<this.minLength?{valid:!1,message:`Text length must be greater than ${this.minLength}`}:!isNaN(this.maxLength)&&t.length>this.maxLength?{valid:!1,message:`Text length must be less than ${this.maxLength}`}:this.pattern&&!this.pattern.test(t)?{valid:!1,message:"Text doesn't match the required pattern"}:{valid:!0}}}class pe{constructor(){this.min=Number.NaN,this.max=Number.NaN}validate(e,t){return null===t?{valid:!0}:isNaN(t)||t%1!=0?{valid:!1,message:"Input must be valid integer"}:!isNaN(this.min)&&t<this.min?{valid:!1,message:`Input must be greater than ${this.min}`}:!isNaN(this.max)&&t>this.max?{valid:!1,message:`Input must be less than ${this.max}`}:{valid:!0}}}class ge{constructor(){this.min=Number.NaN,this.max=Number.NaN}validate(e,t){return null===t?{valid:!0}:isNaN(t)?{valid:!1,message:"Input must be valid number"}:!isNaN(this.min)&&t<this.min?{valid:!1,message:`Input must be greater than ${this.min}`}:!isNaN(this.max)&&t>this.max?{valid:!1,message:`Input must be less than ${this.max}`}:{valid:!0}}}class fe{constructor(){this.inputChanged=new b.Signal(this),this.validityNotification=null,this._disposed=!1,this._validInput=!0,this._gridWheelEventHandler=null,this.inputChanged.connect((()=>{this.validate()}))}get isDisposed(){return this._disposed}dispose(){this._disposed||(this._gridWheelEventHandler&&(this.cell.grid.node.removeEventListener("wheel",this._gridWheelEventHandler),this._gridWheelEventHandler=null),this._closeValidityNotification(),this._disposed=!0,this.cell.grid.node.removeChild(this.viewportOccluder))}edit(e,t){this.cell=e,this.onCommit=t&&t.onCommit,this.onCancel=t&&t.onCancel,this.validator=t&&t.validator?t.validator:this.createValidatorBasedOnType(),this._gridWheelEventHandler=()=>{this._closeValidityNotification(),this.updatePosition()},e.grid.node.addEventListener("wheel",this._gridWheelEventHandler),this._addContainer(),this.updatePosition(),this.startEditing()}cancel(){this._disposed||(this.dispose(),this.onCancel&&this.onCancel())}get validInput(){return this._validInput}validate(){let e;try{e=this.getInput()}catch(e){return console.log(`Input error: ${e.message}`),void this.setValidity(!1,e.message||_e)}if(this.validator){const t=this.validator.validate(this.cell,e);t.valid?this.setValidity(!0):this.setValidity(!1,t.message||_e)}else this.setValidity(!0)}setValidity(e,t=""){this._validInput=e,this._closeValidityNotification(),e?this.editorContainer.classList.remove("lm-mod-invalid"):(this.editorContainer.classList.add("lm-mod-invalid"),""!==t&&(this.validityNotification=new ue({target:this.editorContainer,message:t,placement:"bottom",timeout:5e3}),this.validityNotification.show()))}createValidatorBasedOnType(){const e=this.cell,t=e.grid.dataModel.metadata("body",e.row,e.column);switch(t&&t.type){case"string":{const e=new me;if("string"==typeof t.format)switch(t.format){case"email":e.pattern=new RegExp("^([a-z0-9_.-]+)@([da-z.-]+).([a-z.]{2,6})$");break;case"uuid":e.pattern=new RegExp("[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}")}return t.constraint&&(void 0!==t.constraint.minLength&&(e.minLength=t.constraint.minLength),void 0!==t.constraint.maxLength&&(e.maxLength=t.constraint.maxLength),"string"==typeof t.constraint.pattern&&(e.pattern=new RegExp(t.constraint.pattern))),e}case"number":{const e=new ge;return t.constraint&&(void 0!==t.constraint.minimum&&(e.min=t.constraint.minimum),void 0!==t.constraint.maximum&&(e.max=t.constraint.maximum)),e}case"integer":{const e=new pe;return t.constraint&&(void 0!==t.constraint.minimum&&(e.min=t.constraint.minimum),void 0!==t.constraint.maximum&&(e.max=t.constraint.maximum)),e}}}getCellInfo(e){const{grid:t,row:i,column:s}=e;let o,r,n,a,l;const h=U.getGroup(t.dataModel,"body",i,s);if(h){r=t.headerWidth-t.scrollX+t.columnOffset("body",h.c1),n=t.headerHeight-t.scrollY+t.rowOffset("body",h.r1),a=0,l=0;for(let e=h.r1;e<=h.r2;e++)l+=t.rowSize("body",e);for(let e=h.c1;e<=h.c2;e++)a+=t.columnSize("body",e);o=t.dataModel.data("body",h.r1,h.c1)}else r=t.headerWidth-t.scrollX+t.columnOffset("body",s),n=t.headerHeight-t.scrollY+t.rowOffset("body",i),a=t.columnSize("body",s),l=t.rowSize("body",i),o=t.dataModel.data("body",i,s);return{grid:t,row:i,column:s,data:o,x:r,y:n,width:a,height:l}}updatePosition(){const e=this.cell.grid,t=this.getCellInfo(this.cell),i=e.headerHeight,s=e.headerWidth;this.viewportOccluder.style.top=i+"px",this.viewportOccluder.style.left=s+"px",this.viewportOccluder.style.width=e.viewportWidth-s+"px",this.viewportOccluder.style.height=e.viewportHeight-i+"px",this.viewportOccluder.style.position="absolute",this.editorContainer.style.left=t.x-1-s+"px",this.editorContainer.style.top=t.y-1-i+"px",this.editorContainer.style.width=t.width+1+"px",this.editorContainer.style.height=t.height+1+"px",this.editorContainer.style.visibility="visible",this.editorContainer.style.position="absolute"}commit(e="none"){if(this.validate(),!this._validInput)return!1;let t;try{t=this.getInput()}catch(e){return console.log(`Input error: ${e.message}`),!1}return this.dispose(),this.onCommit&&this.onCommit({cell:this.cell,value:t,cursorMovement:e}),!0}_addContainer(){this.viewportOccluder=document.createElement("div"),this.viewportOccluder.className="lm-DataGrid-cellEditorOccluder",this.cell.grid.node.appendChild(this.viewportOccluder),this.editorContainer=document.createElement("div"),this.editorContainer.className="lm-DataGrid-cellEditorContainer",this.viewportOccluder.appendChild(this.editorContainer),this.editorContainer.addEventListener("mouseleave",(e=>{this.viewportOccluder.style.pointerEvents=this._validInput?"none":"auto"})),this.editorContainer.addEventListener("mouseenter",(e=>{this.viewportOccluder.style.pointerEvents="none"}))}_closeValidityNotification(){this.validityNotification&&(this.validityNotification.close(),this.validityNotification=null)}}class ve extends fe{handleEvent(e){switch(e.type){case"keydown":this._onKeyDown(e);break;case"blur":this._onBlur(e);break;case"input":this._onInput(e)}}dispose(){this.isDisposed||(this._unbindEvents(),super.dispose())}startEditing(){this.createWidget();const e=this.cell,t=this.getCellInfo(e);this.input.value=this.deserialize(t.data),this.editorContainer.appendChild(this.input),this.input.focus(),this.input.select(),this.bindEvents()}deserialize(e){return null==e?"":e.toString()}createWidget(){const e=document.createElement("input");e.classList.add("lm-DataGrid-cellEditorWidget"),e.classList.add("lm-DataGrid-cellEditorInput"),e.spellcheck=!1,e.type=this.inputType,this.input=e}bindEvents(){this.input.addEventListener("keydown",this),this.input.addEventListener("blur",this),this.input.addEventListener("input",this)}_unbindEvents(){this.input.removeEventListener("keydown",this),this.input.removeEventListener("blur",this),this.input.removeEventListener("input",this)}_onKeyDown(e){switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(e)){case"Enter":this.commit(e.shiftKey?"up":"down");break;case"Tab":this.commit(e.shiftKey?"left":"right"),e.stopPropagation(),e.preventDefault();break;case"Escape":this.cancel()}}_onBlur(e){this.isDisposed||this.commit()||(e.preventDefault(),e.stopPropagation(),this.input.focus())}_onInput(e){this.inputChanged.emit(void 0)}}class we extends ve{constructor(){super(...arguments),this.inputType="text"}getInput(){return this.input.value}}class be extends ve{constructor(){super(...arguments),this.inputType="number"}startEditing(){super.startEditing(),this.input.step="any";const e=this.cell,t=e.grid.dataModel.metadata("body",e.row,e.column).constraint;t&&(t.minimum&&(this.input.min=t.minimum),t.maximum&&(this.input.max=t.maximum))}getInput(){let e=this.input.value;if(""===e.trim())return null;const t=parseFloat(e);if(isNaN(t))throw new Error("Invalid input");return t}}class ye extends ve{constructor(){super(...arguments),this.inputType="number"}startEditing(){super.startEditing(),this.input.step="1";const e=this.cell,t=e.grid.dataModel.metadata("body",e.row,e.column).constraint;t&&(t.minimum&&(this.input.min=t.minimum),t.maximum&&(this.input.max=t.maximum))}getInput(){let e=this.input.value;if(""===e.trim())return null;let t=parseInt(e);if(isNaN(t))throw new Error("Invalid input");return t}}class Se extends fe{handleEvent(e){switch(e.type){case"keydown":this._onKeyDown(e);break;case"blur":this._onBlur(e)}}dispose(){this.isDisposed||(this._unbindEvents(),super.dispose())}startEditing(){this._createWidget();const e=this.cell,t=this.getCellInfo(e);this._input.value=this._deserialize(t.data),this.editorContainer.appendChild(this._input),this._input.focus(),this._bindEvents()}getInput(){return this._input.value}_deserialize(e){return null==e?"":e.toString()}_createWidget(){const e=document.createElement("input");e.type="date",e.pattern="d{4}-d{2}-d{2}",e.classList.add("lm-DataGrid-cellEditorWidget"),e.classList.add("lm-DataGrid-cellEditorInput"),this._input=e}_bindEvents(){this._input.addEventListener("keydown",this),this._input.addEventListener("blur",this)}_unbindEvents(){this._input.removeEventListener("keydown",this),this._input.removeEventListener("blur",this)}_onKeyDown(e){switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(e)){case"Enter":this.commit(e.shiftKey?"up":"down");break;case"Tab":this.commit(e.shiftKey?"left":"right"),e.stopPropagation(),e.preventDefault();break;case"Escape":this.cancel()}}_onBlur(e){this.isDisposed||this.commit()||(e.preventDefault(),e.stopPropagation(),this._input.focus())}}class Ce extends fe{handleEvent(e){switch(e.type){case"keydown":this._onKeyDown(e);break;case"mousedown":this._input.focus(),e.stopPropagation(),e.preventDefault();break;case"blur":this._onBlur(e)}}dispose(){this.isDisposed||(this._unbindEvents(),super.dispose())}startEditing(){this._createWidget();const e=this.cell,t=this.getCellInfo(e);this._input.checked=this._deserialize(t.data),this.editorContainer.appendChild(this._input),this._input.focus(),this._bindEvents()}getInput(){return this._input.checked}_deserialize(e){return null!=e&&1==e}_createWidget(){const e=document.createElement("input");e.classList.add("lm-DataGrid-cellEditorWidget"),e.classList.add("lm-DataGrid-cellEditorCheckbox"),e.type="checkbox",e.spellcheck=!1,this._input=e}_bindEvents(){this._input.addEventListener("keydown",this),this._input.addEventListener("mousedown",this),this._input.addEventListener("blur",this)}_unbindEvents(){this._input.removeEventListener("keydown",this),this._input.removeEventListener("mousedown",this),this._input.removeEventListener("blur",this)}_onKeyDown(e){switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(e)){case"Enter":this.commit(e.shiftKey?"up":"down");break;case"Tab":this.commit(e.shiftKey?"left":"right"),e.stopPropagation(),e.preventDefault();break;case"Escape":this.cancel()}}_onBlur(e){this.isDisposed||this.commit()||(e.preventDefault(),e.stopPropagation(),this._input.focus())}}class xe extends fe{constructor(){super(...arguments),this._isMultiSelect=!1}dispose(){this.isDisposed||(super.dispose(),this._isMultiSelect&&document.body.removeChild(this._select))}startEditing(){const e=this.cell,t=this.getCellInfo(e),i=e.grid.dataModel.metadata("body",e.row,e.column);if(this._isMultiSelect="array"===i.type,this._createWidget(),this._isMultiSelect){this._select.multiple=!0;const e=this._deserialize(t.data);for(let t=0;t<this._select.options.length;++t){const i=this._select.options.item(t);i.selected=-1!==e.indexOf(i.value)}document.body.appendChild(this._select)}else this._select.value=this._deserialize(t.data),this.editorContainer.appendChild(this._select);this._select.focus(),this._bindEvents(),this.updatePosition()}getInput(){if(this._isMultiSelect){const e=[];for(let t=0;t<this._select.selectedOptions.length;++t)e.push(this._select.selectedOptions.item(t).value);return e}return this._select.value}updatePosition(){if(super.updatePosition(),!this._isMultiSelect)return;const e=this.getCellInfo(this.cell);this._select.style.position="absolute";const t=this.editorContainer.getBoundingClientRect();this._select.style.left=t.left+"px",this._select.style.top=t.top+e.height+"px",this._select.style.width=t.width+"px",this._select.style.maxHeight="60px",this.editorContainer.style.visibility="hidden"}_deserialize(e){if(null==e)return"";if(this._isMultiSelect){const t=[];if(Array.isArray(e))for(let i of e)t.push(i.toString());return t}return e.toString()}_createWidget(){const e=this.cell,t=e.grid.dataModel.metadata("body",e.row,e.column).constraint.enum,i=document.createElement("select");i.classList.add("lm-DataGrid-cellEditorWidget");for(let e of t){const t=document.createElement("option");t.value=e,t.text=e,i.appendChild(t)}this._select=i}_bindEvents(){this._select.addEventListener("keydown",this._onKeyDown.bind(this)),this._select.addEventListener("blur",this._onBlur.bind(this))}_onKeyDown(e){switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(e)){case"Enter":this.commit(e.shiftKey?"up":"down");break;case"Tab":this.commit(e.shiftKey?"left":"right"),e.stopPropagation(),e.preventDefault();break;case"Escape":this.cancel()}}_onBlur(e){this.isDisposed||this.commit()||(e.preventDefault(),e.stopPropagation(),this._select.focus())}}class Me extends fe{handleEvent(e){switch(e.type){case"keydown":this._onKeyDown(e);break;case"blur":this._onBlur(e)}}dispose(){this.isDisposed||(this._unbindEvents(),super.dispose())}startEditing(){this._createWidget();const e=this.cell,t=this.getCellInfo(e);this._input.value=this._deserialize(t.data),this.editorContainer.appendChild(this._input),this._input.focus(),this._input.select(),this._bindEvents()}getInput(){return this._input.value}_deserialize(e){return null==e?"":e.toString()}_createWidget(){const e=this.cell,t=e.grid.dataModel,i=t.rowCount("body"),s="cell-editor-list",o=document.createElement("datalist");o.id=s;const r=document.createElement("input");r.classList.add("lm-DataGrid-cellEditorWidget"),r.classList.add("lm-DataGrid-cellEditorInput");const n=new Set;for(let s=0;s<i;++s){const i=t.data("body",s,e.column);i&&n.add(i)}n.forEach((e=>{const t=document.createElement("option");t.value=e,t.text=e,o.appendChild(t)})),this.editorContainer.appendChild(o),r.setAttribute("list",s),this._input=r}_bindEvents(){this._input.addEventListener("keydown",this),this._input.addEventListener("blur",this)}_unbindEvents(){this._input.removeEventListener("keydown",this),this._input.removeEventListener("blur",this)}_onKeyDown(e){switch((0,ee.getKeyboardLayout)().keyForKeydownEvent(e)){case"Enter":this.commit(e.shiftKey?"up":"down");break;case"Tab":this.commit(e.shiftKey?"left":"right"),e.stopPropagation(),e.preventDefault();break;case"Escape":this.cancel()}}_onBlur(e){this.isDisposed||this.commit()||(e.preventDefault(),e.stopPropagation(),this._input.focus())}}function ke(e,t){return"function"==typeof e?e(t):e}class Ee{constructor(){this._editor=null,this._cell=null,this._typeBasedOverrides=new Map,this._metadataBasedOverrides=new Map}setEditor(e,t){if("string"==typeof e)this._typeBasedOverrides.set(e,t);else{const i=this._metadataIdentifierToKey(e);this._metadataBasedOverrides.set(i,[e,t])}}edit(e,t){if(!e.grid.editable)return console.error("Grid cannot be edited!"),!1;if(this.cancel(),this._cell=e,(t=t||{}).onCommit=t.onCommit||this._onCommit.bind(this),t.onCancel=t.onCancel||this._onCancel.bind(this),t.editor)return this._editor=t.editor,t.editor.edit(e,t),!0;const i=this._getEditor(e);return!!i&&(this._editor=i,i.edit(e,t),!0)}cancel(){this._editor&&(this._editor.cancel(),this._editor=null),this._cell=null}_onCommit(e){const t=this._cell;if(!t)return;const i=t.grid,s=i.dataModel;let o=t.row,r=t.column;const n=U.getGroup(i.dataModel,"body",o,r);n&&(o=n.r1,r=n.c1),s.setData("body",o,r,e.value),i.viewport.node.focus(),"none"!==e.cursorMovement&&(i.moveCursor(e.cursorMovement),i.scrollToCursor())}_onCancel(){this._cell&&this._cell.grid.viewport.node.focus()}_getDataTypeKey(e){const t=e.grid.dataModel?e.grid.dataModel.metadata("body",e.row,e.column):null;if(!t)return"default";let i="";return t&&(i=t.type),t.constraint&&t.constraint.enum&&("dynamic"===t.constraint.enum?i+=":dynamic-option":i+=":option"),i}_objectToKey(e){let t="";for(let i in e){const s=e[i];t+="object"==typeof s?`${i}:${this._objectToKey(s)}`:`[${i}:${s}]`}return t}_metadataIdentifierToKey(e){return this._objectToKey(e)}_metadataMatchesIdentifier(e,t){for(let i in t){if(!e.hasOwnProperty(i))return!1;const s=t[i],o=e[i];if("object"==typeof s){if(!this._metadataMatchesIdentifier(o,s))return!1}else if(o!==s)return!1}return!0}_getMetadataBasedEditor(e){let t;const i=e.grid.dataModel.metadata("body",e.row,e.column);return i&&this._metadataBasedOverrides.forEach((s=>{if(!t){let[o,r]=s;this._metadataMatchesIdentifier(i,o)&&(t=ke(r,e))}})),t}_getEditor(e){const t=this._getDataTypeKey(e);if(this._typeBasedOverrides.has(t))return ke(this._typeBasedOverrides.get(t),e);if(this._metadataBasedOverrides.size>0){const t=this._getMetadataBasedEditor(e);if(t)return t}switch(t){case"string":return new we;case"number":return new be;case"integer":return new ye;case"boolean":return new Ce;case"date":return new Se;case"string:option":case"number:option":case"integer:option":case"date:option":case"array:option":return new xe;case"string:dynamic-option":case"number:dynamic-option":case"integer:dynamic-option":case"date:dynamic-option":return new Me}if(this._typeBasedOverrides.has("default"))return ke(this._typeBasedOverrides.get("default"),e);const i=e.grid.dataModel.data("body",e.row,e.column);return i&&"object"==typeof i?void 0:new we}}class He{constructor(){this._changed=new b.Signal(this)}get changed(){return this._changed}groupCount(e){return 0}metadata(e,t,i){return He.emptyMetadata}group(e,t){return null}emitChanged(e){this._changed.emit(e)}}class Re extends He{}!function(e){e.emptyMetadata=Object.freeze({})}(He||(He={}));class Oe{constructor(e){this._disposed=!1,this._context=e,this._state=De.State.create(e)}dispose(){if(!this._disposed)for(this._disposed=!0;this._state.next;)this._state=this._state.next,this._context.restore()}get isDisposed(){return this._disposed}get fillStyle(){return this._context.fillStyle}set fillStyle(e){this._state.fillStyle!==e&&(this._state.fillStyle=e,this._context.fillStyle=e)}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(e){this._state.strokeStyle!==e&&(this._state.strokeStyle=e,this._context.strokeStyle=e)}get font(){return this._context.font}set font(e){this._state.font!==e&&(this._state.font=e,this._context.font=e)}get textAlign(){return this._context.textAlign}set textAlign(e){this._state.textAlign!==e&&(this._state.textAlign=e,this._context.textAlign=e)}get textBaseline(){return this._context.textBaseline}set textBaseline(e){this._state.textBaseline!==e&&(this._state.textBaseline=e,this._context.textBaseline=e)}get lineCap(){return this._context.lineCap}set lineCap(e){this._state.lineCap!==e&&(this._state.lineCap=e,this._context.lineCap=e)}get lineDashOffset(){return this._context.lineDashOffset}set lineDashOffset(e){this._state.lineDashOffset!==e&&(this._state.lineDashOffset=e,this._context.lineDashOffset=e)}get lineJoin(){return this._context.lineJoin}set lineJoin(e){this._state.lineJoin!==e&&(this._state.lineJoin=e,this._context.lineJoin=e)}get lineWidth(){return this._context.lineWidth}set lineWidth(e){this._state.lineWidth!==e&&(this._state.lineWidth=e,this._context.lineWidth=e)}get miterLimit(){return this._context.miterLimit}set miterLimit(e){this._state.miterLimit!==e&&(this._state.miterLimit=e,this._context.miterLimit=e)}get shadowBlur(){return this._context.shadowBlur}set shadowBlur(e){this._state.shadowBlur!==e&&(this._state.shadowBlur=e,this._context.shadowBlur=e)}get shadowColor(){return this._context.shadowColor}set shadowColor(e){this._state.shadowColor!==e&&(this._state.shadowColor=e,this._context.shadowColor=e)}get shadowOffsetX(){return this._context.shadowOffsetX}set shadowOffsetX(e){this._state.shadowOffsetX!==e&&(this._state.shadowOffsetX=e,this._context.shadowOffsetX=e)}get shadowOffsetY(){return this._context.shadowOffsetY}set shadowOffsetY(e){this._state.shadowOffsetY!==e&&(this._state.shadowOffsetY=e,this._context.shadowOffsetY=e)}get imageSmoothingEnabled(){return this._context.imageSmoothingEnabled}set imageSmoothingEnabled(e){this._state.imageSmoothingEnabled!==e&&(this._state.imageSmoothingEnabled=e,this._context.imageSmoothingEnabled=e)}get globalAlpha(){return this._context.globalAlpha}set globalAlpha(e){this._state.globalAlpha!==e&&(this._state.globalAlpha=e,this._context.globalAlpha=e)}get globalCompositeOperation(){return this._context.globalCompositeOperation}set globalCompositeOperation(e){this._state.globalCompositeOperation!==e&&(this._state.globalCompositeOperation=e,this._context.globalCompositeOperation=e)}getLineDash(){return this._context.getLineDash()}setLineDash(e){this._context.setLineDash(e)}rotate(e){this._context.rotate(e)}scale(e,t){this._context.scale(e,t)}transform(e,t,i,s,o,r){this._context.transform(e,t,i,s,o,r)}translate(e,t){this._context.translate(e,t)}setTransform(e,t,i,s,o,r){this._context.setTransform(e,t,i,s,o,r)}save(){this._state=De.State.push(this._state),this._context.save()}restore(){this._state.next&&(this._state=De.State.pop(this._state),this._context.restore())}beginPath(){return this._context.beginPath()}closePath(){this._context.closePath()}isPointInPath(e,t,i){let s;return s=2===arguments.length?this._context.isPointInPath(e,t):this._context.isPointInPath(e,t,i),s}arc(e,t,i,s,o,r){5===arguments.length?this._context.arc(e,t,i,s,o):this._context.arc(e,t,i,s,o,r)}arcTo(e,t,i,s,o){this._context.arcTo(e,t,i,s,o)}bezierCurveTo(e,t,i,s,o,r){this._context.bezierCurveTo(e,t,i,s,o,r)}ellipse(e,t,i,s,o,r,n,a){7===arguments.length?this._context.ellipse(e,t,i,s,o,r,n):this._context.ellipse(e,t,i,s,o,r,n,a)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._context.quadraticCurveTo(e,t,i,s)}rect(e,t,i,s){this._context.rect(e,t,i,s)}clip(e){0===arguments.length?this._context.clip():this._context.clip(e)}fill(e){0===arguments.length?this._context.fill():this._context.fill(e)}stroke(){this._context.stroke()}clearRect(e,t,i,s){return this._context.clearRect(e,t,i,s)}fillRect(e,t,i,s){this._context.fillRect(e,t,i,s)}fillText(e,t,i,s){3===arguments.length?this._context.fillText(e,t,i):this._context.fillText(e,t,i,s)}strokeRect(e,t,i,s){this._context.strokeRect(e,t,i,s)}strokeText(e,t,i,s){3===arguments.length?this._context.strokeText(e,t,i):this._context.strokeText(e,t,i,s)}measureText(e){return this._context.measureText(e)}createLinearGradient(e,t,i,s){return this._context.createLinearGradient(e,t,i,s)}createRadialGradient(e,t,i,s,o,r){return this._context.createRadialGradient(e,t,i,s,o,r)}createPattern(e,t){return this._context.createPattern(e,t)}createImageData(){return this._context.createImageData.apply(this._context,arguments)}getImageData(e,t,i,s){return this._context.getImageData(e,t,i,s)}putImageData(){this._context.putImageData.apply(this._context,arguments)}drawImage(){this._context.drawImage.apply(this._context,arguments)}drawFocusIfNeeded(e){this._context.drawFocusIfNeeded(e)}}var De,ze,Te,Le,Be;!function(e){let t=-1;const i=[];class s{static create(e){let o=t<0?new s:i[t--];return o.next=null,o.fillStyle=e.fillStyle,o.font=e.font,o.globalAlpha=e.globalAlpha,o.globalCompositeOperation=e.globalCompositeOperation,o.imageSmoothingEnabled=e.imageSmoothingEnabled,o.lineCap=e.lineCap,o.lineDashOffset=e.lineDashOffset,o.lineJoin=e.lineJoin,o.lineWidth=e.lineWidth,o.miterLimit=e.miterLimit,o.shadowBlur=e.shadowBlur,o.shadowColor=e.shadowColor,o.shadowOffsetX=e.shadowOffsetX,o.shadowOffsetY=e.shadowOffsetY,o.strokeStyle=e.strokeStyle,o.textAlign=e.textAlign,o.textBaseline=e.textBaseline,o}static push(e){let o=t<0?new s:i[t--];return o.next=e,o.fillStyle=e.fillStyle,o.font=e.font,o.globalAlpha=e.globalAlpha,o.globalCompositeOperation=e.globalCompositeOperation,o.imageSmoothingEnabled=e.imageSmoothingEnabled,o.lineCap=e.lineCap,o.lineDashOffset=e.lineDashOffset,o.lineJoin=e.lineJoin,o.lineWidth=e.lineWidth,o.miterLimit=e.miterLimit,o.shadowBlur=e.shadowBlur,o.shadowColor=e.shadowColor,o.shadowOffsetX=e.shadowOffsetX,o.shadowOffsetY=e.shadowOffsetY,o.strokeStyle=e.strokeStyle,o.textAlign=e.textAlign,o.textBaseline=e.textBaseline,o}static pop(e){return e.fillStyle="",e.strokeStyle="",i[++t]=e,e.next}}e.State=s}(De||(De={}));class Ie{constructor(e={},t){this._changed=new b.Signal(this),this._values={...e},this._fallback=t||new ae}get changed(){return this._changed}get(e){let t=this._values[e.region];if("function"==typeof t)try{t=t(e)}catch(e){t=void 0,console.error(e)}return t||this._fallback}update(e={},t){this._values={...this._values,...e},this._fallback=t||this._fallback,this._changed.emit(void 0)}}class We{constructor(e){this._count=0,this._length=0,this._sections=[],this._minimumSize=e.minimumSize||2,this._defaultSize=Math.max(this._minimumSize,Math.floor(e.defaultSize))}get length(){return this._length}get count(){return this._count}get minimumSize(){return this._minimumSize}set minimumSize(e){e=Math.max(2,Math.floor(e)),this._minimumSize!==e&&(this._minimumSize=e,e>this._defaultSize&&(this.defaultSize=e))}get defaultSize(){return this._defaultSize}set defaultSize(e){if(e=Math.max(this._minimumSize,Math.floor(e)),this._defaultSize===e)return;let t=e-this._defaultSize;if(this._defaultSize=e,this._length+=t*(this._count-this._sections.length),0!==this._sections.length)for(let t=0,i=this._sections.length;t<i;++t){let i=this._sections[t-1],s=this._sections[t];if(i){let t=s.index-i.index-1;s.offset=i.offset+i.size+t*e}else s.offset=s.index*e}}clampSize(e){return Math.max(this._minimumSize,Math.floor(e))}indexOf(e){if(e<0||e>=this._length||0===this._count)return-1;if(0===this._sections.length)return Math.floor(e/this._defaultSize);let t=ie.ArrayExt.lowerBound(this._sections,e,ze.offsetCmp);if(t<this._sections.length&&this._sections[t].offset<=e)return this._sections[t].index;if(0===t)return Math.floor(e/this._defaultSize);let i=this._sections[t-1],s=e-(i.offset+i.size);return i.index+Math.floor(s/this._defaultSize)+1}offsetOf(e){if(e<0||e>=this._count)return-1;if(0===this._sections.length)return e*this._defaultSize;let t=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp);if(t<this._sections.length&&this._sections[t].index===e)return this._sections[t].offset;if(0===t)return e*this._defaultSize;let i=this._sections[t-1],s=e-i.index-1;return i.offset+i.size+s*this._defaultSize}extentOf(e){if(e<0||e>=this._count)return-1;if(0===this._sections.length)return(e+1)*this._defaultSize-1;let t=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp);if(t<this._sections.length&&this._sections[t].index===e)return this._sections[t].offset+this._sections[t].size-1;if(0===t)return(e+1)*this._defaultSize-1;let i=this._sections[t-1],s=e-i.index;return i.offset+i.size+s*this._defaultSize-1}sizeOf(e){if(e<0||e>=this._count)return-1;if(0===this._sections.length)return this._defaultSize;let t=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp);return t<this._sections.length&&this._sections[t].index===e?this._sections[t].size:this._defaultSize}resize(e,t){if(e<0||e>=this._count)return;t=Math.max(this._minimumSize,Math.floor(t));let i,s=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp);if(s<this._sections.length&&this._sections[s].index===e){let e=this._sections[s];i=t-e.size,e.size=t}else if(0===s){let o=e*this._defaultSize;ie.ArrayExt.insert(this._sections,s,{index:e,offset:o,size:t}),i=t-this._defaultSize}else{let o=this._sections[s-1],r=e-o.index-1,n=o.offset+o.size+r*this._defaultSize;ie.ArrayExt.insert(this._sections,s,{index:e,offset:n,size:t}),i=t-this._defaultSize}this._length+=i;for(let e=s+1,t=this._sections.length;e<t;++e)this._sections[e].offset+=i}insert(e,t){if(t<=0)return;e=Math.max(0,Math.min(e,this._count));let i=t*this._defaultSize;if(this._count+=t,this._length+=i,0===this._sections.length)return;let s=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp);for(let e=this._sections.length;s<e;++s){let e=this._sections[s];e.index+=t,e.offset+=i}}remove(e,t){if(e<0||e>=this._count||t<=0)return;if(t=Math.min(this._count-e,t),0===this._sections.length)return this._count-=t,void(this._length-=t*this._defaultSize);if(t===this._count)return this._length=0,this._count=0,void(this._sections.length=0);let i=ie.ArrayExt.lowerBound(this._sections,e,ze.indexCmp),s=ie.ArrayExt.lowerBound(this._sections,e+t,ze.indexCmp),o=this._sections.splice(i,s-i),r=(t-o.length)*this._defaultSize;for(let e=0,t=o.length;e<t;++e)r+=o[e].size;this._count-=t,this._length-=r;for(let e=i,s=this._sections.length;e<s;++e){let i=this._sections[e];i.index-=t,i.offset-=r}}move(e,t,i){if(e<0||e>=this._count||t<=0)return;if(0===this._sections.length)return;if(t=Math.min(t,this._count-e),e===(i=Math.min(Math.max(0,i),this._count-t)))return;let s=Math.min(e,i),o=ie.ArrayExt.lowerBound(this._sections,s,ze.indexCmp);if(o===this._sections.length)return;let r=Math.max(e+t-1,i+t-1),n=ie.ArrayExt.upperBound(this._sections,r,ze.indexCmp)-1;if(n<o)return;let a=i<e?e:e+t,l=a-s,h=r-a+1,c=l*this._defaultSize,d=h*this._defaultSize;for(let e=o;e<=n;++e){let t=this._sections[e];t.index<a?c+=t.size-this._defaultSize:d+=t.size-this._defaultSize}let u=ie.ArrayExt.lowerBound(this._sections,a,ze.indexCmp);o<=u&&u<=n&&ie.ArrayExt.rotate(this._sections,u-o,o,n);for(let e=o;e<=n;++e){let t=this._sections[e];t.index<a?(t.index+=h,t.offset+=d):(t.index-=l,t.offset-=c)}}reset(){this._sections.length=0,this._length=this._count*this._defaultSize}clear(){this._count=0,this._length=0,this._sections.length=0}}!function(e){e.offsetCmp=function(e,t){return t<e.offset?1:e.offset+e.size<=t?-1:0},e.indexCmp=function(e,t){return e.index-t}}(ze||(ze={}));class Ve extends d.Widget{constructor(e={}){super(),this._scrollX=0,this._scrollY=0,this._viewportWidth=0,this._viewportHeight=0,this._mousedown=!1,this._keyHandler=null,this._mouseHandler=null,this._vScrollBarMinWidth=0,this._hScrollBarMinHeight=0,this._dpiRatio=Math.ceil(window.devicePixelRatio),this._dataModel=null,this._selectionModel=null,this._editingEnabled=!1,this.addClass("lm-DataGrid"),this._style=e.style||Ve.defaultStyle,this._stretchLastRow=e.stretchLastRow||!1,this._stretchLastColumn=e.stretchLastColumn||!1,this._headerVisibility=e.headerVisibility||"all",this._cellRenderers=e.cellRenderers||new Ie,this._copyConfig=e.copyConfig||Ve.defaultCopyConfig,this._cellRenderers.changed.connect(this._onRenderersChanged,this);let t=e.defaultSizes||Ve.defaultSizes,i=e.minimumSizes||Ve.minimumSizes;this._rowSections=new We({defaultSize:t.rowHeight,minimumSize:i.rowHeight}),this._columnSections=new We({defaultSize:t.columnWidth,minimumSize:i.columnWidth}),this._rowHeaderSections=new We({defaultSize:t.rowHeaderWidth,minimumSize:i.rowHeaderWidth}),this._columnHeaderSections=new We({defaultSize:t.columnHeaderHeight,minimumSize:i.columnHeaderHeight}),this._canvas=Te.createCanvas(),this._buffer=Te.createCanvas(),this._overlay=Te.createCanvas(),this._canvasGC=this._canvas.getContext("2d"),this._bufferGC=this._buffer.getContext("2d"),this._overlayGC=this._overlay.getContext("2d"),this._canvas.style.position="absolute",this._canvas.style.top="0px",this._canvas.style.left="0px",this._canvas.style.width="0px",this._canvas.style.height="0px",this._overlay.style.position="absolute",this._overlay.style.top="0px",this._overlay.style.left="0px",this._overlay.style.width="0px",this._overlay.style.height="0px",this._viewport=new d.Widget,this._viewport.node.tabIndex=-1,this._viewport.node.style.outline="none",this._vScrollBar=new d.ScrollBar({orientation:"vertical"}),this._hScrollBar=new d.ScrollBar({orientation:"horizontal"}),this._scrollCorner=new d.Widget,this._editorController=new Ee,this._viewport.addClass("lm-DataGrid-viewport"),this._vScrollBar.addClass("lm-DataGrid-scrollBar"),this._hScrollBar.addClass("lm-DataGrid-scrollBar"),this._scrollCorner.addClass("lm-DataGrid-scrollCorner"),this._viewport.node.appendChild(this._canvas),this._viewport.node.appendChild(this._overlay),se.MessageLoop.installMessageHook(this._viewport,this),se.MessageLoop.installMessageHook(this._hScrollBar,this),se.MessageLoop.installMessageHook(this._vScrollBar,this),this._vScrollBar.hide(),this._hScrollBar.hide(),this._scrollCorner.hide(),this._vScrollBar.thumbMoved.connect(this._onThumbMoved,this),this._hScrollBar.thumbMoved.connect(this._onThumbMoved,this),this._vScrollBar.pageRequested.connect(this._onPageRequested,this),this._hScrollBar.pageRequested.connect(this._onPageRequested,this),this._vScrollBar.stepRequested.connect(this._onStepRequested,this),this._hScrollBar.stepRequested.connect(this._onStepRequested,this),d.GridLayout.setCellConfig(this._viewport,{row:0,column:0}),d.GridLayout.setCellConfig(this._vScrollBar,{row:0,column:1}),d.GridLayout.setCellConfig(this._hScrollBar,{row:1,column:0}),d.GridLayout.setCellConfig(this._scrollCorner,{row:1,column:1});let s=new d.GridLayout({rowCount:2,columnCount:2,rowSpacing:0,columnSpacing:0,fitPolicy:"set-no-constraint"});s.setRowStretch(0,1),s.setRowStretch(1,0),s.setColumnStretch(0,1),s.setColumnStretch(1,0),s.addWidget(this._viewport),s.addWidget(this._vScrollBar),s.addWidget(this._hScrollBar),s.addWidget(this._scrollCorner),this.layout=s}dispose(){this._releaseMouse(),this._keyHandler&&this._keyHandler.dispose(),this._mouseHandler&&this._mouseHandler.dispose(),this._keyHandler=null,this._mouseHandler=null,this._dataModel=null,this._selectionModel=null,this._rowSections.clear(),this._columnSections.clear(),this._rowHeaderSections.clear(),this._columnHeaderSections.clear(),super.dispose()}get dataModel(){return this._dataModel}set dataModel(e){this._dataModel!==e&&(this._releaseMouse(),this.selectionModel=null,this._dataModel&&this._dataModel.changed.disconnect(this._onDataModelChanged,this),e&&e.changed.connect(this._onDataModelChanged,this),this._dataModel=e,this._rowSections.clear(),this._columnSections.clear(),this._rowHeaderSections.clear(),this._columnHeaderSections.clear(),e&&(this._rowSections.insert(0,e.rowCount("body")),this._columnSections.insert(0,e.columnCount("body")),this._rowHeaderSections.insert(0,e.columnCount("row-header")),this._columnHeaderSections.insert(0,e.rowCount("column-header"))),this._scrollX=0,this._scrollY=0,this._syncViewport())}get selectionModel(){return this._selectionModel}set selectionModel(e){if(this._selectionModel!==e){if(this._releaseMouse(),e&&e.dataModel!==this._dataModel)throw new Error("SelectionModel.dataModel !== DataGrid.dataModel");this._selectionModel&&this._selectionModel.changed.disconnect(this._onSelectionsChanged,this),e&&e.changed.connect(this._onSelectionsChanged,this),this._selectionModel=e,this.repaintOverlay()}}get keyHandler(){return this._keyHandler}set keyHandler(e){this._keyHandler=e}get mouseHandler(){return this._mouseHandler}set mouseHandler(e){this._mouseHandler!==e&&(this._releaseMouse(),this._mouseHandler=e)}get style(){return this._style}set style(e){this._style!==e&&(this._style={...e},this.repaintContent(),this.repaintOverlay())}get cellRenderers(){return this._cellRenderers}set cellRenderers(e){this._cellRenderers!==e&&(this._cellRenderers.changed.disconnect(this._onRenderersChanged,this),e.changed.connect(this._onRenderersChanged,this),this._cellRenderers=e,this.repaintContent())}get headerVisibility(){return this._headerVisibility}set headerVisibility(e){this._headerVisibility!==e&&(this._headerVisibility=e,this._syncViewport())}get defaultSizes(){return{rowHeight:this._rowSections.defaultSize,columnWidth:this._columnSections.defaultSize,rowHeaderWidth:this._rowHeaderSections.defaultSize,columnHeaderHeight:this._columnHeaderSections.defaultSize}}set defaultSizes(e){this._rowSections.defaultSize=e.rowHeight,this._columnSections.defaultSize=e.columnWidth,this._rowHeaderSections.defaultSize=e.rowHeaderWidth,this._columnHeaderSections.defaultSize=e.columnHeaderHeight,this._syncViewport()}get minimumSizes(){return{rowHeight:this._rowSections.minimumSize,columnWidth:this._columnSections.minimumSize,rowHeaderWidth:this._rowHeaderSections.minimumSize,columnHeaderHeight:this._columnHeaderSections.minimumSize}}set minimumSizes(e){this._rowSections.minimumSize=e.rowHeight,this._columnSections.minimumSize=e.columnWidth,this._rowHeaderSections.minimumSize=e.rowHeaderWidth,this._columnHeaderSections.minimumSize=e.columnHeaderHeight,this._syncViewport()}get copyConfig(){return this._copyConfig}set copyConfig(e){this._copyConfig=e}get stretchLastRow(){return this._stretchLastRow}set stretchLastRow(e){e!==this._stretchLastRow&&(this._stretchLastRow=e,this._syncViewport())}get stretchLastColumn(){return this._stretchLastColumn}set stretchLastColumn(e){e!==this._stretchLastColumn&&(this._stretchLastColumn=e,this._syncViewport())}get headerWidth(){return"none"===this._headerVisibility||"column"===this._headerVisibility?0:this._rowHeaderSections.length}get headerHeight(){return"none"===this._headerVisibility||"row"===this._headerVisibility?0:this._columnHeaderSections.length}get bodyWidth(){return this._columnSections.length}get bodyHeight(){return this._rowSections.length}get totalWidth(){return this.headerWidth+this.bodyWidth}get totalHeight(){return this.headerHeight+this.bodyHeight}get viewportWidth(){return this._viewportWidth}get viewportHeight(){return this._viewportHeight}get pageWidth(){return Math.max(0,this.viewportWidth-this.headerWidth)}get pageHeight(){return Math.max(0,this.viewportHeight-this.headerHeight)}get scrollX(){return this._hScrollBar.value}get scrollY(){return this._vScrollBar.value}get maxScrollX(){return Math.max(0,this.bodyWidth-this.pageWidth-1)}get maxScrollY(){return Math.max(0,this.bodyHeight-this.pageHeight-1)}get viewport(){return this._viewport}get editorController(){return this._editorController}set editorController(e){this._editorController=e}get editingEnabled(){return this._editingEnabled}set editingEnabled(e){this._editingEnabled=e}get editable(){return this._editingEnabled&&null!==this._selectionModel&&null!==this._editorController&&this.dataModel instanceof Re}get canvasGC(){return this._canvasGC}get rowSections(){return this._rowSections}get columnSections(){return this._columnSections}get rowHeaderSections(){return this._rowHeaderSections}get columnHeaderSections(){return this._columnHeaderSections}scrollToRow(e){let t=this._rowSections.count;if(0===t)return;e=Math.floor(e),e=Math.max(0,Math.min(e,t-1));let i=this._rowSections.offsetOf(e),s=this._rowSections.extentOf(e),o=this._scrollY,r=this._scrollY+this.pageHeight-1,n=0;i<o?n=i-o-10:s>r&&(n=s-r+10),0!==n&&this.scrollBy(0,n)}scrollToColumn(e){let t=this._columnSections.count;if(0===t)return;e=Math.floor(e),e=Math.max(0,Math.min(e,t-1));let i=this._columnSections.offsetOf(e),s=this._columnSections.extentOf(e),o=this._scrollX,r=this._scrollX+this.pageWidth-1,n=0;i<o?n=i-o-10:s>r&&(n=s-r+10),0!==n&&this.scrollBy(n,0)}scrollToCell(e,t){let i=this._rowSections.count,s=this._columnSections.count;if(0===i||0===s)return;e=Math.floor(e),t=Math.floor(t),e=Math.max(0,Math.min(e,i-1)),t=Math.max(0,Math.min(t,s-1));let o=this._columnSections.offsetOf(t),r=this._columnSections.extentOf(t),n=this._rowSections.offsetOf(e),a=this._rowSections.extentOf(e),l=this._scrollX,h=this._scrollX+this.pageWidth-1,c=this._scrollY,d=this._scrollY+this.pageHeight-1,u=0,_=0;o<l?u=o-l-10:r>h&&(u=r-h+10),n<c?_=n-c-10:a>d&&(_=a-d+10),0===u&&0===_||this.scrollBy(u,_)}moveCursor(e){if(!this.dataModel||!this._selectionModel||this._selectionModel.isEmpty)return;const t=this._selectionModel.selections();if(t.next()&&!t.next()){const t=this._selectionModel.currentSelection();if(t.r1===t.r2&&t.c1===t.c2){const i="down"===e?1:"up"===e?-1:0,s="right"===e?1:"left"===e?-1:0;let o=t.r1+i,r=t.c1+s;const n=this.dataModel.rowCount("body"),a=this.dataModel.columnCount("body");return o>=n?(o=0,r+=1):-1===o&&(o=n-1,r-=1),r>=a?(r=0,o+=1,o>=n&&(o=0)):-1===r&&(r=a-1,o-=1,-1===o&&(o=n-1)),void this._selectionModel.select({r1:o,c1:r,r2:o,c2:r,cursorRow:o,cursorColumn:r,clear:"all"})}}this._selectionModel.moveCursorWithinSelections(e)}scrollToCursor(){if(!this._selectionModel)return;let e=this._selectionModel.cursorRow,t=this._selectionModel.cursorColumn;this.scrollToCell(e,t)}scrollBy(e,t){this.scrollTo(this.scrollX+e,this.scrollY+t)}scrollByPage(e){let t=0,i=0;switch(e){case"up":i=-this.pageHeight;break;case"down":i=this.pageHeight;break;case"left":t=-this.pageWidth;break;case"right":t=this.pageWidth;break;default:throw"unreachable"}this.scrollTo(this.scrollX+t,this.scrollY+i)}scrollByStep(e){let t,i,s=this.scrollX,o=this.scrollY,r=this._rowSections,n=this._columnSections;switch(e){case"up":t=r.indexOf(o-1),o=t<0?o:r.offsetOf(t);break;case"down":t=r.indexOf(o),o=t<0?o:r.offsetOf(t)+r.sizeOf(t);break;case"left":i=n.indexOf(s-1),s=i<0?s:n.offsetOf(i);break;case"right":i=n.indexOf(s),s=i<0?s:n.offsetOf(i)+n.sizeOf(i);break;default:throw"unreachable"}this.scrollTo(s,o)}scrollTo(e,t){e=Math.max(0,Math.min(Math.floor(e),this.maxScrollX)),t=Math.max(0,Math.min(Math.floor(t),this.maxScrollY)),this._hScrollBar.value=e,this._vScrollBar.value=t,se.MessageLoop.postMessage(this._viewport,Te.ScrollRequest)}rowCount(e){let t;return t="body"===e?this._rowSections.count:this._columnHeaderSections.count,t}columnCount(e){let t;return t="body"===e?this._columnSections.count:this._rowHeaderSections.count,t}rowAt(e,t){if(t<0)return-1;if("column-header"===e)return this._columnHeaderSections.indexOf(t);let i=this._rowSections.indexOf(t);if(i>=0)return i;if(!this._stretchLastRow)return-1;let s=this.bodyHeight,o=this.pageHeight;return o<=s||t>=o?-1:this._rowSections.count-1}columnAt(e,t){if(t<0)return-1;if("row-header"===e)return this._rowHeaderSections.indexOf(t);let i=this._columnSections.indexOf(t);if(i>=0)return i;if(!this._stretchLastColumn)return-1;let s=this.bodyWidth,o=this.pageWidth;return o<=s||t>=o?-1:this._columnSections.count-1}rowOffset(e,t){let i;return i="body"===e?this._rowSections.offsetOf(t):this._columnHeaderSections.offsetOf(t),i}columnOffset(e,t){let i;return i="body"===e?this._columnSections.offsetOf(t):this._rowHeaderSections.offsetOf(t),i}rowSize(e,t){if("column-header"===e)return this._columnHeaderSections.sizeOf(t);let i=this._rowSections.sizeOf(t);if(i<0)return i;if(!this._stretchLastRow)return i;if(t<this._rowSections.count-1)return i;let s=this.bodyHeight,o=this.pageHeight;return o<=s?i:i+(o-s)}columnSize(e,t){if("row-header"===e)return this._rowHeaderSections.sizeOf(t);let i=this._columnSections.sizeOf(t);if(i<0)return i;if(!this._stretchLastColumn)return i;if(t<this._columnSections.count-1)return i;let s=this.bodyWidth,o=this.pageWidth;return o<=s?i:i+(o-s)}resizeRow(e,t,i){let s=new Te.RowResizeRequest(e,t,i);se.MessageLoop.postMessage(this._viewport,s)}resizeColumn(e,t,i){let s=new Te.ColumnResizeRequest(e,t,i);se.MessageLoop.postMessage(this._viewport,s)}resetRows(e){switch(e){case"all":this._rowSections.reset(),this._columnHeaderSections.reset();break;case"body":this._rowSections.reset();break;case"column-header":this._columnHeaderSections.reset();break;default:throw"unreachable"}this.repaintContent(),this.repaintOverlay()}resetColumns(e){switch(e){case"all":this._columnSections.reset(),this._rowHeaderSections.reset();break;case"body":this._columnSections.reset();break;case"row-header":this._rowHeaderSections.reset();break;default:throw"unreachable"}this.repaintContent(),this.repaintOverlay()}fitColumnNames(e="all",t=15,i){if(this.dataModel){let s=void 0===i||i<0?void 0:i;if("row-header"===e||"all"===e)if(void 0!==s){const e=this.dataModel.columnCount("row-header");s-e<0?(this._fitRowColumnHeaders(this.dataModel,t,s),s=0):(this._fitRowColumnHeaders(this.dataModel,t,e),s-=e)}else this._fitRowColumnHeaders(this.dataModel,t);if("body"===e||"all"===e)if(void 0!==s){const e=this.dataModel.columnCount("body");s-e<0?(this._fitBodyColumnHeaders(this.dataModel,t,s),s=0):this._fitBodyColumnHeaders(this.dataModel,t,Math.min(s,e))}else this._fitBodyColumnHeaders(this.dataModel,t)}}mapToLocal(e,t){let i=this._viewport.node.getBoundingClientRect(),{left:s,top:o}=i;return s=Math.floor(s),o=Math.floor(o),{lx:e-s,ly:t-o}}mapToVirtual(e,t){let{lx:i,ly:s}=this.mapToLocal(e,t);return{vx:i+this.scrollX-this.headerWidth,vy:s+this.scrollY-this.headerHeight}}hitTest(e,t){let{lx:i,ly:s}=this.mapToLocal(e,t),o=this.headerWidth,r=this.headerHeight,n=this.bodyWidth,a=this.bodyHeight,l=this.pageHeight,h=this.pageWidth;if(this._stretchLastColumn&&h>n&&(n=h),this._stretchLastRow&&l>a&&(a=l),i>=0&&i<o&&s>=0&&s<r){let e=i,t=s,o=this.rowAt("column-header",t),r=this.columnAt("row-header",e);return{region:"corner-header",row:o,column:r,x:e-this.columnOffset("row-header",r),y:t-this.rowOffset("column-header",o),width:this.columnSize("row-header",r),height:this.rowSize("column-header",o)}}if(s>=0&&s<r&&i>=0&&i<o+n){let e=i+this._scrollX-o,t=s,r=this.rowAt("column-header",t),n=this.columnAt("body",e);return{region:"column-header",row:r,column:n,x:e-this.columnOffset("body",n),y:t-this.rowOffset("column-header",r),width:this.columnSize("body",n),height:this.rowSize("column-header",r)}}if(i>=0&&i<o&&s>=0&&s<r+a){let e=i,t=s+this._scrollY-r,o=this.rowAt("body",t),n=this.columnAt("row-header",e);return{region:"row-header",row:o,column:n,x:e-this.columnOffset("row-header",n),y:t-this.rowOffset("body",o),width:this.columnSize("row-header",n),height:this.rowSize("body",o)}}if(i>=o&&i<o+n&&s>=r&&s<r+a){let e=i+this._scrollX-o,t=s+this._scrollY-r,n=this.rowAt("body",t),a=this.columnAt("body",e);return{region:"body",row:n,column:a,x:e-this.columnOffset("body",a),y:t-this.rowOffset("body",n),width:this.columnSize("body",a),height:this.rowSize("body",n)}}return{region:"void",row:-1,column:-1,x:-1,y:-1,width:-1,height:-1}}copyToClipboard(){let e=this._dataModel;if(!e)return;let t=this._selectionModel;if(!t)return;let i=Array.from(t.selections());if(0===i.length)return;if(i.length>1)return void alert("Cannot copy multiple grid selections.");let s=e.rowCount("body"),o=e.columnCount("body");if(0===s||0===o)return;let{r1:r,c1:n,r2:a,c2:l}=i[0];r=Math.max(0,Math.min(r,s-1)),n=Math.max(0,Math.min(n,o-1)),a=Math.max(0,Math.min(a,s-1)),l=Math.max(0,Math.min(l,o-1)),a<r&&([r,a]=[a,r]),l<n&&([n,l]=[l,n]);let h=e.columnCount("row-header"),c=e.rowCount("column-header"),d=this._copyConfig.separator,u=this._copyConfig.format,_=this._copyConfig.headers,m=this._copyConfig.warningThreshold,p=a-r+1,g=l-n+1;switch(_){case"none":h=0,c=0;break;case"row":c=0,g+=h;break;case"column":h=0,p+=c;break;case"all":p+=c,g+=h;break;default:throw"unreachable"}let f=p*g;if(f>m){let e=`Copying ${f} cells may take a while. Continue?`;if(!window.confirm(e))return}let v={region:"body",row:0,column:0,value:null,metadata:{}},w=new Array(p);for(let t=0;t<p;++t){let i=new Array(g);for(let s=0;s<g;++s){let o,a,l;t<c&&s<h?(o="corner-header",a=t,l=s):t<c?(o="column-header",a=t,l=s-h+n):s<h?(o="row-header",a=t-c+r,l=s):(o="body",a=t-c+r,l=s-h+n),v.region=o,v.row=a,v.column=l,v.value=e.data(o,a,l),v.metadata=e.metadata(o,a,l),i[s]=u(v)}w[t]=i}let b=w.map((e=>e.join(d))).join("\n");Q.ClipboardExt.copyText(b)}processMessage(e){if("child-shown"!==e.type&&"child-hidden"!==e.type){if("fit-request"===e.type){let e=Q.ElementExt.sizeLimits(this._vScrollBar.node),t=Q.ElementExt.sizeLimits(this._hScrollBar.node);this._vScrollBarMinWidth=e.minWidth,this._hScrollBarMinHeight=t.minHeight}super.processMessage(e)}}messageHook(e,t){return e===this._viewport?(this._processViewportMessage(t),!0):e===this._hScrollBar&&"activate-request"===t.type?(this.activate(),!1):e!==this._vScrollBar||"activate-request"!==t.type||(this.activate(),!1)}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseup":this._evtMouseUp(e);break;case"dblclick":this._evtMouseDoubleClick(e);break;case"mouseleave":this._evtMouseLeave(e);break;case"contextmenu":this._evtContextMenu(e);break;case"wheel":this._evtWheel(e);break;case"resize":this._refreshDPI()}}onActivateRequest(e){this.viewport.node.focus({preventScroll:!0})}onBeforeAttach(e){window.addEventListener("resize",this),this.node.addEventListener("wheel",this),this._viewport.node.addEventListener("keydown",this),this._viewport.node.addEventListener("mousedown",this),this._viewport.node.addEventListener("mousemove",this),this._viewport.node.addEventListener("dblclick",this),this._viewport.node.addEventListener("mouseleave",this),this._viewport.node.addEventListener("contextmenu",this),this.repaintContent(),this.repaintOverlay()}onAfterDetach(e){window.removeEventListener("resize",this),this.node.removeEventListener("wheel",this),this._viewport.node.removeEventListener("keydown",this),this._viewport.node.removeEventListener("mousedown",this),this._viewport.node.removeEventListener("mousemove",this),this._viewport.node.removeEventListener("mouseleave",this),this._viewport.node.removeEventListener("dblclick",this),this._viewport.node.removeEventListener("contextmenu",this),this._releaseMouse()}onBeforeShow(e){this.repaintContent(),this.repaintOverlay()}onResize(e){this._editorController&&this._editorController.cancel(),this._syncScrollState()}repaintContent(){let e=new Te.PaintRequest("all",0,0,0,0);se.MessageLoop.postMessage(this._viewport,e)}repaintRegion(e,t,i,s,o){let r=new Te.PaintRequest(e,t,i,s,o);se.MessageLoop.postMessage(this._viewport,r)}repaintOverlay(){se.MessageLoop.postMessage(this._viewport,Te.OverlayPaintRequest)}_resizeCanvasIfNeeded(e,t){e*=this._dpiRatio,t*=this._dpiRatio;let i=512*(Math.ceil((e+1)/512)+1),s=512*(Math.ceil((t+1)/512)+1),o=this._canvas.width,r=this._canvas.height;if(o>=e&&r>=t&&o<=i&&r<=s)return;let n=i-512,a=s-512;this._canvasGC.setTransform(1,0,0,1,0,0),this._bufferGC.setTransform(1,0,0,1,0,0),this._overlayGC.setTransform(1,0,0,1,0,0),o<e?this._buffer.width=n:o>i&&(this._buffer.width=i),r<t?this._buffer.height=a:r>s&&(this._buffer.height=s);let l=r>0&&r>0&&e>0&&t>0;l&&this._bufferGC.drawImage(this._canvas,0,0),o<e?(this._canvas.width=n,this._canvas.style.width=n/this._dpiRatio+"px"):o>i&&(this._canvas.width=i,this._canvas.style.width=i/this._dpiRatio+"px"),r<t?(this._canvas.height=a,this._canvas.style.height=a/this._dpiRatio+"px"):r>s&&(this._canvas.height=s,this._canvas.style.height=s/this._dpiRatio+"px"),l&&this._canvasGC.drawImage(this._buffer,0,0),l&&this._bufferGC.drawImage(this._overlay,0,0),o<e?(this._overlay.width=n,this._overlay.style.width=n/this._dpiRatio+"px"):o>i&&(this._overlay.width=i,this._overlay.style.width=i/this._dpiRatio+"px"),r<t?(this._overlay.height=a,this._overlay.style.height=a/this._dpiRatio+"px"):r>s&&(this._overlay.height=s,this._overlay.style.height=s/this._dpiRatio+"px"),l&&this._overlayGC.drawImage(this._buffer,0,0)}_syncScrollState(){let e=this.bodyWidth,t=this.bodyHeight,i=this.pageWidth,s=this.pageHeight,o=!this._vScrollBar.isHidden,r=!this._hScrollBar.isHidden,n=this._vScrollBarMinWidth,a=this._hScrollBarMinHeight,l=i+(o?n:0),h=s+(r?a:0),c=h<t-1,u=l<e-1;c&&!u&&(u=l-n<e-1),u&&!c&&(c=h-a<t-1),c===o&&u===r||(this._vScrollBar.setHidden(!c),this._hScrollBar.setHidden(!u),this._scrollCorner.setHidden(!c||!u),se.MessageLoop.sendMessage(this,d.Widget.Msg.FitRequest)),this._vScrollBar.maximum=this.maxScrollY,this._vScrollBar.page=this.pageHeight,this._hScrollBar.maximum=this.maxScrollX,this._hScrollBar.page=this.pageWidth,this._scrollTo(this._scrollX,this._scrollY)}_syncViewport(){this.repaintContent(),this.repaintOverlay(),this._syncScrollState()}_processViewportMessage(e){switch(e.type){case"resize":this._onViewportResize(e);break;case"scroll-request":this._onViewportScrollRequest(e);break;case"paint-request":this._onViewportPaintRequest(e);break;case"overlay-paint-request":this._onViewportOverlayPaintRequest(e);break;case"row-resize-request":this._onViewportRowResizeRequest(e);break;case"column-resize-request":this._onViewportColumnResizeRequest(e)}}_onViewportResize(e){if(!this._viewport.isVisible)return;let{width:t,height:i}=e;-1===t&&(t=this._viewport.node.offsetWidth),-1===i&&(i=this._viewport.node.offsetHeight),t=Math.round(t),i=Math.round(i);let s=this._viewportWidth,o=this._viewportHeight;if(this._viewportWidth=t,this._viewportHeight=i,this._resizeCanvasIfNeeded(t,i),0!==t&&0!==i){if(0===s||0===o)return this.paintContent(0,0,t,i),void this._paintOverlay();if(this._stretchLastColumn&&this.pageWidth>this.bodyWidth){let e=this._columnSections.offsetOf(this._columnSections.count-1),o=Math.min(this.headerWidth+e,s);this.paintContent(o,0,t-o,i)}else t>s&&this.paintContent(s,0,t-s+1,i);if(this._stretchLastRow&&this.pageHeight>this.bodyHeight){let e=this._rowSections.offsetOf(this._rowSections.count-1),s=Math.min(this.headerHeight+e,o);this.paintContent(0,s,t,i-s)}else i>o&&this.paintContent(0,o,t,i-o+1);this._paintOverlay()}}_onViewportScrollRequest(e){this._scrollTo(this._hScrollBar.value,this._vScrollBar.value)}_onViewportPaintRequest(e){if(!this._viewport.isVisible)return;if(0===this._viewportWidth||0===this._viewportHeight)return;let t,i,s,o,r=this._viewportWidth-1,n=this._viewportHeight-1,a=this._scrollX,l=this._scrollY,h=this.headerWidth,c=this.headerHeight,d=this._rowSections,u=this._columnSections,_=this._rowHeaderSections,m=this._columnHeaderSections,{region:p,r1:g,c1:f,r2:v,c2:w}=e;switch(p){case"all":t=0,i=0,s=r,o=n;break;case"body":g=Math.max(0,Math.min(g,d.count)),f=Math.max(0,Math.min(f,u.count)),v=Math.max(0,Math.min(v,d.count)),w=Math.max(0,Math.min(w,u.count)),t=u.offsetOf(f)-a+h,i=d.offsetOf(g)-l+c,s=u.extentOf(w)-a+h,o=d.extentOf(v)-l+c;break;case"row-header":g=Math.max(0,Math.min(g,d.count)),f=Math.max(0,Math.min(f,_.count)),v=Math.max(0,Math.min(v,d.count)),w=Math.max(0,Math.min(w,_.count)),t=_.offsetOf(f),i=d.offsetOf(g)-l+c,s=_.extentOf(w),o=d.extentOf(v)-l+c;break;case"column-header":g=Math.max(0,Math.min(g,m.count)),f=Math.max(0,Math.min(f,u.count)),v=Math.max(0,Math.min(v,m.count)),w=Math.max(0,Math.min(w,u.count)),t=u.offsetOf(f)-a+h,i=m.offsetOf(g),s=u.extentOf(w)-a+h,o=m.extentOf(v);break;case"corner-header":g=Math.max(0,Math.min(g,m.count)),f=Math.max(0,Math.min(f,_.count)),v=Math.max(0,Math.min(v,m.count)),w=Math.max(0,Math.min(w,_.count)),t=_.offsetOf(f),i=m.offsetOf(g),s=_.extentOf(w),o=m.extentOf(v);break;default:throw"unreachable"}s<0||o<0||t>r||i>n||(t=Math.max(0,Math.min(t,r)),i=Math.max(0,Math.min(i,n)),s=Math.max(0,Math.min(s,r)),o=Math.max(0,Math.min(o,n)),this.paintContent(t,i,s-t+1,o-i+1))}_onViewportOverlayPaintRequest(e){this._viewport.isVisible&&0!==this._viewportWidth&&0!==this._viewportHeight&&this._paintOverlay()}_onViewportRowResizeRequest(e){"body"===e.region?this._resizeRow(e.index,e.size):this._resizeColumnHeader(e.index,e.size)}_onViewportColumnResizeRequest(e){"body"===e.region?this._resizeColumn(e.index,e.size):this._resizeRowHeader(e.index,e.size)}_onThumbMoved(e){se.MessageLoop.postMessage(this._viewport,Te.ScrollRequest)}_onPageRequested(e,t){e===this._vScrollBar?this.scrollByPage("decrement"===t?"up":"down"):this.scrollByPage("decrement"===t?"left":"right")}_onStepRequested(e,t){e===this._vScrollBar?this.scrollByStep("decrement"===t?"up":"down"):this.scrollByStep("decrement"===t?"left":"right")}_onDataModelChanged(e,t){switch(t.type){case"rows-inserted":this._onRowsInserted(t);break;case"columns-inserted":this._onColumnsInserted(t);break;case"rows-removed":this._onRowsRemoved(t);break;case"columns-removed":this._onColumnsRemoved(t);break;case"rows-moved":this._onRowsMoved(t);break;case"columns-moved":this._onColumnsMoved(t);break;case"cells-changed":this._onCellsChanged(t);break;case"model-reset":this._onModelReset(t);break;default:throw"unreachable"}}_onSelectionsChanged(e){this.repaintOverlay()}_onRowsInserted(e){let t,{region:i,index:s,span:o}=e;o<=0||(t="body"===i?this._rowSections:this._columnHeaderSections,this._scrollY===this.maxScrollY&&this.maxScrollY>0?(t.insert(s,o),this._scrollY=this.maxScrollY):t.insert(s,o),this._syncViewport())}_onColumnsInserted(e){let t,{region:i,index:s,span:o}=e;o<=0||(t="body"===i?this._columnSections:this._rowHeaderSections,this._scrollX===this.maxScrollX&&this.maxScrollX>0?(t.insert(s,o),this._scrollX=this.maxScrollX):t.insert(s,o),this._syncViewport())}_onRowsRemoved(e){let t,{region:i,index:s,span:o}=e;o<=0||(t="body"===i?this._rowSections:this._columnHeaderSections,s<0||s>=t.count||(this._scrollY===this.maxScrollY&&this.maxScrollY>0?(t.remove(s,o),this._scrollY=this.maxScrollY):t.remove(s,o),this._syncViewport()))}_onColumnsRemoved(e){let t,{region:i,index:s,span:o}=e;o<=0||(t="body"===i?this._columnSections:this._rowHeaderSections,s<0||s>=t.count||(this._scrollX===this.maxScrollX&&this.maxScrollX>0?(t.remove(s,o),this._scrollX=this.maxScrollX):t.remove(s,o),this._syncViewport()))}_onRowsMoved(e){let t,{region:i,index:s,span:o,destination:r}=e;if(o<=0)return;if(t="body"===i?this._rowSections:this._columnHeaderSections,s<0||s>=t.count)return;if(o=Math.min(o,t.count-s),r=Math.min(Math.max(0,r),t.count-o),s===r)return;let n=Math.min(s,r),a=Math.max(s+o-1,r+o-1);t.move(s,o,r),"body"===i?(this.repaintRegion("body",n,0,a,1/0),this.repaintRegion("row-header",n,0,a,1/0)):(this.repaintRegion("column-header",n,0,a,1/0),this.repaintRegion("corner-header",n,0,a,1/0)),this._syncViewport()}_onColumnsMoved(e){let t,{region:i,index:s,span:o,destination:r}=e;if(o<=0)return;if(t="body"===i?this._columnSections:this._rowHeaderSections,s<0||s>=t.count)return;if(o=Math.min(o,t.count-s),r=Math.min(Math.max(0,r),t.count-o),s===r)return;t.move(s,o,r);let n=Math.min(s,r),a=Math.max(s+o-1,r+o-1);"body"===i?(this.repaintRegion("body",0,n,1/0,a),this.repaintRegion("column-header",0,n,1/0,a)):(this.repaintRegion("row-header",0,n,1/0,a),this.repaintRegion("corner-header",0,n,1/0,a)),this._syncViewport()}_onCellsChanged(e){let{region:t,row:i,column:s,rowSpan:o,columnSpan:r}=e;if(o<=0&&r<=0)return;let n=i,a=s,l=n+o-1,h=a+r-1;this.repaintRegion(t,n,a,l,h)}_onModelReset(e){let t=this._rowSections.count,i=this._columnSections.count,s=this._rowHeaderSections.count,o=this._columnHeaderSections.count,r=this._dataModel.rowCount("body")-t,n=this._dataModel.columnCount("body")-i,a=this._dataModel.columnCount("row-header")-s,l=this._dataModel.rowCount("column-header")-o;r>0?this._rowSections.insert(t,r):r<0&&this._rowSections.remove(t+r,-r),n>0?this._columnSections.insert(i,n):n<0&&this._columnSections.remove(i+n,-n),a>0?this._rowHeaderSections.insert(s,a):a<0&&this._rowHeaderSections.remove(s+a,-a),l>0?this._columnHeaderSections.insert(o,l):l<0&&this._columnHeaderSections.remove(o+l,-l),this._syncViewport()}_onRenderersChanged(){this.repaintContent()}_evtKeyDown(e){this._mousedown?(e.preventDefault(),e.stopPropagation()):this._keyHandler&&this._keyHandler.onKeyDown(this,e)}_evtMouseDown(e){0===e.button&&(this.activate(),e.preventDefault(),e.stopPropagation(),document.addEventListener("keydown",this,!0),document.addEventListener("mouseup",this,!0),document.addEventListener("mousedown",this,!0),document.addEventListener("mousemove",this,!0),document.addEventListener("contextmenu",this,!0),this._mousedown=!0,this._mouseHandler&&this._mouseHandler.onMouseDown(this,e))}_evtMouseMove(e){this._mousedown&&(e.preventDefault(),e.stopPropagation()),this._mouseHandler&&(this._mousedown?this._mouseHandler.onMouseMove(this,e):this._mouseHandler.onMouseHover(this,e))}_evtMouseUp(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this._mouseHandler&&this._mouseHandler.onMouseUp(this,e),this._releaseMouse())}_evtMouseDoubleClick(e){0===e.button&&(e.preventDefault(),e.stopPropagation(),this._mouseHandler&&this._mouseHandler.onMouseDoubleClick(this,e),this._releaseMouse())}_evtMouseLeave(e){this._mousedown?(e.preventDefault(),e.stopPropagation()):this._mouseHandler&&this._mouseHandler.onMouseLeave(this,e)}_evtContextMenu(e){this._mousedown?(e.preventDefault(),e.stopPropagation()):this._mouseHandler&&this._mouseHandler.onContextMenu(this,e)}_evtWheel(e){Q.Platform.accelKey(e)||this._mouseHandler&&(e.preventDefault(),e.stopPropagation(),this._mouseHandler.onWheel(this,e))}_releaseMouse(){this._mousedown=!1,this._mouseHandler&&this._mouseHandler.release(),document.removeEventListener("keydown",this,!0),document.removeEventListener("mouseup",this,!0),document.removeEventListener("mousedown",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("contextmenu",this,!0)}_refreshDPI(){let e=Math.ceil(window.devicePixelRatio);this._dpiRatio!==e&&(this._dpiRatio=e,this.repaintContent(),this.repaintOverlay(),this._resizeCanvasIfNeeded(this._viewportWidth,this._viewportHeight),this._canvas.style.width=this._canvas.width/this._dpiRatio+"px",this._canvas.style.height=this._canvas.height/this._dpiRatio+"px",this._overlay.style.width=this._overlay.width/this._dpiRatio+"px",this._overlay.style.height=this._overlay.height/this._dpiRatio+"px")}_resizeRow(e,t){let i=this._rowSections;if(e<0||e>=i.count)return;let s=i.sizeOf(e),o=i.clampSize(t);if(s===o)return;i.resize(e,o);let r=this._viewportWidth,n=this._viewportHeight;if(!this._viewport.isVisible||0===r||0===n)return void this._syncScrollState();if(Te.shouldPaintEverything(this._dataModel))return this.paintContent(0,0,r,n),this._paintOverlay(),void this._syncScrollState();let a=o-s,l=this.headerHeight,h=i.offsetOf(e)+l-this._scrollY;if(l>=n||h>=n)return void this._syncScrollState();if(h+s<=l)return this._scrollY+=a,void this._syncScrollState();let c=Math.max(l,h);if(h+s>=n||h+o>=n)return this.paintContent(0,c,r,n-c),this._paintOverlay(),void this._syncScrollState();let d,u,_,m=r;if(h+o<=l?(d=l-a,u=n-d,_=l):(d=h+s,u=n-d,_=d+a),this._blitContent(this._canvas,0,d,m,u,0,_),o>0&&h+o>l&&this.paintContent(0,c,r,h+o-c),this._stretchLastRow&&this.pageHeight>this.bodyHeight){let e=this._rowSections.count-1,t=l+this._rowSections.offsetOf(e);this.paintContent(0,t,r,n-t)}else a<0&&this.paintContent(0,n+a,r,-a);this._paintOverlay(),this._syncScrollState()}_resizeColumn(e,t){let i=this._columnSections;if(e<0||e>=i.count)return;let s=i.sizeOf(e),o=i.clampSize(t);if(s===o)return;i.resize(e,o);let r=this._viewportWidth,n=this._viewportHeight;if(!this._viewport.isVisible||0===r||0===n)return void this._syncScrollState();if(Te.shouldPaintEverything(this._dataModel))return this.paintContent(0,0,r,n),this._paintOverlay(),void this._syncScrollState();let a=o-s,l=this.headerWidth,h=i.offsetOf(e)+l-this._scrollX;if(l>=r||h>=r)return void this._syncScrollState();if(h+s<=l)return this._scrollX+=a,void this._syncScrollState();let c=Math.max(l,h);if(h+s>=r||h+o>=r)return this.paintContent(c,0,r-c,n),this._paintOverlay(),void this._syncScrollState();let d,u,_,m=n;if(h+o<=l?(d=l-a,u=r-d,_=l):(d=h+s,u=r-d,_=d+a),this._blitContent(this._canvas,d,0,u,m,_,0),o>0&&h+o>l&&this.paintContent(c,0,h+o-c,n),this._stretchLastColumn&&this.pageWidth>this.bodyWidth){let e=this._columnSections.count-1,t=l+this._columnSections.offsetOf(e);this.paintContent(t,0,r-t,n)}else a<0&&this.paintContent(r+a,0,-a,n);this._paintOverlay(),this._syncScrollState()}_resizeRowHeader(e,t){let i=this._rowHeaderSections;if(e<0||e>=i.count)return;let s=i.sizeOf(e),o=i.clampSize(t);if(s===o)return;i.resize(e,o);let r=this._viewportWidth,n=this._viewportHeight;if(!this._viewport.isVisible||0===r||0===n)return void this._syncScrollState();if(Te.shouldPaintEverything(this._dataModel))return this.paintContent(0,0,r,n),this._paintOverlay(),void this._syncScrollState();let a=o-s,l=i.offsetOf(e);if(l>=r)return void this._syncScrollState();if(l+s>=r||l+o>=r)return this.paintContent(l,0,r-l,n),this._paintOverlay(),void this._syncScrollState();let h=l+s,c=r-h,d=n,u=h+a;if(this._blitContent(this._canvas,h,0,c,d,u,0),o>0&&this.paintContent(l,0,o,n),this._stretchLastColumn&&this.pageWidth>this.bodyWidth){let e=this._columnSections.count-1,t=this.headerWidth+this._columnSections.offsetOf(e);this.paintContent(t,0,r-t,n)}else a<0&&this.paintContent(r+a,0,1-a,n);this._paintOverlay(),this._syncScrollState()}_resizeColumnHeader(e,t){let i=this._columnHeaderSections;if(e<0||e>=i.count)return;let s=i.sizeOf(e),o=i.clampSize(t);if(s===o)return;i.resize(e,o);let r=this._viewportWidth,n=this._viewportHeight;if(!this._viewport.isVisible||0===r||0===n)return void this._syncScrollState();if(Te.shouldPaintEverything(this._dataModel))return this.paintContent(0,0,r,n),this._paintOverlay(),void this._syncScrollState();this._paintOverlay();let a=o-s,l=i.offsetOf(e);if(l>=n)return void this._syncScrollState();if(l+s>=n||l+o>=n)return this.paintContent(0,l,r,n-l),this._paintOverlay(),void this._syncScrollState();let h=l+s,c=r,d=n-h,u=h+a;if(this._blitContent(this._canvas,0,h,c,d,0,u),o>0&&this.paintContent(0,l,r,o),this._stretchLastRow&&this.pageHeight>this.bodyHeight){let e=this._rowSections.count-1,t=this.headerHeight+this._rowSections.offsetOf(e);this.paintContent(0,t,r,n-t)}else a<0&&this.paintContent(0,n+a,r,1-a);this._paintOverlay(),this._syncScrollState()}_scrollTo(e,t){if(!this.dataModel)return;e=Math.max(0,Math.min(Math.floor(e),this.maxScrollX)),t=Math.max(0,Math.min(Math.floor(t),this.maxScrollY)),this._hScrollBar.value=e,this._vScrollBar.value=t;let i=e-this._scrollX,s=t-this._scrollY;if(0===i&&0===s)return;if(!this._viewport.isVisible)return this._scrollX=e,void(this._scrollY=t);let o=this._viewportWidth,r=this._viewportHeight;if(0===o||0===r)return this._scrollX=e,void(this._scrollY=t);let n=this.headerWidth,a=this.headerHeight,l=o-n,h=r-a;if(l<=0&&h<=0)return this._scrollX=e,void(this._scrollY=t);let c=0;0!==i&&l>0&&(c=Math.abs(i)>=l?l*r:Math.abs(i)*r);let d=0;if(0!==s&&h>0&&(d=Math.abs(s)>=h?o*h:o*Math.abs(s)),c+d>=o*r)return this._scrollX=e,this._scrollY=t,this.paintContent(0,0,o,r),void this._paintOverlay();if(this._scrollY=t,0!==s&&h>0)if(Math.abs(s)>=h)this.paintContent(0,a,o,h);else{const e=0,t=s<0?a:a+s,i=o,n=h-Math.abs(s);this._blitContent(this._canvas,e,t,i,n,e,t-s),this.paintContent(0,s<0?a:r-s,o,Math.abs(s))}if(this._scrollX=e,0!==i&&l>0)if(Math.abs(i)>=l)this.paintContent(n,0,l,r);else{const e=i<0?n:n+i,t=0,s=l-Math.abs(i),a=r;this._blitContent(this._canvas,e,t,s,a,e-i,t),this.paintContent(i<0?n:o-i,0,Math.abs(i),r)}this._paintOverlay()}_blitContent(e,t,i,s,o,r,n){t*=this._dpiRatio,i*=this._dpiRatio,s*=this._dpiRatio,o*=this._dpiRatio,r*=this._dpiRatio,n*=this._dpiRatio,this._canvasGC.save(),this._canvasGC.setTransform(1,0,0,1,0,0),this._canvasGC.drawImage(e,t,i,s,o,r,n,s,o),this._canvasGC.restore()}paintContent(e,t,i,s){this._canvasGC.setTransform(this._dpiRatio,0,0,this._dpiRatio,0,0),this._bufferGC.setTransform(this._dpiRatio,0,0,this._dpiRatio,0,0),this._canvasGC.clearRect(e,t,i,s),this._drawVoidRegion(e,t,i,s),this._drawBodyRegion(e,t,i,s),this._drawRowHeaderRegion(e,t,i,s),this._drawColumnHeaderRegion(e,t,i,s),this.drawCornerHeaderRegion(e,t,i,s)}_fitBodyColumnHeaders(e,t,i){const s=void 0===i?e.columnCount("body"):i;for(let i=0;i<s;i++){const s=e.rowCount("column-header");let o=0;for(let t=0;t<s;t++){const s=e.data("column-header",t,i);let r={x:0,y:0,width:0,height:0,region:"column-header",row:0,column:i,value:null,metadata:He.emptyMetadata};const n=this.cellRenderers.get(r),a=this.canvasGC;a.font=ne.resolveOption(n.font,r);const l=a.measureText(s).width;o=Math.max(o,l)}this.resizeColumn("body",i,o+t)}}_fitRowColumnHeaders(e,t,i){const s=void 0===i?e.columnCount("row-header"):i;for(let i=0;i<s;i++){const s=e.rowCount("column-header");let o=0;for(let t=0;t<s;t++){const s=e.data("corner-header",t,i);let r={x:0,y:0,width:0,height:0,region:"column-header",row:0,column:i,value:null,metadata:He.emptyMetadata};const n=this.cellRenderers.get(r),a=this.canvasGC;a.font=ne.resolveOption(n.font,r);const l=a.measureText(s).width;o=Math.max(o,l)}this.resizeColumn("row-header",i,o+t)}}_paintOverlay(){this._overlayGC.setTransform(this._dpiRatio,0,0,this._dpiRatio,0,0),this._overlayGC.clearRect(0,0,this._overlay.width,this._overlay.height),this._drawBodySelections(),this._drawRowHeaderSelections(),this._drawColumnHeaderSelections(),this._drawCursor(),this._drawShadows()}_drawVoidRegion(e,t,i,s){let o=this._style.voidColor;o&&(this._canvasGC.fillStyle=o,this._canvasGC.fillRect(e,t,i,s))}_drawBodyRegion(e,t,i,s){let o=this._columnSections.length-this._scrollX,r=this._rowSections.length-this._scrollY;if(o<=0||r<=0)return;let n=this.headerWidth,a=this.headerHeight;if(e+i<=n)return;if(t+s<=a)return;if(e>=n+o)return;if(t>=a+r)return;let l=this.bodyHeight,h=this.bodyWidth,c=this.pageHeight,d=this.pageWidth,u=Math.max(e,n),_=Math.max(t,a),m=Math.min(e+i-1,n+o-1),p=Math.min(t+s-1,a+r-1),g=this._rowSections.indexOf(_-a+this._scrollY),f=this._columnSections.indexOf(u-n+this._scrollX),v=this._rowSections.indexOf(p-a+this._scrollY),w=this._columnSections.indexOf(m-n+this._scrollX),b=this._rowSections.count-1,y=this._columnSections.count-1;v<0&&(v=b),w<0&&(w=y);let S=this._columnSections.offsetOf(f)+n-this._scrollX,C=this._rowSections.offsetOf(g)+a-this._scrollY,x=0,M=0,k=new Array(v-g+1),E=new Array(w-f+1);for(let e=g;e<=v;++e){let t=this._rowSections.sizeOf(e);k[e-g]=t,M+=t}for(let e=f;e<=w;++e){let t=this._columnSections.sizeOf(e);E[e-f]=t,x+=t}if(this._stretchLastRow&&c>l&&v===b){let e=this.pageHeight-this.bodyHeight;k[k.length-1]+=e,M+=e,p+=e}if(this._stretchLastColumn&&d>h&&w===y){let e=this.pageWidth-this.bodyWidth;E[E.length-1]+=e,x+=e,m+=e}let H={region:"body",xMin:u,yMin:_,xMax:m,yMax:p,x:S,y:C,width:x,height:M,row:g,column:f,rowSizes:k,columnSizes:E};this._drawBackground(H,this._style.backgroundColor),this._drawRowBackground(H,this._style.rowBackgroundColor),this._drawColumnBackground(H,this._style.columnBackgroundColor),this._drawCells(H),this._drawHorizontalGridLines(H,this._style.horizontalGridLineColor||this._style.gridLineColor),this._drawVerticalGridLines(H,this._style.verticalGridLineColor||this._style.gridLineColor)}_drawRowHeaderRegion(e,t,i,s){let o=this.headerWidth,r=this.bodyHeight-this._scrollY;if(o<=0||r<=0)return;let n=this.headerHeight;if(e+i<=0)return;if(t+s<=n)return;if(e>=0+o)return;if(t>=n+r)return;let a=this.bodyHeight,l=this.pageHeight,h=e,c=Math.max(t,n),d=Math.min(e+i-1,0+o-1),u=Math.min(t+s-1,n+r-1),_=this._rowSections.indexOf(c-n+this._scrollY),m=this._rowHeaderSections.indexOf(h),p=this._rowSections.indexOf(u-n+this._scrollY),g=this._rowHeaderSections.indexOf(d),f=this._rowSections.count-1,v=this._rowHeaderSections.count-1;p<0&&(p=f),g<0&&(g=v);let w=this._rowHeaderSections.offsetOf(m),b=this._rowSections.offsetOf(_)+n-this._scrollY,y=0,S=0,C=new Array(p-_+1),x=new Array(g-m+1);for(let e=_;e<=p;++e){let t=this._rowSections.sizeOf(e);C[e-_]=t,S+=t}for(let e=m;e<=g;++e){let t=this._rowHeaderSections.sizeOf(e);x[e-m]=t,y+=t}if(this._stretchLastRow&&l>a&&p===f){let e=this.pageHeight-this.bodyHeight;C[C.length-1]+=e,S+=e,u+=e}let M={region:"row-header",xMin:h,yMin:c,xMax:d,yMax:u,x:w,y:b,width:y,height:S,row:_,column:m,rowSizes:C,columnSizes:x};this._drawBackground(M,this._style.headerBackgroundColor),this._drawCells(M),this._drawHorizontalGridLines(M,this._style.headerHorizontalGridLineColor||this._style.headerGridLineColor),this._drawVerticalGridLines(M,this._style.headerVerticalGridLineColor||this._style.headerGridLineColor)}_drawColumnHeaderRegion(e,t,i,s){let o=this.bodyWidth-this._scrollX,r=this.headerHeight;if(o<=0||r<=0)return;let n=this.headerWidth;if(e+i<=n)return;if(t+s<=0)return;if(e>=n+o)return;if(t>=0+r)return;let a=this.bodyWidth,l=this.pageWidth,h=Math.max(e,n),c=t,d=Math.min(e+i-1,n+o-1),u=Math.min(t+s-1,0+r-1),_=this._columnHeaderSections.indexOf(c),m=this._columnSections.indexOf(h-n+this._scrollX),p=this._columnHeaderSections.indexOf(u),g=this._columnSections.indexOf(d-n+this._scrollX),f=this._columnHeaderSections.count-1,v=this._columnSections.count-1;p<0&&(p=f),g<0&&(g=v);let w=this._columnSections.offsetOf(m)+n-this._scrollX,b=this._columnHeaderSections.offsetOf(_),y=0,S=0,C=new Array(p-_+1),x=new Array(g-m+1);for(let e=_;e<=p;++e){let t=this._columnHeaderSections.sizeOf(e);C[e-_]=t,S+=t}for(let e=m;e<=g;++e){let t=this._columnSections.sizeOf(e);x[e-m]=t,y+=t}if(this._stretchLastColumn&&l>a&&g===v){let e=this.pageWidth-this.bodyWidth;x[x.length-1]+=e,y+=e,d+=e}let M={region:"column-header",xMin:h,yMin:c,xMax:d,yMax:u,x:w,y:b,width:y,height:S,row:_,column:m,rowSizes:C,columnSizes:x};this._drawBackground(M,this._style.headerBackgroundColor),this._drawCells(M),this._drawHorizontalGridLines(M,this._style.headerHorizontalGridLineColor||this._style.headerGridLineColor),this._drawVerticalGridLines(M,this._style.headerVerticalGridLineColor||this._style.headerGridLineColor)}drawCornerHeaderRegion(e,t,i,s){let o=this.headerWidth,r=this.headerHeight;if(o<=0||r<=0)return;if(e+i<=0)return;if(t+s<=0)return;if(e>=0+o)return;if(t>=0+r)return;let n=e,a=t,l=Math.min(e+i-1,0+o-1),h=Math.min(t+s-1,0+r-1),c=this._columnHeaderSections.indexOf(a),d=this._rowHeaderSections.indexOf(n),u=this._columnHeaderSections.indexOf(h),_=this._rowHeaderSections.indexOf(l);u<0&&(u=this._columnHeaderSections.count-1),_<0&&(_=this._rowHeaderSections.count-1);let m=this._rowHeaderSections.offsetOf(d),p=this._columnHeaderSections.offsetOf(c),g=0,f=0,v=new Array(u-c+1),w=new Array(_-d+1);for(let e=c;e<=u;++e){let t=this._columnHeaderSections.sizeOf(e);v[e-c]=t,f+=t}for(let e=d;e<=_;++e){let t=this._rowHeaderSections.sizeOf(e);w[e-d]=t,g+=t}let b={region:"corner-header",xMin:n,yMin:a,xMax:l,yMax:h,x:m,y:p,width:g,height:f,row:c,column:d,rowSizes:v,columnSizes:w};this._drawBackground(b,this._style.headerBackgroundColor),this._drawCells(b),this._drawHorizontalGridLines(b,this._style.headerHorizontalGridLineColor||this._style.headerGridLineColor),this._drawVerticalGridLines(b,this._style.headerVerticalGridLineColor||this._style.headerGridLineColor)}_drawBackground(e,t){if(!t)return;let{xMin:i,yMin:s,xMax:o,yMax:r}=e;this._canvasGC.fillStyle=t,this._canvasGC.fillRect(i,s,o-i+1,r-s+1)}_drawRowBackground(e,t){if(!t)return;let i=Math.max(e.xMin,e.x),s=Math.min(e.x+e.width-1,e.xMax);for(let o=e.y,r=0,n=e.rowSizes.length;r<n;++r){let n=e.rowSizes[r];if(0===n)continue;let a=t(e.row+r);if(a){let t=Math.max(e.yMin,o),r=Math.min(o+n-1,e.yMax);this._canvasGC.fillStyle=a,this._canvasGC.fillRect(i,t,s-i+1,r-t+1)}o+=n}}_drawColumnBackground(e,t){if(!t)return;let i=Math.max(e.yMin,e.y),s=Math.min(e.y+e.height-1,e.yMax);for(let o=e.x,r=0,n=e.columnSizes.length;r<n;++r){let n=e.columnSizes[r];if(0===n)continue;let a=t(e.column+r);if(a){let t=Math.max(e.xMin,o),r=Math.min(o+n-1,e.xMax);this._canvasGC.fillStyle=a,this._canvasGC.fillRect(t,i,r-t+1,s-i+1)}o+=n}}_getColumnSize(e,t){return"corner-header"===e?this._rowHeaderSections.sizeOf(t):this.columnSize(e,t)}_getRowSize(e,t){return"corner-header"===e?this._columnHeaderSections.sizeOf(t):this.rowSize(e,t)}_drawCells(e){if(!this._dataModel)return;let t=U.getCellGroupsAtColumn(this._dataModel,e.region,e.column),i=U.getCellGroupsAtRow(this._dataModel,e.region,e.row);e=oe.JSONExt.deepCopy(e);const s=U.joinCellGroupWithMergedCellGroups(this.dataModel,{r1:e.row,r2:e.row+e.rowSizes.length-1,c1:e.column,c2:e.column+e.columnSizes.length-1},e.region);for(let t=s.r1;t<e.row;t++){const i=this._getRowSize(e.region,t);e.y-=i,e.rowSizes=[i].concat(e.rowSizes)}e.row=s.r1;for(let t=s.c1;t<e.column;t++){const i=this._getColumnSize(e.region,t);e.x-=i,e.columnSizes=[i].concat(e.columnSizes)}e.column=s.c1;let o={x:0,y:0,width:0,height:0,region:e.region,row:0,column:0,value:null,metadata:He.emptyMetadata},r=-1;this._bufferGC.save();let n=new Oe(this._bufferGC),a=0;for(let s=e.x,l=0,h=e.columnSizes.length;l<h;++l){let h=0,c=0,d=e.columnSizes[l];if(0===d)continue;h=d;let u=e.column+l;o.x=s,o.width=d,o.column=u;for(let h=e.y,_=0,m=e.rowSizes.length;_<m;++_){if(a=e.rowSizes[_],0===a)continue;let m,p,g=e.row+_;if(r=U.getGroupIndex(this.dataModel,o.region,g,u),c=a,-1!==r){const e=this.dataModel.group(o.region,r);if(e.r1!==g||e.c1!==u){h+=c;continue}d=0;for(let t=e.c1;t<=e.c2;t++)d+=this._getColumnSize(o.region,t);a=0;for(let t=e.r1;t<=e.r2;t++)a+=this._getRowSize(o.region,t)}else"column-header"==e.region&&(d=e.columnSizes[l]);n.clearRect(s,h,d,a),n.save();try{m=this._dataModel.data(e.region,g,u)}catch(e){m=void 0,console.error(e)}try{p=this._dataModel.metadata(e.region,g,u)}catch(e){p=He.emptyMetadata,console.error(e)}o.y=h,o.height=a,o.width=d,o.row=g,o.value=m,o.metadata=p;let f=this._cellRenderers.get(o);n.save();try{f.paint(n,o)}catch(e){console.error(e)}n.restore();let v=Math.max(e.xMin,o.x),w=Math.min(o.x+o.width-1,e.xMax),b=Math.max(e.yMin,o.y),y=Math.min(o.y+o.height-1,e.yMax);0!==t.length||0!==i.length?w>v&&y>b&&this._blitContent(this._buffer,v,b,w-v+1,y-b+1,v,b):this._blitContent(this._buffer,v,b,w-v+1,y-b+1,v,b),h+=c}n.restore(),s+=h}n.dispose(),this._bufferGC.restore()}_drawHorizontalGridLines(e,t){if(!t)return;let i=Math.max(e.xMin,e.x);this._canvasGC.beginPath(),this._canvasGC.lineWidth=1;let s=this.bodyHeight,o=this.pageHeight,r=e.rowSizes.length;this._stretchLastRow&&o>s&&e.row+r===this._rowSections.count&&(r-=1);for(let t=e.y,s=0;s<r;++s){let o=e.rowSizes[s];if(0===o)continue;let r=0,n=!1,a=[],l=i;for(let t=e.column;t<e.column+e.columnSizes.length;t++){const i=t-e.column,o=[e.row+s,t],h=[e.row+s+1,t];U.areCellsMerged(this.dataModel,e.region,o,h)?(n&&a.push([r,l]),n=!1):n||(n=!0,r=l),l+=e.columnSizes[i],t===e.column&&(l-=e.xMin-e.x)}n&&a.push([r,e.xMax+1]);let h=t+o-1;if(h>=e.yMin&&h<=e.yMax)if(Te.shouldPaintEverything(this._dataModel))for(const e of a){const[t,i]=e;this._canvasGC.moveTo(t,h+.5),this._canvasGC.lineTo(i,h+.5)}else{const t=Math.min(e.x+e.width,e.xMax+1);this._canvasGC.moveTo(i,h+.5),this._canvasGC.lineTo(t,h+.5)}t+=o}this._canvasGC.strokeStyle=t,this._canvasGC.stroke()}_drawVerticalGridLines(e,t){if(!t)return;let i=Math.max(e.yMin,e.y);this._canvasGC.beginPath(),this._canvasGC.lineWidth=1;let s=this.bodyWidth,o=this.pageWidth,r=e.columnSizes.length;this._stretchLastColumn&&o>s&&e.column+r===this._columnSections.count&&(r-=1);for(let t=e.x,s=0;s<r;++s){let o=e.columnSizes[s];if(0===o)continue;let r=0,n=!1,a=[],l=i;for(let t=e.row;t<e.row+e.rowSizes.length;t++){const i=t-e.row,o=[t,e.column+s],h=[t,e.column+s+1];U.areCellsMerged(this.dataModel,e.region,o,h)?(n&&a.push([r,l]),n=!1):n||(n=!0,r=l),l+=e.rowSizes[i],t===e.row&&(l-=e.yMin-e.y)}n&&a.push([r,e.yMax+1]);let h=t+o-1;if(h>=e.xMin&&h<=e.xMax)if(Te.shouldPaintEverything(this._dataModel))for(const e of a)this._canvasGC.moveTo(h+.5,e[0]),this._canvasGC.lineTo(h+.5,e[1]);else{let t=Math.min(e.y+e.height,e.yMax+1);this._canvasGC.moveTo(h+.5,i),this._canvasGC.lineTo(h+.5,t)}t+=o}this._canvasGC.strokeStyle=t,this._canvasGC.stroke()}_drawBodySelections(){let e=this._selectionModel;if(!e||e.isEmpty)return;let t=this._style.selectionFillColor,i=this._style.selectionBorderColor;if(!t&&!i)return;let s=this._scrollX,o=this._scrollY,r=this._rowSections.indexOf(o),n=this._columnSections.indexOf(s);if(r<0||n<0)return;let a=this.bodyWidth,l=this.bodyHeight,h=this.pageWidth,c=this.pageHeight,d=this.headerWidth,u=this.headerHeight,_=this._rowSections.indexOf(o+c),m=this._columnSections.indexOf(s+h),p=this._rowSections.count-1,g=this._columnSections.count-1;_=_<0?p:_,m=m<0?g:m;let f=this._overlayGC;f.save(),f.beginPath(),f.rect(d,u,h,c),f.clip(),t&&(f.fillStyle=t),i&&(f.strokeStyle=i,f.lineWidth=1);for(let v of e.selections()){if(v.r1<r&&v.r2<r)continue;if(v.r1>_&&v.r2>_)continue;if(v.c1<n&&v.c2<n)continue;if(v.c1>m&&v.c2>m)continue;let e,w=Math.max(0,Math.min(v.r1,p)),b=Math.max(0,Math.min(v.c1,g)),y=Math.max(0,Math.min(v.r2,p)),S=Math.max(0,Math.min(v.c2,g));w>y&&(e=w,w=y,y=e),b>S&&(e=b,b=S,S=e);const C=U.joinCellGroupWithMergedCellGroups(this.dataModel,{r1:w,r2:y,c1:b,c2:S},"body");w=C.r1,y=C.r2,b=C.c1,S=C.c2;let x=this._columnSections.offsetOf(b)-s+d,M=this._rowSections.offsetOf(w)-o+u,k=this._columnSections.extentOf(S)-s+d,E=this._rowSections.extentOf(y)-o+u;this._stretchLastColumn&&h>a&&S===g&&(k=d+h-1),this._stretchLastRow&&c>l&&y===p&&(E=u+c-1),x=Math.max(d-1,x),M=Math.max(u-1,M),k=Math.min(d+h+1,k),E=Math.min(u+c+1,E),k<x||E<M||(t&&f.fillRect(x,M,k-x+1,E-M+1),i&&f.strokeRect(x-.5,M-.5,k-x+1,E-M+1))}f.restore()}_drawRowHeaderSelections(){let e=this._selectionModel;if(!e||e.isEmpty||"column"==e.selectionMode)return;if(0===this.headerWidth||0===this.pageHeight)return;let t=this._style.headerSelectionFillColor,i=this._style.headerSelectionBorderColor;if(!t&&!i)return;let s=this._scrollY,o=this.bodyHeight,r=this.pageHeight,n=this.headerWidth,a=this.headerHeight,l=this._rowSections,h=this._overlayGC;h.save(),h.beginPath(),h.rect(0,a,n,r),h.clip(),t&&(h.fillStyle=t),i&&(h.strokeStyle=i,h.lineWidth=1);let c=l.count-1,d=l.indexOf(s),u=l.indexOf(s+r-1);u=u<0?c:u;for(let _=d;_<=u;++_){if(!e.isRowSelected(_))continue;let d=l.offsetOf(_)-s+a,u=l.sizeOf(_);this._stretchLastRow&&r>o&&_===c&&(u=a+r-d),0!==u&&(t&&h.fillRect(0,d,n,u),i&&(h.beginPath(),h.moveTo(n-.5,d-1),h.lineTo(n-.5,d+u),h.stroke()))}h.restore()}_drawColumnHeaderSelections(){let e=this._selectionModel;if(!e||e.isEmpty||"row"==e.selectionMode)return;if(0===this.headerHeight||0===this.pageWidth)return;let t=this._style.headerSelectionFillColor,i=this._style.headerSelectionBorderColor;if(!t&&!i)return;let s=this._scrollX,o=this.bodyWidth,r=this.pageWidth,n=this.headerWidth,a=this.headerHeight,l=this._columnSections,h=this._overlayGC;h.save(),h.beginPath(),h.rect(n,0,r,a),h.clip(),t&&(h.fillStyle=t),i&&(h.strokeStyle=i,h.lineWidth=1);let c=l.count-1,d=l.indexOf(s),u=l.indexOf(s+r-1);u=u<0?c:u;for(let _=d;_<=u;++_){if(!e.isColumnSelected(_))continue;let d=l.offsetOf(_)-s+n,u=l.sizeOf(_);this._stretchLastColumn&&r>o&&_===c&&(u=n+r-d),0!==u&&(t&&h.fillRect(d,0,u,a),i&&(h.beginPath(),h.moveTo(d-1,a-.5),h.lineTo(d+u,a-.5),h.stroke()))}h.restore()}_drawCursor(){let e=this._selectionModel;if(!e||e.isEmpty||"cell"!==e.selectionMode)return;let t=this._style.cursorFillColor,i=this._style.cursorBorderColor;if(!t&&!i)return;let s=e.cursorRow,o=e.cursorColumn,r=this._rowSections.count-1,n=this._columnSections.count-1;if(s<0||s>r)return;if(o<0||o>n)return;let a=s,l=o;const h=U.joinCellGroupWithMergedCellGroups(this.dataModel,{r1:s,r2:a,c1:o,c2:l},"body");s=h.r1,a=h.r2,o=h.c1,l=h.c2;let c=this._scrollX,d=this._scrollY,u=this.bodyWidth,_=this.bodyHeight,m=this.pageWidth,p=this.pageHeight,g=this.headerWidth,f=this.headerHeight,v=this._viewportWidth,w=this._viewportHeight,b=this._columnSections.offsetOf(o)-c+g,y=this._columnSections.extentOf(l)-c+g,S=this._rowSections.offsetOf(s)-d+f,C=this._rowSections.extentOf(a)-d+f;if(this._stretchLastColumn&&m>u&&o===n&&(y=v-1),this._stretchLastRow&&p>_&&s===r&&(C=w-1),y<b||C<S)return;if(b-1>=v||S-1>=w||y+1<g||C+1<f)return;let x=this._overlayGC;x.save(),x.beginPath(),x.rect(g,f,m,p),x.clip(),x.clearRect(b,S,y-b+1,C-S+1),t&&(x.fillStyle=t,x.fillRect(b,S,y-b+1,C-S+1)),i&&(x.strokeStyle=i,x.lineWidth=2,x.strokeRect(b,S,y-b,C-S)),x.restore()}_drawShadows(){let e=this._style.scrollShadow;if(!e)return;let t=this._scrollX,i=this._scrollY,s=this.maxScrollX,o=this.maxScrollY,r=this.headerWidth,n=this.headerHeight,a=this.pageWidth,l=this.pageHeight,h=this._viewportWidth,c=this._viewportHeight,d=this.bodyWidth,u=this.bodyHeight;this._stretchLastRow&&l>u&&(u=l),this._stretchLastColumn&&a>d&&(d=a);let _=this._overlayGC;if(_.save(),i>0){let i=0,s=n,o=0,l=s+e.size,h=_.createLinearGradient(i,s,o,l);h.addColorStop(0,e.color1),h.addColorStop(.5,e.color2),h.addColorStop(1,e.color3);let c=0,u=n,m=r+Math.min(a,d-t),p=e.size;_.fillStyle=h,_.fillRect(c,u,m,p)}if(t>0){let t=r,s=0,o=t+e.size,a=0,h=_.createLinearGradient(t,s,o,a);h.addColorStop(0,e.color1),h.addColorStop(.5,e.color2),h.addColorStop(1,e.color3);let c=r,d=0,m=e.size,p=n+Math.min(l,u-i);_.fillStyle=h,_.fillRect(c,d,m,p)}if(i<o){let i=0,s=c,o=0,n=c-e.size,l=_.createLinearGradient(i,s,o,n);l.addColorStop(0,e.color1),l.addColorStop(.5,e.color2),l.addColorStop(1,e.color3);let h=0,u=c-e.size,m=r+Math.min(a,d-t),p=e.size;_.fillStyle=l,_.fillRect(h,u,m,p)}if(t<s){let t=h,s=0,o=h-e.size,r=0,a=_.createLinearGradient(t,s,o,r);a.addColorStop(0,e.color1),a.addColorStop(.5,e.color2),a.addColorStop(1,e.color3);let c=h-e.size,d=0,m=e.size,p=n+Math.min(l,u-i);_.fillStyle=a,_.fillRect(c,d,m,p)}_.restore()}}!function(e){function t(e){return null===e.value||void 0===e.value?"":String(e.value)}e.copyFormatGeneric=t,e.defaultStyle={voidColor:"#F3F3F3",backgroundColor:"#FFFFFF",gridLineColor:"rgba(20, 20, 20, 0.15)",headerBackgroundColor:"#F3F3F3",headerGridLineColor:"rgba(20, 20, 20, 0.25)",selectionFillColor:"rgba(49, 119, 229, 0.2)",selectionBorderColor:"rgba(0, 107, 247, 1.0)",cursorBorderColor:"rgba(0, 107, 247, 1.0)",headerSelectionFillColor:"rgba(20, 20, 20, 0.1)",headerSelectionBorderColor:"rgba(0, 107, 247, 1.0)",scrollShadow:{size:10,color1:"rgba(0, 0, 0, 0.20)",color2:"rgba(0, 0, 0, 0.05)",color3:"rgba(0, 0, 0, 0.00)"}},e.defaultSizes={rowHeight:20,columnWidth:64,rowHeaderWidth:64,columnHeaderHeight:20},e.minimumSizes={rowHeight:20,columnWidth:10,rowHeaderWidth:10,columnHeaderHeight:20},e.defaultCopyConfig={separator:"\t",format:t,headers:"none",warningThreshold:1e6}}(Ve||(Ve={})),function(e){e.ScrollRequest=new se.ConflatableMessage("scroll-request"),e.OverlayPaintRequest=new se.ConflatableMessage("overlay-paint-request"),e.createCanvas=function(){let e=document.createElement("canvas");return e.width=0,e.height=0,e},e.shouldPaintEverything=function(e){const t=U.getCellGroupsAtRegion(e,"column-header"),i=U.getCellGroupsAtRegion(e,"row-header"),s=U.getCellGroupsAtRegion(e,"corner-header"),o=U.getCellGroupsAtRegion(e,"body");return t.length>0||i.length>0||s.length>0||o.length>0},e.regionHasMergedCells=function(e,t){return U.getCellGroupsAtRegion(e,t).length>0};class t extends se.ConflatableMessage{constructor(e,t,i,s,o){super("paint-request"),this._region=e,this._r1=t,this._c1=i,this._r2=s,this._c2=o}get region(){return this._region}get r1(){return this._r1}get c1(){return this._c1}get r2(){return this._r2}get c2(){return this._c2}conflate(e){return"all"===this._region||("all"===e._region?(this._region="all",!0):this._region===e._region&&(this._r1=Math.min(this._r1,e._r1),this._c1=Math.min(this._c1,e._c1),this._r2=Math.max(this._r2,e._r2),this._c2=Math.max(this._c2,e._c2),!0))}}e.PaintRequest=t;class i extends se.ConflatableMessage{constructor(e,t,i){super("row-resize-request"),this._region=e,this._index=t,this._size=i}get region(){return this._region}get index(){return this._index}get size(){return this._size}conflate(e){return this._region===e._region&&this._index===e._index&&(this._size=e._size,!0)}}e.RowResizeRequest=i;class s extends se.ConflatableMessage{constructor(e,t,i){super("column-resize-request"),this._region=e,this._index=t,this._size=i}get region(){return this._region}get index(){return this._index}get size(){return this._size}conflate(e){return this._region===e._region&&this._index===e._index&&(this._size=e._size,!0)}}e.ColumnResizeRequest=s}(Te||(Te={})),function(e){e.splitFields=function(e){let t;t=void 0===e.primaryKey?[]:"string"==typeof e.primaryKey?[e.primaryKey]:e.primaryKey;let i=[],s=[];for(let o of e.fields)-1===t.indexOf(o.name)?i.push(o):s.push(o);return{bodyFields:i,headerFields:s}},e.createMissingMap=function(e){if(!e.missingValues||0===e.missingValues.length)return null;let t=Object.create(null);for(let i of e.missingValues)t[i]=!0;return t}}(Le||(Le={}));class Ae extends d.Panel{constructor(e){super();const{model:t,commands:i,themeManager:s,scopes:o,translator:r}=e;this._grid=new Pe({commands:i,model:t,themeManager:s,translator:r}),this._grid.addClass("jp-DebuggerVariables-grid"),this._model=t,this._model.changed.connect((e=>{this._update()}),this),this._grid.dataModel.setData(null!=o?o:[]),this.addWidget(this._grid),this.addClass("jp-DebuggerVariables-body")}set filter(e){this._grid.dataModel.filter=e,this._update()}set scope(e){this._grid.dataModel.scope=e,this._update()}_update(){var e;this._grid.dataModel.setData(null!==(e=this._model.scopes)&&void 0!==e?e:[])}}class Pe extends d.Panel{constructor(e){super();const{commands:t,model:i,themeManager:s}=e;this.model=i;const o=new Ge(e.translator),r=new Ve,n=new Be.MouseHandler;n.doubleClicked.connect(((e,i)=>t.execute(vt.CommandIDs.inspectVariable,{variableReference:o.getVariableReference(i.row),name:o.getVariableName(i.row)}))),n.selected.connect(((e,t)=>{const{row:i}=t;this.model.selectedVariable={name:o.getVariableName(i),value:o.data("body",i,1),type:o.data("body",i,2),variablesReference:o.getVariableReference(i)}})),r.dataModel=o,r.keyHandler=new re,r.mouseHandler=n,r.selectionModel=new de({dataModel:o}),r.stretchLastColumn=!0,r.node.style.height="100%",this._grid=r,s&&s.themeChanged.connect(this._updateStyles,this),this.addWidget(r)}set filter(e){this._grid.dataModel.filter=e,this.update()}set scope(e){this._grid.dataModel.scope=e,this.update()}get dataModel(){return this._grid.dataModel}onAfterAttach(e){super.onAfterAttach(e),this._updateStyles()}_updateStyles(){const{style:e,textRenderer:t}=Be.computeStyle();this._grid.cellRenderers.update({},t),this._grid.style=e}}class Ge extends He{constructor(e){super(),this._filter=new Set,this._scope="",this._data={name:[],type:[],value:[],variablesReference:[]},e=e||v.nullTranslator,this._trans=e.load("jupyterlab")}set filter(e){this._filter=e}get scope(){return this._scope}set scope(e){this._scope=e}rowCount(e){return"body"===e?this._data.name.length:1}columnCount(e){return"body"===e?2:1}data(e,t,i){return"row-header"===e?this._data.name[t]:"column-header"===e?1===i?this._trans.__("Value"):this._trans.__("Type"):"corner-header"===e?this._trans.__("Name"):1===i?this._data.value[t]:this._data.type[t]}getVariableReference(e){return this._data.variablesReference[e]}getVariableName(e){return this._data.name[e]}setData(e){var t,i;this._clearData(),this.emitChanged({type:"model-reset",region:"body"});const s=null!==(t=e.find((e=>e.name===this._scope)))&&void 0!==t?t:e[0],o=(null!==(i=null==s?void 0:s.variables)&&void 0!==i?i:[]).filter((e=>e.name&&!this._filter.has(e.name)));o.forEach(((e,t)=>{var i;this._data.name[t]=e.name,this._data.type[t]=null!==(i=e.type)&&void 0!==i?i:"",this._data.value[t]=e.value,this._data.variablesReference[t]=e.variablesReference})),this.emitChanged({type:"rows-inserted",region:"body",index:1,span:o.length})}_clearData(){this._data={name:[],type:[],value:[],variablesReference:[]}}}!function(e){e.computeStyle=function(){const e=function(){const e=document.createElement("div");return e.className="jp-DebuggerVariables-colorPalette",e.innerHTML='\n      <div class="jp-mod-void"></div>\n      <div class="jp-mod-background"></div>\n      <div class="jp-mod-header-background"></div>\n      <div class="jp-mod-grid-line"></div>\n      <div class="jp-mod-header-grid-line"></div>\n      <div class="jp-mod-selection"></div>\n      <div class="jp-mod-text"></div>\n    ',e}();let t;document.body.appendChild(e),t=e.querySelector(".jp-mod-void");const i=getComputedStyle(t).color;t=e.querySelector(".jp-mod-background");const s=getComputedStyle(t).color;t=e.querySelector(".jp-mod-header-background");const o=getComputedStyle(t).color;t=e.querySelector(".jp-mod-grid-line");const r=getComputedStyle(t).color;t=e.querySelector(".jp-mod-header-grid-line");const n=getComputedStyle(t).color;t=e.querySelector(".jp-mod-selection");const a=getComputedStyle(t).color;t=e.querySelector(".jp-mod-text");const l=getComputedStyle(t).color;return document.body.removeChild(e),{style:{voidColor:i,backgroundColor:s,headerBackgroundColor:o,gridLineColor:r,headerGridLineColor:n,rowBackgroundColor:e=>e%2==0?i:s,selectionFillColor:a},textRenderer:new ae({font:"12px sans-serif",textColor:l,backgroundColor:"",verticalAlignment:"center",horizontalAlignment:"left"})}},e.MouseHandler=class extends he{constructor(){super(...arguments),this._doubleClicked=new b.Signal(this),this._selected=new b.Signal(this)}get doubleClicked(){return this._doubleClicked}get selected(){return this._selected}dispose(){this.isDisposed||(b.Signal.disconnectSender(this),super.dispose())}onMouseDoubleClick(e,t){const i=e.hitTest(t.clientX,t.clientY);this._doubleClicked.emit(i)}onMouseDown(e,t){let{clientX:i,clientY:s}=t,o=e.hitTest(i,s);this._selected.emit(o),super.onMouseDown(e,t)}onContextMenu(e,t){let{clientX:i,clientY:s}=t,o=e.hitTest(i,s);this._selected.emit(o)}}}(Be||(Be={}));var Ne=i(1900);class je extends h.MainAreaWidget{constructor(e){const{dataLoader:t,rendermime:i,translator:s}=e,o=new d.Panel,r=new oe.PromiseDelegate;super({content:o,reveal:Promise.all([t,r.promise])}),this.content.addClass("jp-VariableRendererPanel"),this.trans=(null!=s?s:v.nullTranslator).load("jupyterlab"),this.dataLoader=t,this.renderMime=i,this._dataHash=null,this.refresh().then((()=>{r.resolve()})).catch((e=>r.reject(e)))}async refresh(e=!1){let t=await this.dataLoader();if(0===Object.keys(t.data).length&&(t={data:{"text/plain":this.trans.__("The variable is undefined in the active context.")},metadata:{}}),!t.data)return this._dataHash=null,Promise.reject("Unable to get a view on the variable.");{const i=n(JSON.stringify(t),17);if(e||this._dataHash!==i){this.content.layout&&this.content.widgets.forEach((e=>{this.content.layout.removeWidget(e)}));const e=this.renderMime.preferredMimeType(t.data,"any");if(!e)return this._dataHash=null,Promise.reject("Unable to determine the preferred mime type.");{const s=this.renderMime.createRenderer(e);s.addClass("jp-VariableRendererPanel-renderer");const o=new Ne.MimeModel({...t,trusted:!0});this._dataHash=i,await s.renderModel(o),this.content.addWidget(s)}}}}}class Fe{constructor(e){var t,i;this._eventMessage=new b.Signal(this),this._isDisposed=!1,this._sessionChanged=new b.Signal(this),this._config=e.config,this._session=null,this._specsManager=null!==(t=e.specsManager)&&void 0!==t?t:null,this._model=new vt.Model,this._debuggerSources=null!==(i=e.debuggerSources)&&void 0!==i?i:null,this._trans=(e.translator||v.nullTranslator).load("jupyterlab")}get eventMessage(){return this._eventMessage}get isDisposed(){return this._isDisposed}get isStarted(){var e,t;return null!==(t=null===(e=this._session)||void 0===e?void 0:e.isStarted)&&void 0!==t&&t}get isPausingOnExceptions(){var e,t,i,s,o,r;const n=null!==(s=null===(i=null===(t=null===(e=this.session)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.kernel)||void 0===i?void 0:i.name)&&void 0!==s?s:"";if(n){const e=this._config.getTmpFileParams(n);if(e)return null!==(r=null===(o=this._session)||void 0===o?void 0:o.pausingOnExceptions.includes(e.prefix))&&void 0!==r&&r}return!1}get model(){return this._model}get session(){return this._session}set session(e){var t;this._session!==e&&(this._session&&this._session.dispose(),this._session=e,null===(t=this._session)||void 0===t||t.eventMessage.connect(((e,t)=>{"stopped"===t.event?(this._model.stoppedThreads.add(t.body.threadId),this._getAllFrames()):"continued"===t.event&&(this._model.stoppedThreads.delete(t.body.threadId),this._clearModel(),this._clearSignals()),this._eventMessage.emit(t)})),this._sessionChanged.emit(e))}get sessionChanged(){return this._sessionChanged}dispose(){this.isDisposed||(this._isDisposed=!0,b.Signal.clearData(this))}getCodeId(e){var t,i,s,o;try{return this._config.getCodeId(e,null!==(o=null===(s=null===(i=null===(t=this.session)||void 0===t?void 0:t.connection)||void 0===i?void 0:i.kernel)||void 0===s?void 0:s.name)&&void 0!==o?o:"")}catch(e){return""}}hasStoppedThreads(){var e,t;return null!==(t=(null===(e=this._model)||void 0===e?void 0:e.stoppedThreads.size)>0)&&void 0!==t&&t}async isAvailable(e){var t,i,s,o;if(!this._specsManager)return!0;await this._specsManager.ready;const r=null==e?void 0:e.kernel;if(!r)return!1;const n=r.name;return!(null===(t=this._specsManager.specs)||void 0===t?void 0:t.kernelspecs[n])||!(null===(o=null===(s=null===(i=this._specsManager.specs.kernelspecs[n])||void 0===i?void 0:i.metadata)||void 0===s?void 0:s.debugger)||void 0===o||!o)}async clearBreakpoints(){var e;if(!0!==(null===(e=this.session)||void 0===e?void 0:e.isStarted))return;this._model.breakpoints.breakpoints.forEach(((e,t,i)=>{this._setBreakpoints([],t)}));let t=new Map;this._model.breakpoints.restoreBreakpoints(t)}async continue(){try{if(!this.session)throw new Error("No active debugger session");await this.session.sendRequest("continue",{threadId:this._currentThread()}),this._model.stoppedThreads.delete(this._currentThread()),this._clearModel(),this._clearSignals()}catch(e){console.error("Error:",e.message)}}async getSource(e){var t,i;if(!this.session)throw new Error("No active debugger session");return{...(await this.session.sendRequest("source",{source:e,sourceReference:null!==(t=e.sourceReference)&&void 0!==t?t:0})).body,path:null!==(i=e.path)&&void 0!==i?i:""}}async evaluate(e){var t;if(!this.session)throw new Error("No active debugger session");const i=null===(t=this.model.callstack.frame)||void 0===t?void 0:t.id,s=await this.session.sendRequest("evaluate",{context:"repl",expression:e,frameId:i});return s.success?(this._clearModel(),await this._getAllFrames(),s.body):null}async next(){try{if(!this.session)throw new Error("No active debugger session");await this.session.sendRequest("next",{threadId:this._currentThread()})}catch(e){console.error("Error:",e.message)}}async inspectRichVariable(e,t){if(!this.session)throw new Error("No active debugger session");const i=await this.session.sendRequest("richInspectVariables",{variableName:e,frameId:t});if(i.success)return i.body;throw new Error(i.message)}async inspectVariable(e){if(!this.session)throw new Error("No active debugger session");const t=await this.session.sendRequest("variables",{variablesReference:e});if(t.success)return t.body.variables;throw new Error(t.message)}async displayDefinedVariables(){if(!this.session)throw new Error("No active debugger session");const e=(await this.session.sendRequest("inspectVariables",{})).body.variables,t=[{name:this._trans.__("Globals"),variables:e}];this._model.variables.scopes=t}async displayModules(){if(!this.session)throw new Error("No active debugger session");const e=await this.session.sendRequest("modules",{});this._model.kernelSources.kernelSources=e.body.modules.map((e=>({name:e.name,path:e.path})))}async restart(){const{breakpoints:e}=this._model.breakpoints;await this.stop(),await this.start(),await this._restoreBreakpoints(e)}async restoreState(e){var t,i,s,o,r,n,a,l,h,c;if(!this.model||!this.session)return;const d=await this.session.restoreState(),{body:u}=d,_=this._mapBreakpoints(u.breakpoints),m=new Set(u.stoppedThreads);if(this._model.hasRichVariableRendering=!0===u.richRendering,this._config.setHashParams({kernel:null!==(o=null===(s=null===(i=null===(t=this.session)||void 0===t?void 0:t.connection)||void 0===i?void 0:i.kernel)||void 0===s?void 0:s.name)&&void 0!==o?o:"",method:u.hashMethod,seed:u.hashSeed}),this._config.setTmpFileParams({kernel:null!==(l=null===(a=null===(n=null===(r=this.session)||void 0===r?void 0:r.connection)||void 0===n?void 0:n.kernel)||void 0===a?void 0:a.name)&&void 0!==l?l:"",prefix:u.tmpFilePrefix,suffix:u.tmpFileSuffix}),this._model.stoppedThreads=m,this.isStarted||!e&&0===m.size||await this.start(),(this.isStarted||e)&&(this._model.title=this.isStarted&&(null===(c=null===(h=this.session)||void 0===h?void 0:h.connection)||void 0===c?void 0:c.name)||"-"),this._debuggerSources){const e=this._filterBreakpoints(_);this._model.breakpoints.restoreBreakpoints(e)}else this._model.breakpoints.restoreBreakpoints(_);0!==m.size?await this._getAllFrames():this.isStarted&&(this._clearModel(),this._clearSignals())}start(){if(!this.session)throw new Error("No active debugger session");return this.session.start()}async stepIn(){try{if(!this.session)throw new Error("No active debugger session");await this.session.sendRequest("stepIn",{threadId:this._currentThread()})}catch(e){console.error("Error:",e.message)}}async stepOut(){try{if(!this.session)throw new Error("No active debugger session");await this.session.sendRequest("stepOut",{threadId:this._currentThread()})}catch(e){console.error("Error:",e.message)}}async stop(){if(!this.session)throw new Error("No active debugger session");await this.session.stop(),this._model&&this._model.clear()}async updateBreakpoints(e,t,i){var s;if(!(null===(s=this.session)||void 0===s?void 0:s.isStarted))return;i||(i=(await this._dumpCell(e)).body.sourcePath);const o=await this.session.restoreState(),r=t.filter((({line:e})=>"number"==typeof e)).map((({line:e})=>({line:e}))),n=this._mapBreakpoints(o.body.breakpoints);if(this._debuggerSources){const e=this._filterBreakpoints(n);this._model.breakpoints.restoreBreakpoints(e)}else this._model.breakpoints.restoreBreakpoints(n);let a=new Set;const l=(await this._setBreakpoints(r,i)).body.breakpoints.filter(((e,t,i)=>{const s=i.findIndex((t=>t.line===e.line))>-1,o=!a.has(e.line);return a.add(e.line),s&&o}));this._model.breakpoints.setBreakpoints(i,l),await this.session.sendRequest("configurationDone",{})}pauseOnExceptionsIsValid(){var e;return!(!this.isStarted||!(null===(e=this.session)||void 0===e?void 0:e.exceptionBreakpointFilters))}async pauseOnExceptions(e){var t,i,s,o,r;if(!(null===(t=this.session)||void 0===t?void 0:t.isStarted))return;const n=null!==(r=null===(o=null===(s=null===(i=this.session)||void 0===i?void 0:i.connection)||void 0===s?void 0:s.kernel)||void 0===o?void 0:o.name)&&void 0!==r?r:"";if(!n)return;const a=this._config.getTmpFileParams(n);if(!a)return;let l=a.prefix;const h=this.session.exceptionBreakpointFilters;let c=this.session.pausingOnExceptions;if(e)this.session.pausingOnExceptions.includes(l)||(c.push(l),this.session.pausingOnExceptions=c);else{let e=this.session.pausingOnExceptions.indexOf(l);e>-1&&(this.session.pausingOnExceptions=c.splice(e,1),this.session.pausingOnExceptions=c)}const d=[],u=[],_=e?"userUnhandled":"never";for(let e of null!=h?h:[])d.push(e.filter),u.push({path:[{names:this.session.exceptionPaths}],breakMode:_});const m={filters:d,exceptionOptions:u};await this.session.sendRequest("setExceptionBreakpoints",m)}getDebuggerState(){var e,t,i,s,o,r,n;const a=this._model.breakpoints.breakpoints;let l=[];if(this._debuggerSources)for(const h of a.keys()){const a=this._debuggerSources.find({focus:!1,kernel:null!==(s=null===(i=null===(t=null===(e=this.session)||void 0===e?void 0:e.connection)||void 0===t?void 0:t.kernel)||void 0===i?void 0:i.name)&&void 0!==s?s:"",path:null!==(n=null===(r=null===(o=this._session)||void 0===o?void 0:o.connection)||void 0===r?void 0:r.path)&&void 0!==n?n:"",source:h}).map((e=>e.src.getSource()));l=l.concat(a)}return{cells:l,breakpoints:a}}async restoreDebuggerState(e){var t,i,s,o;await this.start();for(const t of e.cells)await this._dumpCell(t);const r=new Map,n=null!==(o=null===(s=null===(i=null===(t=this.session)||void 0===t?void 0:t.connection)||void 0===i?void 0:i.kernel)||void 0===s?void 0:s.name)&&void 0!==o?o:"",{prefix:a,suffix:l}=this._config.getTmpFileParams(n);for(const t of e.breakpoints){const[e,i]=t,s=e.substr(0,e.length-l.length),o=s.substr(s.lastIndexOf("/")+1),n=a.concat(o).concat(l);r.set(n,i)}await this._restoreBreakpoints(r);const h=await this.session.sendRequest("configurationDone",{});return await this.restoreState(!1),h.success}_clearModel(){this._model.callstack.frames=[],this._model.variables.scopes=[]}_clearSignals(){this._model.callstack.currentFrameChanged.disconnect(this._onCurrentFrameChanged,this),this._model.variables.variableExpanded.disconnect(this._onVariableExpanded,this)}_convertScopes(e,t){return t&&e?e.map(((e,i)=>({name:e.name,variables:t[i].map((e=>({...e})))}))):[]}_currentThread(){return 1}async _dumpCell(e){if(!this.session)throw new Error("No active debugger session");return this.session.sendRequest("dumpCell",{code:e})}_filterBreakpoints(e){if(!this._debuggerSources)return e;let t=new Map;for(const i of e){const[e,s]=i;s.forEach((()=>{var i,o,r,n,a,l,h;this._debuggerSources.find({focus:!1,kernel:null!==(n=null===(r=null===(o=null===(i=this.session)||void 0===i?void 0:i.connection)||void 0===o?void 0:o.kernel)||void 0===r?void 0:r.name)&&void 0!==n?n:"",path:null!==(h=null===(l=null===(a=this._session)||void 0===a?void 0:a.connection)||void 0===l?void 0:l.path)&&void 0!==h?h:"",source:e}).forEach((()=>{s.length>0&&t.set(e,s)}))}))}return t}async _getAllFrames(){this._model.callstack.currentFrameChanged.connect(this._onCurrentFrameChanged,this),this._model.variables.variableExpanded.connect(this._onVariableExpanded,this);const e=await this._getFrames(this._currentThread());this._model.callstack.frames=e}async _getFrames(e){if(!this.session)throw new Error("No active debugger session");return(await this.session.sendRequest("stackTrace",{threadId:e})).body.stackFrames}async _getScopes(e){if(!this.session)throw new Error("No active debugger session");return e?(await this.session.sendRequest("scopes",{frameId:e.id})).body.scopes:[]}async _getVariables(e){if(!this.session)throw new Error("No active debugger session");return e?(await this.session.sendRequest("variables",{variablesReference:e.variablesReference})).body.variables:[]}_mapBreakpoints(e){return e.length?e.reduce(((e,t)=>{const{breakpoints:i,source:s}=t;return e.set(s,i.map((e=>({...e,source:{path:s},verified:!0})))),e}),new Map):new Map}async _onCurrentFrameChanged(e,t){if(!t)return;const i=await this._getScopes(t),s=await Promise.all(i.map((e=>this._getVariables(e)))),o=this._convertScopes(i,s);this._model.variables.scopes=o}async _onVariableExpanded(e,t){if(!this.session)throw new Error("No active debugger session");const i=await this.session.sendRequest("variables",{variablesReference:t.variablesReference});let s={...t,expanded:!0};i.body.variables.forEach((e=>{s={[e.name]:e,...s}}));const o=this._model.variables.scopes.map((e=>{const i=e.variables.findIndex((e=>e.variablesReference===t.variablesReference));return e.variables[i]=s,{...e}}));return this._model.variables.scopes=[...o],i.body.variables}async _setBreakpoints(e,t){if(!this.session)throw new Error("No active debugger session");return await this.session.sendRequest("setBreakpoints",{breakpoints:e,source:{path:t},sourceModified:!1})}async _restoreBreakpoints(e){for(const[t,i]of e)await this._setBreakpoints(i.filter((({line:e})=>"number"==typeof e)).map((({line:e})=>({line:e}))),t);this._model.breakpoints.restoreBreakpoints(e)}}class qe{constructor(e){this._seq=0,this._ready=new oe.PromiseDelegate,this._isDisposed=!1,this._isStarted=!1,this._pausingOnExceptions=[],this._exceptionPaths=[],this._exceptionBreakpointFilters=[],this._disposed=new b.Signal(this),this._eventMessage=new b.Signal(this),this.connection=e.connection,this.translator=e.translator||v.nullTranslator}get isDisposed(){return this._isDisposed}get capabilities(){return this._capabilities}get disposed(){return this._disposed}get connection(){return this._connection}set connection(e){var t,i;if(this._connection&&this._connection.iopubMessage.disconnect(this._handleEvent,this),this._connection=e,!this._connection)return void(this._isStarted=!1);this._connection.iopubMessage.connect(this._handleEvent,this),this._ready=new oe.PromiseDelegate;const s=null===(i=null===(t=this.connection)||void 0===t?void 0:t.kernel)||void 0===i?void 0:i.requestDebug({type:"request",seq:0,command:"debugInfo"});s&&(s.onReply=e=>{this._ready.resolve(),s.dispose()})}get isStarted(){return this._isStarted}get pausingOnExceptions(){return this._pausingOnExceptions}set pausingOnExceptions(e){this._pausingOnExceptions=e}get exceptionPaths(){return this._exceptionPaths}get exceptionBreakpointFilters(){return this._exceptionBreakpointFilters}get eventMessage(){return this._eventMessage}dispose(){this._isDisposed||(this._isDisposed=!0,this._disposed.emit(),b.Signal.clearData(this))}async start(){var e,t,i,s;const o=await this.sendRequest("initialize",{clientID:"jupyterlab",clientName:"JupyterLab",adapterID:null!==(i=null===(t=null===(e=this.connection)||void 0===e?void 0:e.kernel)||void 0===t?void 0:t.name)&&void 0!==i?i:"",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:document.documentElement.lang});if(!o.success)throw new Error(`Could not start the debugger: ${o.message}`);this._capabilities=o.body,this._isStarted=!0,this._exceptionBreakpointFilters=null===(s=o.body)||void 0===s?void 0:s.exceptionBreakpointFilters,await this.sendRequest("attach",{})}async stop(){await this.sendRequest("disconnect",{restart:!1,terminateDebuggee:!1}),this._isStarted=!1}async restoreState(){var e;const t=await this.sendRequest("debugInfo",{});return this._isStarted=t.body.isStarted,this._exceptionPaths=null===(e=t.body)||void 0===e?void 0:e.exceptionPaths,t}async sendRequest(e,t){return await this._ready.promise,(await this._sendDebugMessage({type:"request",seq:this._seq++,command:e,arguments:t})).content}_handleEvent(e,t){if("debug_event"!==t.header.msg_type)return;const i=t.content;this._eventMessage.emit(i)}async _sendDebugMessage(e){var t;const i=null===(t=this.connection)||void 0===t?void 0:t.kernel;if(!i)return Promise.reject(new Error("A kernel is required to send debug messages."));const s=new oe.PromiseDelegate,o=i.requestDebug(e);return o.onReply=e=>{s.resolve(e)},await o.done,s.promise}}var Ke=i(72245),Xe=i.n(Ke);class Ye extends s.ReactWidget{constructor(e){super(),this._model=e,this.addClass("jp-DebuggerBreakpoints-body")}render(){return Xe().createElement(Ue,{model:this._model})}}const Ue=({model:e})=>{const[t,i]=(0,Ke.useState)(Array.from(e.breakpoints.entries()));return(0,Ke.useEffect)((()=>{const t=(t,s)=>{i(Array.from(e.breakpoints.entries()))},s=t=>{i(Array.from(e.breakpoints.entries()))};return e.changed.connect(t),e.restored.connect(s),()=>{e.changed.disconnect(t),e.restored.disconnect(s)}})),Xe().createElement(Xe().Fragment,null,t.map((t=>Xe().createElement($e,{key:t[0],breakpoints:t[1],model:e}))))},$e=({breakpoints:e,model:t})=>Xe().createElement(Xe().Fragment,null,e.sort(((e,t)=>{var i,s;return(null!==(i=e.line)&&void 0!==i?i:0)-(null!==(s=t.line)&&void 0!==s?s:0)})).map(((e,i)=>{var s,o;return Xe().createElement(Ze,{key:(null!==(o=null===(s=e.source)||void 0===s?void 0:s.path)&&void 0!==o?o:"")+i,breakpoint:e,model:t})}))),Ze=({breakpoint:e,model:t})=>{var i,s,o,r;return Xe().createElement("div",{className:"jp-DebuggerBreakpoint",onClick:()=>t.clicked.emit(e),title:null===(i=e.source)||void 0===i?void 0:i.path},Xe().createElement("span",{className:"jp-DebuggerBreakpoint-marker"},"●"),Xe().createElement("span",{className:"jp-DebuggerBreakpoint-source jp-left-truncated"},"/"===(r=null!==(o=null===(s=e.source)||void 0===s?void 0:s.path)&&void 0!==o?o:"")[0]?r.slice(1)+"/":r),Xe().createElement("span",{className:"jp-DebuggerBreakpoint-line"},e.line))};class Je extends s.PanelWithToolbar{constructor(e){var t;super(e),this.clicked=new b.Signal(this);const{model:i,service:o,commands:r}=e,n=(null!==(t=e.translator)&&void 0!==t?t:v.nullTranslator).load("jupyterlab");this.title.label=n.__("Breakpoints");const a=new Ye(i);this.toolbar.addItem("pause",new s.CommandToolbarButton({commands:r.registry,id:r.pause,label:""})),this.toolbar.addItem("closeAll",new s.ToolbarButton({icon:D,onClick:async()=>{if(0!==i.breakpoints.size)return(await(0,h.showDialog)({title:n.__("Remove All Breakpoints"),body:n.__("Are you sure you want to remove all breakpoints?"),buttons:[h.Dialog.okButton({label:n.__("Remove breakpoints")}),h.Dialog.cancelButton()],hasClose:!0})).button.accept?o.clearBreakpoints():void 0},tooltip:n.__("Remove All Breakpoints")})),this.addWidget(a),this.addClass("jp-DebuggerBreakpoints")}}class Qe extends s.ReactWidget{constructor(e){super(),this._model=e,this.addClass("jp-DebuggerCallstack-body")}render(){return Xe().createElement(et,{model:this._model})}}const et=({model:e})=>{const[t,i]=(0,Ke.useState)(e.frames),[s,o]=(0,Ke.useState)(e.frame);return(0,Ke.useEffect)((()=>{const t=()=>{o(e.frame),i(e.frames)};return e.framesChanged.connect(t),()=>{e.framesChanged.disconnect(t)}}),[e]),Xe().createElement("ul",null,t.map((t=>{var i;return Xe().createElement("li",{key:t.id,onClick:()=>{return o(i=t),void(e.frame=i);var i},className:(null==s?void 0:s.id)===t.id?"selected jp-DebuggerCallstackFrame":"jp-DebuggerCallstackFrame"},Xe().createElement("span",{className:"jp-DebuggerCallstackFrame-name"},t.name),Xe().createElement("span",{className:"jp-DebuggerCallstackFrame-location",title:null===(i=t.source)||void 0===i?void 0:i.path},(e=>{var t;const i=(null===(t=e.source)||void 0===t?void 0:t.path)||"",s=y.PathExt.basename(y.PathExt.dirname(i)),o=y.PathExt.basename(i);return`${y.PathExt.join(s,o)}:${e.line}`})(t)))})))};class tt extends s.PanelWithToolbar{constructor(e){var t;super(e);const{commands:i,model:o}=e,r=(null!==(t=e.translator)&&void 0!==t?t:v.nullTranslator).load("jupyterlab");this.title.label=r.__("Callstack");const n=new Qe(o);this.toolbar.addItem("continue",new s.CommandToolbarButton({commands:i.registry,id:i.continue,label:""})),this.toolbar.addItem("terminate",new s.CommandToolbarButton({commands:i.registry,id:i.terminate,label:""})),this.toolbar.addItem("step-over",new s.CommandToolbarButton({commands:i.registry,id:i.next,label:""})),this.toolbar.addItem("step-in",new s.CommandToolbarButton({commands:i.registry,id:i.stepIn,label:""})),this.toolbar.addItem("step-out",new s.CommandToolbarButton({commands:i.registry,id:i.stepOut,label:""})),this.toolbar.addItem("evaluate",new s.CommandToolbarButton({commands:i.registry,id:i.evaluate,label:""})),this.addWidget(n),this.addClass("jp-DebuggerCallstack")}}const it=({model:e})=>Xe().createElement(s.UseSignal,{signal:e.currentSourceChanged,initialSender:e},(e=>{var t,i;return Xe().createElement("span",{onClick:()=>null==e?void 0:e.open()},null!==(i=null===(t=null==e?void 0:e.currentSource)||void 0===t?void 0:t.path)&&void 0!==i?i:"")}));class st extends d.Widget{constructor(e){super(),this._model=e.model,this._debuggerService=e.service,this._mimeTypeService=e.editorServices.mimeTypeService;const t=new vt.ReadOnlyEditorFactory({editorServices:e.editorServices});this._editor=t.createNewEditor({content:"",mimeType:"",path:""}),this._editor.hide(),this._model.currentFrameChanged.connect((async(e,t)=>{t?this._showSource(t):this._clearEditor()}));const i=new d.PanelLayout;i.addWidget(this._editor),this.layout=i,this.addClass("jp-DebuggerSources-body")}dispose(){var e;this.isDisposed||(null===(e=this._editorHandler)||void 0===e||e.dispose(),b.Signal.clearData(this),super.dispose())}_clearEditor(){this._model.currentSource=null,this._editor.hide()}async _showSource(e){var t;const i=null===(t=e.source)||void 0===t?void 0:t.path,s=await this._debuggerService.getSource({sourceReference:0,path:i});if(!(null==s?void 0:s.content))return void this._clearEditor();this._editorHandler&&this._editorHandler.dispose();const{content:o,mimeType:r}=s,n=r||this._mimeTypeService.getMimeTypeByFilePath(null!=i?i:"");this._editor.model.sharedModel.setSource(o),this._editor.model.mimeType=n,this._editorHandler=new x({debuggerService:this._debuggerService,editorReady:()=>Promise.resolve(this._editor.editor),getEditor:()=>this._editor.editor,path:i,src:this._editor.model.sharedModel}),this._model.currentSource={content:o,mimeType:n,path:null!=i?i:""},requestAnimationFrame((()=>{x.showCurrentLine(this._editor.editor,e.line)})),this._editor.show()}}class ot extends s.PanelWithToolbar{constructor(e){var t;super();const{model:i,service:o,editorServices:r}=e,n=(null!==(t=e.translator)&&void 0!==t?t:v.nullTranslator).load("jupyterlab");this.title.label=n.__("Source"),this.toolbar.addClass("jp-DebuggerSources-header");const a=new st({service:o,model:i,editorServices:r});this.toolbar.addItem("open",new s.ToolbarButton({icon:W,onClick:()=>i.open(),tooltip:n.__("Open in the Main Area")}));const l=s.ReactWidget.create(Xe().createElement(it,{model:i}));this.toolbar.addItem("sourcePath",l),this.addClass("jp-DebuggerSources-header"),this.addWidget(a),this.addClass("jp-DebuggerSources")}}const rt=e=>Xe().createElement(s.InputGroup,{type:"text",onChange:t=>{const i=t.target.value;e.model.filter=i},placeholder:"Filter the kernel sources",value:e.model.filter}),nt=e=>Xe().createElement(s.UseSignal,{signal:e.model.filterChanged,initialArgs:e.model.filter},(t=>Xe().createElement(rt,{model:e.model})));class at extends s.ReactWidget{constructor(e){var t;super(),this._showFilter=!1,this._model=e.model,this._debuggerService=e.service,this._trans=(null!==(t=e.translator)&&void 0!==t?t:v.nullTranslator).load("jupyterlab"),this.addClass("jp-DebuggerKernelSources-body")}render(){let e="jp-DebuggerKernelSource-filterBox";return this._showFilter||(e+=" jp-DebuggerKernelSource-filterBox-hidden"),Xe().createElement(Xe().Fragment,null,Xe().createElement("div",{className:e,key:"filter"},Xe().createElement(nt,{model:this._model})),Xe().createElement(s.UseSignal,{signal:this._model.changed},((e,t)=>{const i={};return(null!=t?t:[]).map((e=>{var t;const o=e.name,r=e.path,n=o+(i[o]=(null!==(t=i[o])&&void 0!==t?t:0)+1).toString();return Xe().createElement(s.ToolbarButtonComponent,{key:n,icon:V,label:o,tooltip:r,onClick:()=>{this._debuggerService.getSource({sourceReference:0,path:r}).then((e=>{this._model.open(e)})).catch((e=>{(0,h.showErrorMessage)(this._trans.__("Fail to get source"),this._trans.__("Fail to get '%1' source:\n%2",r,e))}))}})}))})))}toggleFilterbox(){this._showFilter=!this._showFilter,this.update()}}class lt extends s.PanelWithToolbar{constructor(e){var t;super();const{model:i,service:o}=e;this._model=i;const r=(null!==(t=e.translator)&&void 0!==t?t:v.nullTranslator).load("jupyterlab");this.title.label=r.__("Kernel Sources"),this.toolbar.addClass("jp-DebuggerKernelSources-header"),this._body=new at({service:o,model:i,translator:e.translator}),this.toolbar.addItem("open-filter",new s.ToolbarButton({icon:s.searchIcon,onClick:async()=>{this._body.toggleFilterbox()},tooltip:r.__("Toggle search filter")})),this.toolbar.addItem("refresh",new s.ToolbarButton({icon:s.refreshIcon,onClick:()=>{this._model.kernelSources=[],o.displayModules().catch((e=>{(0,h.showErrorMessage)(r.__("Fail to get kernel sources"),r.__("Fail to get kernel sources:\n%2",e))}))},tooltip:r.__("Refresh kernel sources")})),this.addClass("jp-DebuggerKernelSources-header"),this.addWidget(this._body),this.addClass("jp-DebuggerKenelSources")}set filter(e){this._model.filter=e}}const ht=({model:e,tree:t,grid:i,trans:o})=>{const[r,n]=(0,Ke.useState)("-"),a=e.scopes;return Xe().createElement(s.HTMLSelect,{onChange:e=>{const s=e.target.value;n(s),t.scope=s,i.scope=s},value:r,"aria-label":o.__("Scope")},a.map((e=>Xe().createElement("option",{key:e.name,value:e.name},o.__(e.name)))))};class ct extends s.ReactWidget{constructor(e){super();const{translator:t,model:i,tree:s,grid:o}=e;this._model=i,this._tree=s,this._grid=o,this._trans=(t||v.nullTranslator).load("jupyterlab")}render(){return Xe().createElement(s.UseSignal,{signal:this._model.changed,initialSender:this._model},(()=>Xe().createElement(ht,{model:this._model,trans:this._trans,tree:this._tree,grid:this._grid})))}}class dt extends s.ReactWidget{constructor(e){super(),this._scope="",this._scopes=[],this._filter=new Set,this._commands=e.commands,this._service=e.service,this._translator=e.translator,(this.model=e.model).changed.connect(this._updateScopes,this),this.addClass("jp-DebuggerVariables-body")}render(){var e;const t=null!==(e=this._scopes.find((e=>e.name===this._scope)))&&void 0!==e?e:this._scopes[0];return t?Xe().createElement(ut,{key:t.name,commands:this._commands,service:this._service,data:t.variables,filter:this._filter,translator:this._translator,handleSelectVariable:e=>{this.model.selectedVariable=e}}):Xe().createElement("div",null)}set filter(e){this._filter=e,this.update()}set scope(e){this._scope=e,this.update()}_updateScopes(e){ie.ArrayExt.shallowEqual(this._scopes,e.scopes)||(this._scopes=e.scopes,this.update())}}const ut=e=>{const{commands:t,data:i,service:s,filter:o,translator:r,handleSelectVariable:n}=e,[a,l]=(0,Ke.useState)(i);return(0,Ke.useEffect)((()=>{l(i)}),[i]),Xe().createElement("ul",null,null==a?void 0:a.filter((e=>!(o||new Set).has(e.evaluateName||""))).map((e=>{const i=`${e.name}-${e.evaluateName}-${e.type}-${e.value}-${e.variablesReference}`;return Xe().createElement(_t,{key:i,commands:t,data:e,service:s,filter:o,translator:r,onSelect:n})})))},_t=e=>{const{commands:t,data:i,service:o,filter:r,translator:n,onSelect:a}=e,[l]=(0,Ke.useState)(i),[h,c]=(0,Ke.useState)(),[d,u]=(0,Ke.useState)(),_=null!=a?a:()=>{},m=0!==l.variablesReference||"function"===l.type,p=(null!=n?n:v.nullTranslator).load("jupyterlab");return Xe().createElement("li",{onClick:e=>(async e=>{if(!m)return;e.stopPropagation();const t=await o.inspectVariable(l.variablesReference);c(!h),u(t)})(e),onMouseDown:()=>{_(l)}},Xe().createElement(s.caretDownEmptyIcon.react,{visibility:m?"visible":"hidden",stylesheet:"menuItem",tag:"span",transform:h?"rotate(0deg)":"rotate(-90deg)"}),Xe().createElement("span",{style:{color:"var(--jp-mirror-editor-attribute-color)"}},l.name),Xe().createElement("span",null,": "),Xe().createElement("span",{style:{color:"var(--jp-mirror-editor-string-color)"}},pt(l)),Xe().createElement("span",{className:"jp-DebuggerVariables-hspacer"}),o.model.hasRichVariableRendering&&!["special variables","protected variables","function variables","class variables"].includes(l.name)&&Xe().createElement("button",{className:"jp-DebuggerVariables-renderVariable",disabled:!t.isEnabled(vt.CommandIDs.renderMimeVariable,{name:l.name,variablesReference:l.variablesReference}),onClick:e=>{e.stopPropagation(),_(l),t.execute(vt.CommandIDs.renderMimeVariable,{name:l.name,variablesReference:l.variablesReference}).catch((e=>{console.error(`Failed to render variable ${l.name}`,e)}))},title:p.__("Render variable")},Xe().createElement(s.searchIcon.react,{stylesheet:"menuItem",tag:"span"})),h&&d&&Xe().createElement(ut,{key:l.name,commands:t,data:d,service:o,filter:r,translator:n}))};class mt extends s.PanelWithToolbar{constructor(e){super(e);const{model:t,service:i,commands:o,themeManager:r}=e,n=e.translator||v.nullTranslator,a=n.load("jupyterlab");this.title.label=a.__("Variables"),this.toolbar.addClass("jp-DebuggerVariables-toolbar"),this._tree=new dt({model:t,service:i,commands:o,translator:n}),this._table=new Ae({model:t,commands:o,themeManager:r,translator:n}),this._table.hide(),this.toolbar.addItem("scope-switcher",new ct({translator:n,model:t,tree:this._tree,grid:this._table}));const l=()=>{this._table.isHidden?(this._tree.hide(),this._table.show(),this.node.setAttribute("data-jp-table","true"),d("table")):(this._tree.show(),this._table.hide(),this.node.removeAttribute("data-jp-table"),d("tree")),this.update()},h=new s.ToolbarButton({icon:s.treeViewIcon,className:"jp-TreeView",onClick:l,tooltip:a.__("Tree View")}),c=new s.ToolbarButton({icon:s.tableRowsIcon,className:"jp-TableView",onClick:l,tooltip:a.__("Table View")}),d=e=>{const t="jp-ViewModeSelected";"tree"===e?(c.removeClass(t),h.addClass(t)):(h.removeClass(t),c.addClass(t))};d(this._table.isHidden?"tree":"table"),this.toolbar.addItem("view-VariableTreeView",h),this.toolbar.addItem("view-VariableTableView",c),this.addWidget(this._tree),this.addWidget(this._table),this.addClass("jp-DebuggerVariables")}set filter(e){this._tree.filter=e,this._table.filter=e}onResize(e){super.onResize(e),this._resizeBody(e)}_resizeBody(e){const t=e.height-this.toolbar.node.offsetHeight;this._tree.node.style.height=`${t}px`}}const pt=e=>{var t,i;const{type:s,value:o}=e;switch(s){case"int":return parseInt(o,10);case"float":return parseFloat(o);case"bool":return o;case"str":return(null===(i=null===(t=e.presentationHint)||void 0===t?void 0:t.attributes)||void 0===i?void 0:i.includes("rawString"))?o.slice(1,o.length-1):o;default:return null!=s?s:o}};class gt extends s.SidePanel{constructor(e){const t=e.translator||v.nullTranslator;super({translator:t}),this.id="jp-debugger-sidebar",this.title.icon=s.bugIcon,this.addClass("jp-DebuggerSidebar");const{callstackCommands:i,breakpointsCommands:o,editorServices:r,service:n,themeManager:a}=e,l=n.model;this.variables=new mt({model:l.variables,commands:i.registry,service:n,themeManager:a,translator:t}),this.callstack=new tt({commands:i,model:l.callstack,translator:t}),this.breakpoints=new Je({service:n,commands:o,model:l.breakpoints,translator:t}),this.sources=new ot({model:l.sources,service:n,editorServices:r,translator:t}),this.kernelSources=new lt({model:l.kernelSources,service:n,translator:t});const h=new gt.Header;this.header.addWidget(h),l.titleChanged.connect(((e,t)=>{h.title.label=t})),this.content.addClass("jp-DebuggerSidebar-body"),this.addWidget(this.variables),this.addWidget(this.callstack),this.addWidget(this.breakpoints),this.addWidget(this.sources),this.addWidget(this.kernelSources)}}var ft,vt;!function(e){class t extends d.Widget{constructor(){super({node:ft.createHeader()}),this.title.changed.connect((e=>{this.node.textContent=this.title.label}))}}e.Header=t}(gt||(gt={})),function(e){e.createHeader=function(){const e=document.createElement("h2");return e.textContent="-",e.classList.add("jp-text-truncated"),e}}(ft||(ft={}));class wt{constructor(e){var t,i,s;this._config=e.config,this._shell=e.shell,this._notebookTracker=null!==(t=e.notebookTracker)&&void 0!==t?t:null,this._consoleTracker=null!==(i=e.consoleTracker)&&void 0!==i?i:null,this._editorTracker=null!==(s=e.editorTracker)&&void 0!==s?s:null,this._readOnlyEditorTracker=new h.WidgetTracker({namespace:"@jupyterlab/debugger"})}find(e){return[...this._findInConsoles(e),...this._findInEditors(e),...this._findInNotebooks(e),...this._findInReadOnlyEditors(e)]}open(e){const{editorWrapper:t,label:i,caption:o}=e,r=new h.MainAreaWidget({content:t});r.id=h.DOMUtils.createDomID(),r.title.label=i,r.title.closable=!0,r.title.caption=o,r.title.icon=s.textEditorIcon,this._shell.add(r,"main",{type:"Debugger Sources"}),this._readOnlyEditorTracker.add(r)}_findInNotebooks(e){if(!this._notebookTracker)return[];const{focus:t,kernel:i,path:s,source:o}=e,r=[];return this._notebookTracker.forEach((e=>{const n=e.sessionContext;if(s!==n.path)return;const a=e.content;t&&(a.mode="command"),e.content.widgets.forEach(((s,n)=>{const l=s.model.sharedModel.getSource(),h=this._getCodeId(l,i);h&&o===h&&(t&&(a.activeCellIndex=n,a.activeCell&&a.scrollToItem(a.activeCellIndex).catch((e=>{})),this._shell.activateById(e.id)),r.push(Object.freeze({get:()=>s.editor,reveal:()=>a.scrollToItem(n),src:s.model.sharedModel})))}))})),r}_findInConsoles(e){if(!this._consoleTracker)return[];const{focus:t,kernel:i,path:s,source:o}=e,r=[];return this._consoleTracker.forEach((e=>{const n=e.sessionContext;if(s!==n.path)return;const a=e.console.cells;for(const s of a){const n=s.model.sharedModel.getSource(),a=this._getCodeId(n,i);if(!a)break;if(o!==a)break;r.push(Object.freeze({get:()=>s.editor,reveal:()=>Promise.resolve(this._shell.activateById(e.id)),src:s.model.sharedModel})),t&&this._shell.activateById(e.id)}})),r}_findInEditors(e){if(!this._editorTracker)return[];const{focus:t,kernel:i,path:s,source:o}=e,r=[];return this._editorTracker.forEach((e=>{const n=e.content;if(s!==n.context.path)return;const a=n.editor;if(!a)return;const l=a.model.sharedModel.getSource(),h=this._getCodeId(l,i);h&&o===h&&(r.push(Object.freeze({get:()=>a,reveal:()=>Promise.resolve(this._shell.activateById(e.id)),src:n.model.sharedModel})),t&&this._shell.activateById(e.id))})),r}_findInReadOnlyEditors(e){const{focus:t,kernel:i,source:s}=e,o=[];return this._readOnlyEditorTracker.forEach((e=>{var r;const n=null===(r=e.content)||void 0===r?void 0:r.editor;if(!n)return;const a=n.model.sharedModel.getSource(),l=this._getCodeId(a,i);l&&(e.title.caption!==s&&s!==l||(o.push(Object.freeze({get:()=>n,reveal:()=>Promise.resolve(this._shell.activateById(e.id)),src:n.model.sharedModel})),t&&this._shell.activateById(e.id)))})),o}_getCodeId(e,t){try{return this._config.getCodeId(e,t)}catch(e){return""}}}!function(e){let t,i,o;e.Config=class extends a{},e.EditorHandler=class extends x{},e.Handler=class extends O{},e.Model=class extends X{},e.ReadOnlyEditorFactory=class extends g{},e.Service=class extends Fe{},e.Session=class extends qe{},e.Sidebar=class extends gt{},e.Sources=class extends wt{},e.VariablesGrid=class extends Ae{},e.VariableRenderer=class extends je{},function(e){e.debugContinue="debugger:continue",e.terminate="debugger:terminate",e.next="debugger:next",e.showPanel="debugger:show-panel",e.stepIn="debugger:stepIn",e.stepOut="debugger:stepOut",e.inspectVariable="debugger:inspect-variable",e.renderMimeVariable="debugger:render-mime-variable",e.evaluate="debugger:evaluate",e.restartDebug="debugger:restart-debug",e.pause="debugger:pause"}(t=e.CommandIDs||(e.CommandIDs={})),function(e){e.closeAllIcon=D,e.evaluateIcon=s.codeIcon,e.continueIcon=s.runIcon,e.stepIntoIcon=T,e.stepOutIcon=B,e.stepOverIcon=L,e.terminateIcon=s.stopIcon,e.variableIcon=I,e.viewBreakpointIcon=W,e.pauseOnExceptionsIcon=z}(i=e.Icons||(e.Icons={})),function(e){e.getCode=l.getCode}(o=e.Dialogs||(e.Dialogs={}))}(vt||(vt={}));const bt=new oe.Token("@jupyterlab/debugger:IDebugger"),yt=new oe.Token("@jupyterlab/debugger:IDebuggerConfig"),St=new oe.Token("@jupyterlab/debugger:IDebuggerSources"),Ct=new oe.Token("@jupyterlab/debugger:IDebuggerSidebar"),xt=new oe.Token("@jupyterlab/debugger:IDebuggerHandler")}}]);